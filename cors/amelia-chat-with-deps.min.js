
(function(){function k(d,e,b){function g(c,h){if(!e[c]){if(!d[c]){var a="function"==typeof require&&require;if(!h&&a)return a(c,!0);if(n)return n(c,!0);a=Error("Cannot find module '"+c+"'");throw a.code="MODULE_NOT_FOUND",a;}a=e[c]={exports:{}};d[c][0].call(a.exports,function(a){var m=d[c][1][a];return g(m?m:a)},a,a.exports,k,d,e,b)}return e[c].exports}for(var n="function"==typeof require&&require,l=0;l<b.length;l++)g(b[l]);return g}return k})()({1:[function(k,d,e){(function(b){function g(a){for(var c=0;c<a.length;c++){var b=a[c];if(b.buffer instanceof ArrayBuffer){var f=b.buffer;if(b.byteLength!==f.byteLength){var e=new Uint8Array(b.byteLength);e.set(new Uint8Array(f,b.byteOffset,b.byteLength));f=e.buffer}a[c]=f}}}function e(a,b){b=b||{};var d=new c;g(a);for(var f=0;f<a.length;f++)d.append(a[f]);return b.type?d.getBlob(b.type):d.getBlob()}function l(a,b){g(a);return new Blob(a,b||{})}var c=b.BlobBuilder||b.WebKitBlobBuilder||b.MSBlobBuilder||b.MozBlobBuilder,h;try{h=2===(new Blob(["hi"])).size}catch(m){h=!1}var a;if(a=h)try{a=2===(new Blob([new Uint8Array([1,2])])).size}catch(m){a=!1}var k=c&&c.prototype.append&&c.prototype.getBlob;b=h?a?b.Blob:l:k?e:void 0;d.exports=b}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}]},{},[1]);

!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.SockJS=t()}}(function(){var t;return function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return i(n||t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){(function(n){"use strict";var r=t("./transport-list");e.exports=t("./main")(r),"_sockjs_onload"in n&&setTimeout(n._sockjs_onload,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./main":14,"./transport-list":16}],2:[function(t,e,n){"use strict";function r(){o.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}var i=t("inherits"),o=t("./event");i(r,o),e.exports=r},{"./event":4,"inherits":54}],3:[function(t,e,n){"use strict";function r(){o.call(this)}var i=t("inherits"),o=t("./eventtarget");i(r,o),r.prototype.removeAllListeners=function(t){t?delete this._listeners[t]:this._listeners={}},r.prototype.once=function(t,e){function n(){r.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}var r=this,i=!1;this.on(t,n)},r.prototype.emit=function(){var t=arguments[0],e=this._listeners[t];if(e){for(var n=arguments.length,r=new Array(n-1),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0;o<e.length;o++)e[o].apply(this,r)}},r.prototype.on=r.prototype.addListener=o.prototype.addEventListener,r.prototype.removeListener=o.prototype.removeEventListener,e.exports.EventEmitter=r},{"./eventtarget":5,"inherits":54}],4:[function(t,e,n){"use strict";function r(t){this.type=t}r.prototype.initEvent=function(t,e,n){return this.type=t,this.bubbles=e,this.cancelable=n,this.timeStamp=+new Date,this},r.prototype.stopPropagation=function(){},r.prototype.preventDefault=function(){},r.CAPTURING_PHASE=1,r.AT_TARGET=2,r.BUBBLING_PHASE=3,e.exports=r},{}],5:[function(t,e,n){"use strict";function r(){this._listeners={}}r.prototype.addEventListener=function(t,e){t in this._listeners||(this._listeners[t]=[]);var n=this._listeners[t];-1===n.indexOf(e)&&(n=n.concat([e])),this._listeners[t]=n},r.prototype.removeEventListener=function(t,e){var n=this._listeners[t];if(n){var r=n.indexOf(e);return-1!==r?void(n.length>1?this._listeners[t]=n.slice(0,r).concat(n.slice(r+1)):delete this._listeners[t]):void 0}},r.prototype.dispatchEvent=function(){var t=arguments[0],e=t.type,n=1===arguments.length?[t]:Array.apply(null,arguments);if(this["on"+e]&&this["on"+e].apply(this,n),e in this._listeners)for(var r=this._listeners[e],i=0;i<r.length;i++)r[i].apply(this,n)},e.exports=r},{}],6:[function(t,e,n){"use strict";function r(t){o.call(this),this.initEvent("message",!1,!1),this.data=t}var i=t("inherits"),o=t("./event");i(r,o),e.exports=r},{"./event":4,"inherits":54}],7:[function(t,e,n){"use strict";function r(t){this._transport=t,t.on("message",this._transportMessage.bind(this)),t.on("close",this._transportClose.bind(this))}var i=t("json3"),o=t("./utils/iframe");r.prototype._transportClose=function(t,e){o.postMessage("c",i.stringify([t,e]))},r.prototype._transportMessage=function(t){o.postMessage("t",t)},r.prototype._send=function(t){this._transport.send(t)},r.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},e.exports=r},{"./utils/iframe":47,"json3":55}],8:[function(t,e,n){"use strict";var r=t("./utils/url"),i=t("./utils/event"),o=t("json3"),s=t("./facade"),a=t("./info-iframe-receiver"),l=t("./utils/iframe"),u=t("./location");e.exports=function(t,e){var n={};e.forEach(function(t){t.facadeTransport&&(n[t.facadeTransport.transportName]=t.facadeTransport)}),n[a.transportName]=a;var c;t.bootstrap_iframe=function(){var e;l.currentWindowId=u.hash.slice(1);var a=function(i){if(i.source===parent&&(void 0===c&&(c=i.origin),i.origin===c)){var a;try{a=o.parse(i.data)}catch(t){return void i.data}if(a.windowId===l.currentWindowId)switch(a.type){case"s":var f;try{f=o.parse(a.data)}catch(t){a.data;break}var h=f[0],d=f[1],p=f[2],v=f[3];if(h!==t.version)throw new Error('Incompatible SockJS! Main site uses: "'+h+'", the iframe: "'+t.version+'".');if(!r.isOriginEqual(p,u.href)||!r.isOriginEqual(v,u.href))throw new Error("Can't connect to different domain from within an iframe. ("+u.href+", "+p+", "+v+")");e=new s(new n[d](p,v));break;case"m":e._send(a.data);break;case"c":e&&e._close(),e=null}}};i.attachEvent("message",a),l.postMessage("s")}}},{"./facade":7,"./info-iframe-receiver":10,"./location":13,"./utils/event":46,"./utils/iframe":47,"./utils/url":52,"debug":void 0,"json3":55}],9:[function(t,e,n){"use strict";function r(t,e){i.call(this);var n=this,r=+new Date;this.xo=new e("GET",t),this.xo.once("finish",function(t,e){var i,o;if(200===t){if(o=+new Date-r,e)try{i=s.parse(e)}catch(t){}a.isObject(i)||(i={})}n.emit("finish",i,o),n.removeAllListeners()})}var i=t("events").EventEmitter,o=t("inherits"),s=t("json3"),a=t("./utils/object");o(r,i),r.prototype.close=function(){this.removeAllListeners(),this.xo.close()},e.exports=r},{"./utils/object":49,"debug":void 0,"events":3,"inherits":54,"json3":55}],10:[function(t,e,n){"use strict";function r(t){var e=this;o.call(this),this.ir=new l(t,a),this.ir.once("finish",function(t,n){e.ir=null,e.emit("message",s.stringify([t,n]))})}var i=t("inherits"),o=t("events").EventEmitter,s=t("json3"),a=t("./transport/sender/xhr-local"),l=t("./info-ajax");i(r,o),r.transportName="iframe-info-receiver",r.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},e.exports=r},{"./info-ajax":9,"./transport/sender/xhr-local":37,"events":3,"inherits":54,"json3":55}],11:[function(t,e,n){(function(n){"use strict";function r(t,e){var r=this;i.call(this);var o=function(){var n=r.ifr=new l(u.transportName,e,t);n.once("message",function(t){if(t){var e;try{e=s.parse(t)}catch(t){return r.emit("finish"),void r.close()}var n=e[0],i=e[1];r.emit("finish",n,i)}r.close()}),n.once("close",function(){r.emit("finish"),r.close()})};n.document.body?o():a.attachEvent("load",o)}var i=t("events").EventEmitter,o=t("inherits"),s=t("json3"),a=t("./utils/event"),l=t("./transport/iframe"),u=t("./info-iframe-receiver");o(r,i),r.enabled=function(){return l.enabled()},r.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./info-iframe-receiver":10,"./transport/iframe":22,"./utils/event":46,"debug":void 0,"events":3,"inherits":54,"json3":55}],12:[function(t,e,n){"use strict";function r(t,e){var n=this;i.call(this),setTimeout(function(){n.doXhr(t,e)},0)}var i=t("events").EventEmitter,o=t("inherits"),s=t("./utils/url"),a=t("./transport/sender/xdr"),l=t("./transport/sender/xhr-cors"),u=t("./transport/sender/xhr-local"),c=t("./transport/sender/xhr-fake"),f=t("./info-iframe"),h=t("./info-ajax");o(r,i),r._getReceiver=function(t,e,n){return n.sameOrigin?new h(e,u):l.enabled?new h(e,l):a.enabled&&n.sameScheme?new h(e,a):f.enabled()?new f(t,e):new h(e,c)},r.prototype.doXhr=function(t,e){var n=this,i=s.addPath(t,"/info");this.xo=r._getReceiver(t,i,e),this.timeoutRef=setTimeout(function(){n._cleanup(!1),n.emit("finish")},r.timeout),this.xo.once("finish",function(t,e){n._cleanup(!0),n.emit("finish",t,e)})},r.prototype._cleanup=function(t){clearTimeout(this.timeoutRef),this.timeoutRef=null,!t&&this.xo&&this.xo.close(),this.xo=null},r.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},r.timeout=8e3,e.exports=r},{"./info-ajax":9,"./info-iframe":11,"./transport/sender/xdr":34,"./transport/sender/xhr-cors":35,"./transport/sender/xhr-fake":36,"./transport/sender/xhr-local":37,"./utils/url":52,"debug":void 0,"events":3,"inherits":54}],13:[function(t,e,n){(function(t){"use strict";e.exports=t.location||{origin:"http://localhost:80",protocol:"http",host:"localhost",port:80,href:"http://localhost/",hash:""}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(t,e,n){(function(n){"use strict";function r(t,e,n){if(!(this instanceof r))return new r(t,e,n);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");y.call(this),this.readyState=r.CONNECTING,this.extensions="",this.protocol="",n=n||{},n.protocols_whitelist&&m.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=n.transports,this._transportOptions=n.transportOptions||{};var i=n.sessionId||8;if("function"==typeof i)this._generateSessionId=i;else{if("number"!=typeof i)throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return u.string(i)}}this._server=n.server||u.numberString(1e3);var o=new s(t);if(!o.host||!o.protocol)throw new SyntaxError("The URL '"+t+"' is invalid");if(o.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==o.protocol&&"https:"!==o.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+o.protocol+"' is not allowed.");var a="https:"===o.protocol;if("https"===g.protocol&&!a)throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");e?Array.isArray(e)||(e=[e]):e=[];var l=e.sort();l.forEach(function(t,e){if(!t)throw new SyntaxError("The protocols entry '"+t+"' is invalid.");if(e<l.length-1&&t===l[e+1])throw new SyntaxError("The protocols entry '"+t+"' is duplicated.")});var c=f.getOrigin(g.href);this._origin=c?c.toLowerCase():null,o.set("pathname",o.pathname.replace(/\/+$/,"")),this.url=o.href,this.url,this._urlInfo={nullOrigin:!v.hasDomain(),sameOrigin:f.isOriginEqual(this.url,g.href),sameScheme:f.isSchemeEqual(this.url,g.href)},this._ir=new _(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function i(t){return 1e3===t||t>=3e3&&t<=4999}t("./shims");var o,s=t("url-parse"),a=t("inherits"),l=t("json3"),u=t("./utils/random"),c=t("./utils/escape"),f=t("./utils/url"),h=t("./utils/event"),d=t("./utils/transport"),p=t("./utils/object"),v=t("./utils/browser"),m=t("./utils/log"),b=t("./event/event"),y=t("./event/eventtarget"),g=t("./location"),w=t("./event/close"),x=t("./event/trans-message"),_=t("./info-receiver");a(r,y),r.prototype.close=function(t,e){if(t&&!i(t))throw new Error("InvalidAccessError: Invalid code");if(e&&e.length>123)throw new SyntaxError("reason argument has an invalid length");if(this.readyState!==r.CLOSING&&this.readyState!==r.CLOSED){this._close(t||1e3,e||"Normal closure",!0)}},r.prototype.send=function(t){if("string"!=typeof t&&(t=""+t),this.readyState===r.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===r.OPEN&&this._transport.send(c.quote(t))},r.version=t("./version"),r.CONNECTING=0,r.OPEN=1,r.CLOSING=2,r.CLOSED=3,r.prototype._receiveInfo=function(t,e){if(this._ir=null,!t)return void this._close(1002,"Cannot connect to server");this._rto=this.countRTO(e),this._transUrl=t.base_url?t.base_url:this.url,t=p.extend(t,this._urlInfo);var n=o.filterToEnabled(this._transportsWhitelist,t);this._transports=n.main,this._transports.length,this._connect()},r.prototype._connect=function(){for(var t=this._transports.shift();t;t=this._transports.shift()){if(t.transportName,t.needBody&&(!n.document.body||void 0!==n.document.readyState&&"complete"!==n.document.readyState&&"interactive"!==n.document.readyState))return this._transports.unshift(t),void h.attachEvent("load",this._connect.bind(this));var e=this._rto*t.roundTrips||5e3;this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),e);var r=f.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),i=this._transportOptions[t.transportName],o=new t(r,this._transUrl,i);return o.on("message",this._transportMessage.bind(this)),o.once("close",this._transportClose.bind(this)),o.transportName=t.transportName,void(this._transport=o)}this._close(2e3,"All transports failed",!1)},r.prototype._transportTimeout=function(){this.readyState===r.CONNECTING&&this._transportClose(2007,"Transport timed out")},r.prototype._transportMessage=function(t){var e,n=this,r=t.slice(0,1),i=t.slice(1);switch(r){case"o":return void this._open();case"h":return this.dispatchEvent(new b("heartbeat")),void this.transport}if(i)try{e=l.parse(i)}catch(t){}if(void 0!==e)switch(r){case"a":Array.isArray(e)&&e.forEach(function(t){n.transport,n.dispatchEvent(new x(t))});break;case"m":this.transport,this.dispatchEvent(new x(e));break;case"c":Array.isArray(e)&&2===e.length&&this._close(e[0],e[1],!0)}},r.prototype._transportClose=function(t,e){if(this.transport,this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),!i(t)&&2e3!==t&&this.readyState===r.CONNECTING)return void this._connect();this._close(t,e)},r.prototype._open=function(){this._transport.transportName,this.readyState,this.readyState===r.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=r.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new b("open")),this.transport):this._close(1006,"Server lost session")},r.prototype._close=function(t,e,n){this.transport,this.readyState;var i=!1;if(this._ir&&(i=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===r.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=r.CLOSING,setTimeout(function(){this.readyState=r.CLOSED,i&&this.dispatchEvent(new b("error"));var o=new w("close");o.wasClean=n||!1,o.code=t||1e3,o.reason=e,this.dispatchEvent(o),this.onmessage=this.onclose=this.onerror=null}.bind(this),0)},r.prototype.countRTO=function(t){return t>100?4*t:300+t},e.exports=function(e){return o=d(e),t("./iframe-bootstrap")(r,e),r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./event/close":2,"./event/event":4,"./event/eventtarget":5,"./event/trans-message":6,"./iframe-bootstrap":8,"./info-receiver":12,"./location":13,"./shims":15,"./utils/browser":44,"./utils/escape":45,"./utils/event":46,"./utils/log":48,"./utils/object":49,"./utils/random":50,"./utils/transport":51,"./utils/url":52,"./version":53,"debug":void 0,"inherits":54,"json3":55,"url-parse":58}],15:[function(t,e,n){"use strict";function r(t){var e=+t;return e!==e?e=0:0!==e&&e!==1/0&&e!==-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}function i(t){return t>>>0}function o(){}var s,a=Array.prototype,l=Object.prototype,u=Function.prototype,c=String.prototype,f=a.slice,h=l.toString,d=function(t){return"[object Function]"===l.toString.call(t)},p=function(t){return"[object Array]"===h.call(t)},v=function(t){return"[object String]"===h.call(t)},m=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}();s=m?function(t,e,n,r){!r&&e in t||Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(t,e,n,r){!r&&e in t||(t[e]=n)};var b=function(t,e,n){for(var r in e)l.hasOwnProperty.call(e,r)&&s(t,r,e[r],n)},y=function(t){if(null==t)throw new TypeError("can't convert "+t+" to object");return Object(t)};b(u,{bind:function(t){var e=this;if(!d(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var n=f.call(arguments,1),r=function(){if(this instanceof l){var r=e.apply(this,n.concat(f.call(arguments)));return Object(r)===r?r:this}return e.apply(t,n.concat(f.call(arguments)))},i=Math.max(0,e.length-n.length),s=[],a=0;a<i;a++)s.push("$"+a);var l=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this, arguments); }")(r);return e.prototype&&(o.prototype=e.prototype,l.prototype=new o,o.prototype=null),l}}),b(Array,{isArray:p});var g=Object("a"),w="a"!==g[0]||!(0 in g);b(a,{forEach:function(t){var e=y(this),n=w&&v(this)?this.split(""):e,r=arguments[1],i=-1,o=n.length>>>0;if(!d(t))throw new TypeError;for(;++i<o;)i in n&&t.call(r,n[i],i,e)}},!function(t){var e=!0,n=!0;return t&&(t.call("foo",function(t,n,r){"object"!=typeof r&&(e=!1)}),t.call([1],function(){n="string"==typeof this},"x")),!!t&&e&&n}(a.forEach));var x=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);b(a,{indexOf:function(t){var e=w&&v(this)?this.split(""):y(this),n=e.length>>>0;if(!n)return-1;var i=0;for(arguments.length>1&&(i=r(arguments[1])),i=i>=0?i:Math.max(0,n+i);i<n;i++)if(i in e&&e[i]===t)return i;return-1}},x);var _=c.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?function(){var t=void 0===/()??/.exec("")[1];c.split=function(e,n){var r=this;if(void 0===e&&0===n)return[];if("[object RegExp]"!==h.call(e))return _.call(this,e,n);var o,s,l,u,c=[],f=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":""),d=0;for(e=new RegExp(e.source,f+"g"),r+="",t||(o=new RegExp("^"+e.source+"$(?!\\s)",f)),n=void 0===n?-1>>>0:i(n);(s=e.exec(r))&&!((l=s.index+s[0].length)>d&&(c.push(r.slice(d,s.index)),!t&&s.length>1&&s[0].replace(o,function(){for(var t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(s[t]=void 0)}),s.length>1&&s.index<r.length&&a.push.apply(c,s.slice(1)),u=s[0].length,d=l,c.length>=n));)e.lastIndex===s.index&&e.lastIndex++;return d===r.length?!u&&e.test("")||c.push(""):c.push(r.slice(d)),c.length>n?c.slice(0,n):c}}():"0".split(void 0,0).length&&(c.split=function(t,e){return void 0===t&&0===e?[]:_.call(this,t,e)});var E=c.substr,j="".substr&&"b"!=="0b".substr(-1);b(c,{substr:function(t,e){return E.call(this,t<0&&(t=this.length+t)<0?0:t,e)}},j)},{}],16:[function(t,e,n){"use strict";e.exports=[t("./transport/websocket"),t("./transport/xhr-streaming"),t("./transport/xdr-streaming"),t("./transport/eventsource"),t("./transport/lib/iframe-wrap")(t("./transport/eventsource")),t("./transport/htmlfile"),t("./transport/lib/iframe-wrap")(t("./transport/htmlfile")),t("./transport/xhr-polling"),t("./transport/xdr-polling"),t("./transport/lib/iframe-wrap")(t("./transport/xhr-polling")),t("./transport/jsonp-polling")]},{"./transport/eventsource":20,"./transport/htmlfile":21,"./transport/jsonp-polling":23,"./transport/lib/iframe-wrap":26,"./transport/websocket":38,"./transport/xdr-polling":39,"./transport/xdr-streaming":40,"./transport/xhr-polling":41,"./transport/xhr-streaming":42}],17:[function(t,e,n){(function(n){"use strict";function r(t,e,n,r){var o=this;i.call(this),setTimeout(function(){o._start(t,e,n,r)},0)}var i=t("events").EventEmitter,o=t("inherits"),s=t("../../utils/event"),a=t("../../utils/url"),l=n.XMLHttpRequest;o(r,i),r.prototype._start=function(t,e,n,i){var o=this;try{this.xhr=new l}catch(t){}if(!this.xhr)return this.emit("finish",0,"no xhr support"),void this._cleanup();e=a.addQuery(e,"t="+ +new Date),this.unloadRef=s.unloadAdd(function(){o._cleanup(!0)});try{this.xhr.open(t,e,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){o.emit("finish",0,""),o._cleanup(!1)})}catch(t){return this.emit("finish",0,""),void this._cleanup(!1)}if(i&&i.noCredentials||!r.supportsCORS||(this.xhr.withCredentials="true"),i&&i.headers)for(var u in i.headers)this.xhr.setRequestHeader(u,i.headers[u]);this.xhr.onreadystatechange=function(){if(o.xhr){var t,e,n=o.xhr;switch(n.readyState,n.readyState){case 3:try{e=n.status,t=n.responseText}catch(t){}1223===e&&(e=204),200===e&&t&&t.length>0&&o.emit("chunk",e,t);break;case 4:e=n.status,1223===e&&(e=204),12005!==e&&12029!==e||(e=0),n.responseText,o.emit("finish",e,n.responseText),o._cleanup(!1)}}};try{o.xhr.send(n)}catch(t){o.emit("finish",0,""),o._cleanup(!1)}},r.prototype._cleanup=function(t){if(this.xhr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),t)try{this.xhr.abort()}catch(t){}this.unloadRef=this.xhr=null}},r.prototype.close=function(){this._cleanup(!0)},r.enabled=!!l;var u=["Active"].concat("Object").join("X");!r.enabled&&u in n&&(l=function(){try{return new n[u]("Microsoft.XMLHTTP")}catch(t){return null}},r.enabled=!!new l);var c=!1;try{c="withCredentials"in new l}catch(t){}r.supportsCORS=c,e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/event":46,"../../utils/url":52,"debug":void 0,"events":3,"inherits":54}],18:[function(t,e,n){(function(t){e.exports=t.EventSource}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(t,e,n){(function(t){"use strict";var n=t.WebSocket||t.MozWebSocket;e.exports=n?function(t){return new n(t)}:void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(t,e,n){"use strict";function r(t){if(!r.enabled())throw new Error("Transport created when disabled");o.call(this,t,"/eventsource",s,a)}var i=t("inherits"),o=t("./lib/ajax-based"),s=t("./receiver/eventsource"),a=t("./sender/xhr-cors"),l=t("eventsource");i(r,o),r.enabled=function(){return!!l},r.transportName="eventsource",r.roundTrips=2,e.exports=r},{"./lib/ajax-based":24,"./receiver/eventsource":29,"./sender/xhr-cors":35,"eventsource":18,"inherits":54}],21:[function(t,e,n){"use strict";function r(t){if(!o.enabled)throw new Error("Transport created when disabled");a.call(this,t,"/htmlfile",o,s)}var i=t("inherits"),o=t("./receiver/htmlfile"),s=t("./sender/xhr-local"),a=t("./lib/ajax-based");i(r,a),r.enabled=function(t){return o.enabled&&t.sameOrigin},r.transportName="htmlfile",r.roundTrips=2,e.exports=r},{"./lib/ajax-based":24,"./receiver/htmlfile":30,"./sender/xhr-local":37,"inherits":54}],22:[function(t,e,n){"use strict";function r(t,e,n){if(!r.enabled())throw new Error("Transport created when disabled");s.call(this);var i=this;this.origin=l.getOrigin(n),this.baseUrl=n,this.transUrl=e,this.transport=t,this.windowId=f.string(8);var o=l.addPath(n,"/iframe.html")+"#"+this.windowId;this.iframeObj=u.createIframe(o,function(t){i.emit("close",1006,"Unable to load an iframe ("+t+")"),i.close()}),this.onmessageCallback=this._message.bind(this),c.attachEvent("message",this.onmessageCallback)}var i=t("inherits"),o=t("json3"),s=t("events").EventEmitter,a=t("../version"),l=t("../utils/url"),u=t("../utils/iframe"),c=t("../utils/event"),f=t("../utils/random");i(r,s),r.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){c.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch(t){}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},r.prototype._message=function(t){if(t.data,!l.isOriginEqual(t.origin,this.origin))return t.origin,void this.origin;var e;try{e=o.parse(t.data)}catch(e){return void t.data}if(e.windowId!==this.windowId)return e.windowId,void this.windowId;switch(e.type){case"s":this.iframeObj.loaded(),this.postMessage("s",o.stringify([a,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",e.data);break;case"c":var n;try{n=o.parse(e.data)}catch(t){return void e.data}this.emit("close",n[0],n[1]),this.close()}},r.prototype.postMessage=function(t,e){this.iframeObj.post(o.stringify({windowId:this.windowId,type:t,data:e||""}),this.origin)},r.prototype.send=function(t){this.postMessage("m",t)},r.enabled=function(){return u.iframeEnabled},r.transportName="iframe",r.roundTrips=2,e.exports=r},{"../utils/event":46,"../utils/iframe":47,"../utils/random":50,"../utils/url":52,"../version":53,"debug":void 0,"events":3,"inherits":54,"json3":55}],23:[function(t,e,n){(function(n){"use strict";function r(t){if(!r.enabled())throw new Error("Transport created when disabled");o.call(this,t,"/jsonp",a,s)}var i=t("inherits"),o=t("./lib/sender-receiver"),s=t("./receiver/jsonp"),a=t("./sender/jsonp");i(r,o),r.enabled=function(){return!!n.document},r.transportName="jsonp-polling",r.roundTrips=1,r.needBody=!0,e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/sender-receiver":28,"./receiver/jsonp":31,"./sender/jsonp":33,"inherits":54}],24:[function(t,e,n){"use strict";function r(t){return function(e,n,r){var i={};"string"==typeof n&&(i.headers={"Content-type":"text/plain"});var o=s.addPath(e,"/xhr_send"),a=new t("POST",o,n,i);return a.once("finish",function(t){if(a=null,200!==t&&204!==t)return r(new Error("http status "+t));r()}),function(){a.close(),a=null;var t=new Error("Aborted");t.code=1e3,r(t)}}}function i(t,e,n,i){a.call(this,t,e,r(i),n,i)}var o=t("inherits"),s=t("../../utils/url"),a=t("./sender-receiver");o(i,a),e.exports=i},{"../../utils/url":52,"./sender-receiver":28,"debug":void 0,"inherits":54}],25:[function(t,e,n){"use strict";function r(t,e){o.call(this),this.sendBuffer=[],this.sender=e,this.url=t}var i=t("inherits"),o=t("events").EventEmitter;i(r,o),r.prototype.send=function(t){this.sendBuffer.push(t),this.sendStop||this.sendSchedule()},r.prototype.sendScheduleWait=function(){var t,e=this;this.sendStop=function(){e.sendStop=null,clearTimeout(t)},t=setTimeout(function(){e.sendStop=null,e.sendSchedule()},25)},r.prototype.sendSchedule=function(){this.sendBuffer.length;var t=this;if(this.sendBuffer.length>0){var e="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,e,function(e){t.sendStop=null,e?(t.emit("close",e.code||1006,"Sending error: "+e),t.close()):t.sendScheduleWait()}),this.sendBuffer=[]}},r.prototype._cleanup=function(){this.removeAllListeners()},r.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},e.exports=r},{"debug":void 0,"events":3,"inherits":54}],26:[function(t,e,n){(function(n){"use strict";var r=t("inherits"),i=t("../iframe"),o=t("../../utils/object");e.exports=function(t){function e(e,n){i.call(this,t.transportName,e,n)}return r(e,i),e.enabled=function(e,r){if(!n.document)return!1;var s=o.extend({},r);return s.sameOrigin=!0,t.enabled(s)&&i.enabled()},e.transportName="iframe-"+t.transportName,e.needBody=!0,e.roundTrips=i.roundTrips+t.roundTrips-1,e.facadeTransport=t,e}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/object":49,"../iframe":22,"inherits":54}],27:[function(t,e,n){"use strict";function r(t,e,n){o.call(this),this.Receiver=t,this.receiveUrl=e,this.AjaxObject=n,this._scheduleReceiver()}var i=t("inherits"),o=t("events").EventEmitter;i(r,o),r.prototype._scheduleReceiver=function(){var t=this,e=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);e.on("message",function(e){t.emit("message",e)}),e.once("close",function(n,r){t.pollIsClosing,t.poll=e=null,t.pollIsClosing||("network"===r?t._scheduleReceiver():(t.emit("close",n||1006,r),t.removeAllListeners()))})},r.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},e.exports=r},{"debug":void 0,"events":3,"inherits":54}],28:[function(t,e,n){"use strict";function r(t,e,n,r,i){var l=o.addPath(t,e),u=this;s.call(this,t,n),this.poll=new a(r,l,i),this.poll.on("message",function(t){u.emit("message",t)}),this.poll.once("close",function(t,e){u.poll=null,u.emit("close",t,e),u.close()})}var i=t("inherits"),o=t("../../utils/url"),s=t("./buffered-sender"),a=t("./polling");i(r,s),r.prototype.close=function(){s.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},e.exports=r},{"../../utils/url":52,"./buffered-sender":25,"./polling":27,"debug":void 0,"inherits":54}],29:[function(t,e,n){"use strict";function r(t){o.call(this);var e=this,n=this.es=new s(t);n.onmessage=function(t){t.data,e.emit("message",decodeURI(t.data))},n.onerror=function(t){n.readyState;var r=2!==n.readyState?"network":"permanent";e._cleanup(),e._close(r)}}var i=t("inherits"),o=t("events").EventEmitter,s=t("eventsource");i(r,o),r.prototype.abort=function(){this._cleanup(),this._close("user")},r.prototype._cleanup=function(){var t=this.es;t&&(t.onmessage=t.onerror=null,t.close(),this.es=null)},r.prototype._close=function(t){var e=this;setTimeout(function(){e.emit("close",null,t),e.removeAllListeners()},200)},e.exports=r},{"debug":void 0,"events":3,"eventsource":18,"inherits":54}],30:[function(t,e,n){(function(n){"use strict";function r(t){a.call(this);var e=this;o.polluteGlobalNamespace(),this.id="a"+l.string(6),t=s.addQuery(t,"c="+decodeURIComponent(o.WPrefix+"."+this.id)),r.htmlfileEnabled;var i=r.htmlfileEnabled?o.createHtmlfile:o.createIframe;n[o.WPrefix][this.id]={start:function(){e.iframeObj.loaded()},message:function(t){e.emit("message",t)},stop:function(){e._cleanup(),e._close("network")}},this.iframeObj=i(t,function(){e._cleanup(),e._close("permanent")})}var i=t("inherits"),o=t("../../utils/iframe"),s=t("../../utils/url"),a=t("events").EventEmitter,l=t("../../utils/random");i(r,a),r.prototype.abort=function(){this._cleanup(),this._close("user")},r.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete n[o.WPrefix][this.id]},r.prototype._close=function(t){this.emit("close",null,t),this.removeAllListeners()},r.htmlfileEnabled=!1;var u=["Active"].concat("Object").join("X");if(u in n)try{r.htmlfileEnabled=!!new n[u]("htmlfile")}catch(t){}r.enabled=r.htmlfileEnabled||o.iframeEnabled,e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,"debug":void 0,"events":3,"inherits":54}],31:[function(t,e,n){(function(n){"use strict";function r(t){var e=this;u.call(this),i.polluteGlobalNamespace(),this.id="a"+o.string(6);var s=a.addQuery(t,"c="+encodeURIComponent(i.WPrefix+"."+this.id));n[i.WPrefix][this.id]=this._callback.bind(this),this._createScript(s),this.timeoutId=setTimeout(function(){e._abort(new Error("JSONP script loaded abnormally (timeout)"))},r.timeout)}var i=t("../../utils/iframe"),o=t("../../utils/random"),s=t("../../utils/browser"),a=t("../../utils/url"),l=t("inherits"),u=t("events").EventEmitter;l(r,u),r.prototype.abort=function(){if(n[i.WPrefix][this.id]){var t=new Error("JSONP user aborted read");t.code=1e3,this._abort(t)}},r.timeout=35e3,r.scriptErrorTimeout=1e3,r.prototype._callback=function(t){this._cleanup(),this.aborting||(t&&this.emit("message",t),this.emit("close",null,"network"),this.removeAllListeners())},r.prototype._abort=function(t){this._cleanup(),this.aborting=!0,this.emit("close",t.code,t.message),this.removeAllListeners()},r.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var t=this.script;t.parentNode.removeChild(t),t.onreadystatechange=t.onerror=t.onload=t.onclick=null,this.script=null}delete n[i.WPrefix][this.id]},r.prototype._scriptError=function(){var t=this;this.errorTimer||(this.errorTimer=setTimeout(function(){t.loadedOkay||t._abort(new Error("JSONP script loaded abnormally (onerror)"))},r.scriptErrorTimeout))},r.prototype._createScript=function(t){var e,r=this,i=this.script=n.document.createElement("script");if(i.id="a"+o.string(8),i.src=t,i.type="text/javascript",i.charset="UTF-8",i.onerror=this._scriptError.bind(this),i.onload=function(){r._abort(new Error("JSONP script loaded abnormally (onload)"))},i.onreadystatechange=function(){if(i.readyState,/loaded|closed/.test(i.readyState)){if(i&&i.htmlFor&&i.onclick){r.loadedOkay=!0;try{i.onclick()}catch(t){}}i&&r._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},void 0===i.async&&n.document.attachEvent)if(s.isOpera())e=this.script2=n.document.createElement("script"),e.text="try{var a = document.getElementById('"+i.id+"'); if(a)a.onerror();}catch(x){};",i.async=e.async=!1;else{try{i.htmlFor=i.id,i.event="onclick"}catch(t){}i.async=!0}void 0!==i.async&&(i.async=!0);var a=n.document.getElementsByTagName("head")[0];a.insertBefore(i,a.firstChild),e&&a.insertBefore(e,a.firstChild)},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,"debug":void 0,"events":3,"inherits":54}],32:[function(t,e,n){"use strict";function r(t,e){o.call(this);var n=this;this.bufferPosition=0,this.xo=new e("POST",t,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(t,e){n._chunkHandler(t,e),n.xo=null;var r=200===t?"network":"permanent";n.emit("close",null,r),n._cleanup()})}var i=t("inherits"),o=t("events").EventEmitter;i(r,o),r.prototype._chunkHandler=function(t,e){if(200===t&&e)for(var n=-1;;this.bufferPosition+=n+1){var r=e.slice(this.bufferPosition);if(-1===(n=r.indexOf("\n")))break;var i=r.slice(0,n);i&&this.emit("message",i)}},r.prototype._cleanup=function(){this.removeAllListeners()},r.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},e.exports=r},{"debug":void 0,"events":3,"inherits":54}],33:[function(t,e,n){(function(n){"use strict";function r(t){try{return n.document.createElement('<iframe name="'+t+'">')}catch(r){var e=n.document.createElement("iframe");return e.name=t,e}}function i(){o=n.document.createElement("form"),o.style.display="none",o.style.position="absolute",o.method="POST",o.enctype="application/x-www-form-urlencoded",o.acceptCharset="UTF-8",s=n.document.createElement("textarea"),s.name="d",o.appendChild(s),n.document.body.appendChild(o)}var o,s,a=t("../../utils/random"),l=t("../../utils/url");e.exports=function(t,e,n){o||i();var u="a"+a.string(8);o.target=u,o.action=l.addQuery(l.addPath(t,"/jsonp_send"),"i="+u);var c=r(u);c.id=u,c.style.display="none",o.appendChild(c);try{s.value=e}catch(t){}o.submit();var f=function(t){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,setTimeout(function(){c.parentNode.removeChild(c),c=null},500),s.value="",n(t))};return c.onerror=function(){f()},c.onload=function(){f()},c.onreadystatechange=function(t){c.readyState,"complete"===c.readyState&&f()},function(){f(new Error("Aborted"))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/random":50,"../../utils/url":52,"debug":void 0}],34:[function(t,e,n){(function(n){"use strict";function r(t,e,n){var r=this;i.call(this),setTimeout(function(){r._start(t,e,n)},0)}var i=t("events").EventEmitter,o=t("inherits"),s=t("../../utils/event"),a=t("../../utils/browser"),l=t("../../utils/url");o(r,i),r.prototype._start=function(t,e,r){var i=this,o=new n.XDomainRequest;e=l.addQuery(e,"t="+ +new Date),o.onerror=function(){i._error()},o.ontimeout=function(){i._error()},o.onprogress=function(){o.responseText,i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},this.xdr=o,this.unloadRef=s.unloadAdd(function(){i._cleanup(!0)});try{this.xdr.open(t,e),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(r)}catch(t){this._error()}},r.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},r.prototype._cleanup=function(t){if(this.xdr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,t)try{this.xdr.abort()}catch(t){}this.unloadRef=this.xdr=null}},r.prototype.close=function(){this._cleanup(!0)},r.enabled=!(!n.XDomainRequest||!a.hasDomain()),e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/event":46,"../../utils/url":52,"debug":void 0,"events":3,"inherits":54}],35:[function(t,e,n){"use strict";function r(t,e,n,r){o.call(this,t,e,n,r)}var i=t("inherits"),o=t("../driver/xhr");i(r,o),r.enabled=o.enabled&&o.supportsCORS,e.exports=r},{"../driver/xhr":17,"inherits":54}],36:[function(t,e,n){"use strict";function r(){var t=this;i.call(this),this.to=setTimeout(function(){t.emit("finish",200,"{}")},r.timeout)}var i=t("events").EventEmitter;t("inherits")(r,i),r.prototype.close=function(){clearTimeout(this.to)},r.timeout=2e3,e.exports=r},{"events":3,"inherits":54}],37:[function(t,e,n){"use strict";function r(t,e,n){o.call(this,t,e,n,{noCredentials:!0})}var i=t("inherits"),o=t("../driver/xhr");i(r,o),r.enabled=o.enabled,e.exports=r},{"../driver/xhr":17,"inherits":54}],38:[function(t,e,n){"use strict";function r(t,e,n){if(!r.enabled())throw new Error("Transport created when disabled");a.call(this);var s=this,u=o.addPath(t,"/websocket");u="https"===u.slice(0,5)?"wss"+u.slice(5):"ws"+u.slice(4),this.url=u,this.ws=new l(this.url,[],n),this.ws.onmessage=function(t){t.data,s.emit("message",t.data)},this.unloadRef=i.unloadAdd(function(){s.ws.close()}),this.ws.onclose=function(t){t.code,t.reason,s.emit("close",t.code,t.reason),s._cleanup()},this.ws.onerror=function(t){s.emit("close",1006,"WebSocket connection broken"),s._cleanup()}}var i=t("../utils/event"),o=t("../utils/url"),s=t("inherits"),a=t("events").EventEmitter,l=t("./driver/websocket");s(r,a),r.prototype.send=function(t){var e="["+t+"]";this.ws.send(e)},r.prototype.close=function(){var t=this.ws;this._cleanup(),t&&t.close()},r.prototype._cleanup=function(){var t=this.ws;t&&(t.onmessage=t.onclose=t.onerror=null),i.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},r.enabled=function(){return!!l},r.transportName="websocket",r.roundTrips=2,e.exports=r},{"../utils/event":46,"../utils/url":52,"./driver/websocket":19,"debug":void 0,"events":3,"inherits":54}],39:[function(t,e,n){"use strict";function r(t){if(!l.enabled)throw new Error("Transport created when disabled");o.call(this,t,"/xhr",a,l)}var i=t("inherits"),o=t("./lib/ajax-based"),s=t("./xdr-streaming"),a=t("./receiver/xhr"),l=t("./sender/xdr");i(r,o),r.enabled=s.enabled,r.transportName="xdr-polling",r.roundTrips=2,e.exports=r},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,"./xdr-streaming":40,"inherits":54}],40:[function(t,e,n){"use strict";function r(t){if(!a.enabled)throw new Error("Transport created when disabled");o.call(this,t,"/xhr_streaming",s,a)}var i=t("inherits"),o=t("./lib/ajax-based"),s=t("./receiver/xhr"),a=t("./sender/xdr");i(r,o),r.enabled=function(t){return!t.cookie_needed&&!t.nullOrigin&&(a.enabled&&t.sameScheme)},r.transportName="xdr-streaming",r.roundTrips=2,e.exports=r},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,"inherits":54}],41:[function(t,e,n){"use strict";function r(t){if(!l.enabled&&!a.enabled)throw new Error("Transport created when disabled");o.call(this,t,"/xhr",s,a)}var i=t("inherits"),o=t("./lib/ajax-based"),s=t("./receiver/xhr"),a=t("./sender/xhr-cors"),l=t("./sender/xhr-local");i(r,o),r.enabled=function(t){return!t.nullOrigin&&(!(!l.enabled||!t.sameOrigin)||a.enabled)},r.transportName="xhr-polling",r.roundTrips=2,e.exports=r},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,"inherits":54}],42:[function(t,e,n){(function(n){"use strict";function r(t){if(!l.enabled&&!a.enabled)throw new Error("Transport created when disabled");o.call(this,t,"/xhr_streaming",s,a)}var i=t("inherits"),o=t("./lib/ajax-based"),s=t("./receiver/xhr"),a=t("./sender/xhr-cors"),l=t("./sender/xhr-local"),u=t("../utils/browser");i(r,o),r.enabled=function(t){return!t.nullOrigin&&(!u.isOpera()&&a.enabled)},r.transportName="xhr-streaming",r.roundTrips=2,r.needBody=!!n.document,e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/browser":44,"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,"inherits":54}],43:[function(t,e,n){(function(t){"use strict";t.crypto&&t.crypto.getRandomValues?e.exports.randomBytes=function(e){var n=new Uint8Array(e);return t.crypto.getRandomValues(n),n}:e.exports.randomBytes=function(t){for(var e=new Array(t),n=0;n<t;n++)e[n]=Math.floor(256*Math.random());return e}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(t,e,n){(function(t){"use strict";e.exports={isOpera:function(){return t.navigator&&/opera/i.test(t.navigator.userAgent)},isKonqueror:function(){return t.navigator&&/konqueror/i.test(t.navigator.userAgent)},hasDomain:function(){if(!t.document)return!0;try{return!!t.document.domain}catch(t){return!1}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(t,e,n){"use strict";var r,i=t("json3"),o=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,s=function(t){var e,n={},r=[];for(e=0;e<65536;e++)r.push(String.fromCharCode(e));return t.lastIndex=0,r.join("").replace(t,function(t){return n[t]="\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4),""}),t.lastIndex=0,n};e.exports={quote:function(t){var e=i.stringify(t);return o.lastIndex=0,o.test(e)?(r||(r=s(o)),e.replace(o,function(t){return r[t]})):e}}},{"json3":55}],46:[function(t,e,n){(function(n){"use strict";var r=t("./random"),i={},o=!1,s=n.chrome&&n.chrome.app&&n.chrome.app.runtime;e.exports={attachEvent:function(t,e){void 0!==n.addEventListener?n.addEventListener(t,e,!1):n.document&&n.attachEvent&&(n.document.attachEvent("on"+t,e),n.attachEvent("on"+t,e))},detachEvent:function(t,e){void 0!==n.addEventListener?n.removeEventListener(t,e,!1):n.document&&n.detachEvent&&(n.document.detachEvent("on"+t,e),n.detachEvent("on"+t,e))},unloadAdd:function(t){if(s)return null;var e=r.string(8);return i[e]=t,o&&setTimeout(this.triggerUnloadCallbacks,0),e},unloadDel:function(t){t in i&&delete i[t]},triggerUnloadCallbacks:function(){for(var t in i)i[t](),delete i[t]}};var a=function(){o||(o=!0,e.exports.triggerUnloadCallbacks())};s||e.exports.attachEvent("unload",a)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./random":50}],47:[function(t,e,n){(function(n){"use strict";var r=t("./event"),i=t("json3"),o=t("./browser");e.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){e.exports.WPrefix in n||(n[e.exports.WPrefix]={})},postMessage:function(t,r){n.parent!==n&&n.parent.postMessage(i.stringify({windowId:e.exports.currentWindowId,type:t,data:r||""}),"*")},createIframe:function(t,e){var i,o,s=n.document.createElement("iframe"),a=function(){clearTimeout(i);try{s.onload=null}catch(t){}s.onerror=null},l=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),r.unloadDel(o))},u=function(t){s&&(l(),e(t))},c=function(t,e){try{setTimeout(function(){s&&s.contentWindow&&s.contentWindow.postMessage(t,e)},0)}catch(t){}};return s.src=t,s.style.display="none",s.style.position="absolute",s.onerror=function(){u("onerror")},s.onload=function(){clearTimeout(i),i=setTimeout(function(){u("onload timeout")},2e3)},n.document.body.appendChild(s),i=setTimeout(function(){u("timeout")},15e3),o=r.unloadAdd(l),{post:c,cleanup:l,loaded:a}},createHtmlfile:function(t,i){var o,s,a,l=["Active"].concat("Object").join("X"),u=new n[l]("htmlfile"),c=function(){clearTimeout(o),a.onerror=null},f=function(){u&&(c(),r.unloadDel(s),a.parentNode.removeChild(a),a=u=null,CollectGarbage())},h=function(t){u&&(f(),i(t))},d=function(t,e){try{setTimeout(function(){a&&a.contentWindow&&a.contentWindow.postMessage(t,e)},0)}catch(t){}};u.open(),u.write('<html><script>document.domain="'+n.document.domain+'";<\/script></html>'),u.close(),u.parentWindow[e.exports.WPrefix]=n[e.exports.WPrefix];var p=u.createElement("div");return u.body.appendChild(p),a=u.createElement("iframe"),p.appendChild(a),a.src=t,a.onerror=function(){h("onerror")},o=setTimeout(function(){h("timeout")},15e3),s=r.unloadAdd(f),{post:d,cleanup:f,loaded:c}}},e.exports.iframeEnabled=!1,n.document&&(e.exports.iframeEnabled=("function"==typeof n.postMessage||"object"==typeof n.postMessage)&&!o.isKonqueror())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./browser":44,"./event":46,"debug":void 0,"json3":55}],48:[function(t,e,n){(function(t){"use strict";var n={};["log","debug","warn"].forEach(function(e){var r;try{r=t.console&&t.console[e]&&t.console[e].apply}catch(t){}n[e]=r?function(){return t.console[e].apply(t.console,arguments)}:"log"===e?function(){}:n.log}),e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(t,e,n){"use strict";e.exports={isObject:function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},extend:function(t){if(!this.isObject(t))return t;for(var e,n,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}}},{}],50:[function(t,e,n){"use strict";var r=t("crypto"),i="abcdefghijklmnopqrstuvwxyz012345";e.exports={string:function(t){for(var e=i.length,n=r.randomBytes(t),o=[],s=0;s<t;s++)o.push(i.substr(n[s]%e,1));return o.join("")},number:function(t){return Math.floor(Math.random()*t)},numberString:function(t){var e=(""+(t-1)).length;return(new Array(e+1).join("0")+this.number(t)).slice(-e)}}},{"crypto":43}],51:[function(t,e,n){"use strict";e.exports=function(t){return{filterToEnabled:function(e,n){var r={main:[],facade:[]};return e?"string"==typeof e&&(e=[e]):e=[],t.forEach(function(t){if(t&&("websocket"!==t.transportName||!1!==n.websocket))return e.length&&-1===e.indexOf(t.transportName)?void t.transportName:void(t.enabled(n)?(t.transportName,r.main.push(t),t.facadeTransport&&r.facade.push(t.facadeTransport)):t.transportName)}),r}}}},{"debug":void 0}],52:[function(t,e,n){"use strict";var r=t("url-parse");e.exports={getOrigin:function(t){if(!t)return null;var e=new r(t);if("file:"===e.protocol)return null;var n=e.port;return n||(n="https:"===e.protocol?"443":"80"),e.protocol+"//"+e.hostname+":"+n},isOriginEqual:function(t,e){var n=this.getOrigin(t)===this.getOrigin(e);return n},isSchemeEqual:function(t,e){return t.split(":")[0]===e.split(":")[0]},addPath:function(t,e){var n=t.split("?");return n[0]+e+(n[1]?"?"+n[1]:"")},addQuery:function(t,e){return t+(-1===t.indexOf("?")?"?"+e:"&"+e)}}},{"debug":void 0,"url-parse":58}],53:[function(t,e,n){e.exports="1.1.4"},{}],54:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],55:[function(e,n,r){(function(e){(function(){function i(t,e){function n(t){if(n[t]!==m)return n[t];var i;if("bug-string-char-index"==t)i="a"!="a"[0];else if("json"==t)i=n("json-stringify")&&n("json-parse");else{var s,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==t){var l=e.stringify,c="function"==typeof l&&g;if(c){(s=function(){return 1}).toJSON=s;try{c="0"===l(0)&&"0"===l(new r)&&'""'==l(new o)&&l(y)===m&&l(m)===m&&l()===m&&"1"===l(s)&&"[1]"==l([s])&&"[null]"==l([m])&&"null"==l(null)&&"[null,null,null]"==l([m,y,null])&&l({"a":[s,!0,!1,null,"\0\b\n\f\r\t"]})==a&&"1"===l(null,s)&&"[\n 1,\n 2\n]"==l([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==l(new u(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==l(new u(864e13))&&'"-000001-01-01T00:00:00.000Z"'==l(new u(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==l(new u(-1))}catch(t){c=!1}}i=c}if("json-parse"==t){var f=e.parse;if("function"==typeof f)try{if(0===f("0")&&!f(!1)){s=f(a);var h=5==s.a.length&&1===s.a[0];if(h){try{h=!f('"\t"')}catch(t){}if(h)try{h=1!==f("01")}catch(t){}if(h)try{h=1!==f("1.")}catch(t){}}}}catch(t){h=!1}i=h}}return n[t]=!!i}t||(t=l.Object()),e||(e=l.Object());var r=t.Number||l.Number,o=t.String||l.String,a=t.Object||l.Object,u=t.Date||l.Date,c=t.SyntaxError||l.SyntaxError,f=t.TypeError||l.TypeError,h=t.Math||l.Math,d=t.JSON||l.JSON;"object"==typeof d&&d&&(e.stringify=d.stringify,e.parse=d.parse);var p,v,m,b=a.prototype,y=b.toString,g=new u(-0xc782b5b800cec);try{g=-109252==g.getUTCFullYear()&&0===g.getUTCMonth()&&1===g.getUTCDate()&&10==g.getUTCHours()&&37==g.getUTCMinutes()&&6==g.getUTCSeconds()&&708==g.getUTCMilliseconds()}catch(t){}if(!n("json")){var w=n("bug-string-char-index");if(!g)var x=h.floor,_=[0,31,59,90,120,151,181,212,243,273,304,334],E=function(t,e){return _[e]+365*(t-1970)+x((t-1969+(e=+(e>1)))/4)-x((t-1901+e)/100)+x((t-1601+e)/400)};if((p=b.hasOwnProperty)||(p=function(t){var e,n={};return(n.__proto__=null,n.__proto__={"toString":1},n).toString!=y?p=function(t){var e=this.__proto__,n=t in(this.__proto__=null,this);return this.__proto__=e,n}:(e=n.constructor,p=function(t){var n=(this.constructor||e).prototype;return t in this&&!(t in n&&this[t]===n[t])}),n=null,p.call(this,t)}),v=function(t,e){var n,r,i,o=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,r=new n;for(i in r)p.call(r,i)&&o++;return n=r=null,o?v=2==o?function(t,e){var n,r={},i="[object Function]"==y.call(t);for(n in t)i&&"prototype"==n||p.call(r,n)||!(r[n]=1)||!p.call(t,n)||e(n)}:function(t,e){var n,r,i="[object Function]"==y.call(t);for(n in t)i&&"prototype"==n||!p.call(t,n)||(r="constructor"===n)||e(n);(r||p.call(t,n="constructor"))&&e(n)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],v=function(t,e){var n,i,o="[object Function]"==y.call(t),a=!o&&"function"!=typeof t.constructor&&s[typeof t.hasOwnProperty]&&t.hasOwnProperty||p;for(n in t)o&&"prototype"==n||!a.call(t,n)||e(n);for(i=r.length;n=r[--i];a.call(t,n)&&e(n));}),v(t,e)},!n("json-stringify")){var j={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},S=function(t,e){return("000000"+(e||0)).slice(-t)},T=function(t){for(var e='"',n=0,r=t.length,i=!w||r>10,o=i&&(w?t.split(""):t);n<r;n++){var s=t.charCodeAt(n);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=j[s];break;default:if(s<32){e+="\\u00"+S(2,s.toString(16));break}e+=i?o[n]:t.charAt(n)}}return e+'"'},O=function(t,e,n,r,i,o,s){var a,l,u,c,h,d,b,g,w,_,j,C,N,A,k,I;try{a=e[t]}catch(t){}if("object"==typeof a&&a)if("[object Date]"!=(l=y.call(a))||p.call(a,"toJSON"))"function"==typeof a.toJSON&&("[object Number]"!=l&&"[object String]"!=l&&"[object Array]"!=l||p.call(a,"toJSON"))&&(a=a.toJSON(t));else if(a>-1/0&&a<1/0){if(E){for(h=x(a/864e5),u=x(h/365.2425)+1970-1;E(u+1,0)<=h;u++);for(c=x((h-E(u,0))/30.42);E(u,c+1)<=h;c++);h=1+h-E(u,c),d=(a%864e5+864e5)%864e5,b=x(d/36e5)%24,g=x(d/6e4)%60,w=x(d/1e3)%60,_=d%1e3}else u=a.getUTCFullYear(),c=a.getUTCMonth(),h=a.getUTCDate(),b=a.getUTCHours(),g=a.getUTCMinutes(),w=a.getUTCSeconds(),_=a.getUTCMilliseconds();a=(u<=0||u>=1e4?(u<0?"-":"+")+S(6,u<0?-u:u):S(4,u))+"-"+S(2,c+1)+"-"+S(2,h)+"T"+S(2,b)+":"+S(2,g)+":"+S(2,w)+"."+S(3,_)+"Z"}else a=null;if(n&&(a=n.call(e,t,a)),null===a)return"null";if("[object Boolean]"==(l=y.call(a)))return""+a;if("[object Number]"==l)return a>-1/0&&a<1/0?""+a:"null";if("[object String]"==l)return T(""+a);if("object"==typeof a){for(A=s.length;A--;)if(s[A]===a)throw f();if(s.push(a),j=[],k=o,o+=i,"[object Array]"==l){for(N=0,A=a.length;N<A;N++)C=O(N,a,n,r,i,o,s),j.push(C===m?"null":C);I=j.length?i?"[\n"+o+j.join(",\n"+o)+"\n"+k+"]":"["+j.join(",")+"]":"[]"}else v(r||a,function(t){var e=O(t,a,n,r,i,o,s);e!==m&&j.push(T(t)+":"+(i?" ":"")+e)}),I=j.length?i?"{\n"+o+j.join(",\n"+o)+"\n"+k+"}":"{"+j.join(",")+"}":"{}";return s.pop(),I}};e.stringify=function(t,e,n){var r,i,o,a;if(s[typeof e]&&e)if("[object Function]"==(a=y.call(e)))i=e;else if("[object Array]"==a){o={};for(var l,u=0,c=e.length;u<c;l=e[u++],("[object String]"==(a=y.call(l))||"[object Number]"==a)&&(o[l]=1));}if(n)if("[object Number]"==(a=y.call(n))){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else"[object String]"==a&&(r=n.length<=10?n:n.slice(0,10));return O("",(l={},l[""]=t,l),i,o,r,"",[])}}if(!n("json-parse")){var C,N,A=o.fromCharCode,k={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},I=function(){throw C=N=null,c()},P=function(){for(var t,e,n,r,i,o=N,s=o.length;C<s;)switch(i=o.charCodeAt(C)){case 9:case 10:case 13:case 32:C++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=w?o.charAt(C):o[C],C++,t;case 34:for(t="@",C++;C<s;)if((i=o.charCodeAt(C))<32)I();else if(92==i)switch(i=o.charCodeAt(++C)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=k[i],C++;break;case 117:for(e=++C,n=C+4;C<n;C++)(i=o.charCodeAt(C))>=48&&i<=57||i>=97&&i<=102||i>=65&&i<=70||I();t+=A("0x"+o.slice(e,C));break;default:I()}else{if(34==i)break;for(i=o.charCodeAt(C),e=C;i>=32&&92!=i&&34!=i;)i=o.charCodeAt(++C);t+=o.slice(e,C)}if(34==o.charCodeAt(C))return C++,t;I();default:if(e=C,45==i&&(r=!0,i=o.charCodeAt(++C)),i>=48&&i<=57){for(48==i&&(i=o.charCodeAt(C+1))>=48&&i<=57&&I(),r=!1;C<s&&(i=o.charCodeAt(C))>=48&&i<=57;C++);if(46==o.charCodeAt(C)){for(n=++C;n<s&&(i=o.charCodeAt(n))>=48&&i<=57;n++);n==C&&I(),C=n}if(101==(i=o.charCodeAt(C))||69==i){for(i=o.charCodeAt(++C),43!=i&&45!=i||C++,n=C;n<s&&(i=o.charCodeAt(n))>=48&&i<=57;n++);n==C&&I(),C=n}return+o.slice(e,C)}if(r&&I(),"true"==o.slice(C,C+4))return C+=4,!0;if("false"==o.slice(C,C+5))return C+=5,!1;if("null"==o.slice(C,C+4))return C+=4,null;I()}return"$"},L=function(t){var e,n;if("$"==t&&I(),"string"==typeof t){if("@"==(w?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];"]"!=(t=P());n||(n=!0))n&&(","==t?"]"==(t=P())&&I():I()),","==t&&I(),e.push(L(t));return e}if("{"==t){for(e={};"}"!=(t=P());n||(n=!0))n&&(","==t?"}"==(t=P())&&I():I()),","!=t&&"string"==typeof t&&"@"==(w?t.charAt(0):t[0])&&":"==P()||I(),e[t.slice(1)]=L(P());return e}I()}return t},R=function(t,e,n){var r=U(t,e,n);r===m?delete t[e]:t[e]=r},U=function(t,e,n){var r,i=t[e];if("object"==typeof i&&i)if("[object Array]"==y.call(i))for(r=i.length;r--;)R(i,r,n);else v(i,function(t){R(i,t,n)});return n.call(t,e,i)};e.parse=function(t,e){var n,r;return C=0,N=""+t,n=L(P()),"$"!=P()&&I(),C=N=null,e&&"[object Function]"==y.call(e)?U((r={},r[""]=n,r),"",e):n}}}return e.runInContext=i,e}var o="function"==typeof t&&t.amd,s={"function":!0,"object":!0},a=s[typeof r]&&r&&!r.nodeType&&r,l=s[typeof window]&&window||this,u=a&&s[typeof n]&&n&&!n.nodeType&&"object"==typeof e&&e;if(!u||u.global!==u&&u.window!==u&&u.self!==u||(l=u),a&&!o)i(l,a);else{var c=l.JSON,f=l.JSON3,h=!1,d=i(l,l.JSON3={"noConflict":function(){return h||(h=!0,l.JSON=c,l.JSON3=f,c=f=null),d}});l.JSON={"parse":d.parse,"stringify":d.stringify}}o&&t(function(){return d})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(t,e,n){"use strict";function r(t){for(var e,n=/([^=?&]+)=?([^&]*)/g,r={};e=n.exec(t);r[decodeURIComponent(e[1])]=decodeURIComponent(e[2]));return r}function i(t,e){e=e||"";var n=[];"string"!=typeof e&&(e="?");for(var r in t)o.call(t,r)&&n.push(encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return n.length?e+n.join("&"):""}var o=Object.prototype.hasOwnProperty;n.stringify=i,n.parse=r},{}],57:[function(t,e,n){"use strict";e.exports=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t}},{}],58:[function(t,e,n){"use strict";function r(t){var e=f.exec(t);return{protocol:e[1]?e[1].toLowerCase():"",slashes:!!e[2],rest:e[3]}}function i(t,e){for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),r=n.length,i=n[r-1],o=!1,s=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),s++):s&&(0===r&&(o=!0),n.splice(r,1),s--);return o&&n.unshift(""),"."!==i&&".."!==i||n.push(""),n.join("/")}function o(t,e,n){if(!(this instanceof o))return new o(t,e,n);var s,a,f,d,p,v,m=h.slice(),b=typeof e,y=this,g=0;for("object"!==b&&"string"!==b&&(n=e,e=null),n&&"function"!=typeof n&&(n=c.parse),e=u(e),a=r(t||""),s=!a.protocol&&!a.slashes,y.slashes=a.slashes||s&&e.slashes,y.protocol=a.protocol||e.protocol||"",t=a.rest,a.slashes||(m[2]=[/(.*)/,"pathname"]);g<m.length;g++)d=m[g],f=d[0],v=d[1],f!==f?y[v]=t:"string"==typeof f?~(p=t.indexOf(f))&&("number"==typeof d[2]?(y[v]=t.slice(0,p),t=t.slice(p+d[2])):(y[v]=t.slice(p),t=t.slice(0,p))):(p=f.exec(t))&&(y[v]=p[1],t=t.slice(0,p.index)),y[v]=y[v]||(s&&d[3]?e[v]||"":""),d[4]&&(y[v]=y[v].toLowerCase());n&&(y.query=n(y.query)),s&&e.slashes&&"/"!==y.pathname.charAt(0)&&(""!==y.pathname||""!==e.pathname)&&(y.pathname=i(y.pathname,e.pathname)),l(y.port,y.protocol)||(y.host=y.hostname,y.port=""),y.username=y.password="",y.auth&&(d=y.auth.split(":"),y.username=d[0]||"",y.password=d[1]||""),y.origin=y.protocol&&y.host&&"file:"!==y.protocol?y.protocol+"//"+y.host:"null",y.href=y.toString()}function s(t,e,n){var r=this;switch(t){case"query":"string"==typeof e&&e.length&&(e=(n||c.parse)(e)),r[t]=e;break;case"port":r[t]=e,l(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[t]="");break;case"hostname":r[t]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[t]=e,/:\d+$/.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!n;break;case"pathname":r.pathname=e.length&&"/"!==e.charAt(0)?"/"+e:e;break;default:r[t]=e}for(var i=0;i<h.length;i++){var o=h[i];o[4]&&(r[o[1]]=r[o[1]].toLowerCase())}return r.origin=r.protocol&&r.host&&"file:"!==r.protocol?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function a(t){t&&"function"==typeof t||(t=c.stringify);var e,n=this,r=n.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var i=r+(n.slashes?"//":"");return n.username&&(i+=n.username,n.password&&(i+=":"+n.password),i+="@"),i+=n.host+n.pathname,e="object"==typeof n.query?t(n.query):n.query,e&&(i+="?"!==e.charAt(0)?"?"+e:e),n.hash&&(i+=n.hash),i}var l=t("requires-port"),u=t("./lolcation"),c=t("querystringify"),f=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,h=[["#","hash"],["?","query"],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]];o.prototype={set:s,toString:a},o.extractProtocol=r,o.location=u,o.qs=c,e.exports=o},{"./lolcation":59,"querystringify":56,"requires-port":57}],59:[function(t,e,n){(function(n){"use strict";var r,i=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,o={hash:1,query:1};e.exports=function(e){e=e||n.location||{},r=r||t("./");var s,a={},l=typeof e;if("blob:"===e.protocol)a=new r(unescape(e.pathname),{});else if("string"===l){a=new r(e,{});for(s in o)delete a[s]}else if("object"===l){for(s in e)s in o||(a[s]=e[s]);void 0===a.slashes&&(a.slashes=i.test(e.href))}return a}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./":58}]},{},[1])(1)});

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.webstomp=t():e.webstomp=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e){var t=encodeURIComponent(e),n=t.replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}),r=Array.prototype.map.call(n,function(e){return e.charCodeAt(0)});return new Uint8Array(r)}function a(e){var t=String.fromCharCode.apply(String,r(e)),n=t.replace(/(.)/g,function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n});return decodeURIComponent(n)}function o(e){return e?encodeURIComponent(e).match(/%..|./g).length:0}function s(){return(new Date).getTime()+"-"+Math.floor(1e3*Math.random())}Object.defineProperty(t,"__esModule",{value:!0}),t.unicodeStringToTypedArray=i,t.typedArrayToUnicodeString=a,t.sizeOfUTF8=o,t.createId=s;t.VERSIONS={V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.2,1.1,1.0"},supportedProtocols:function(){return["v10.stomp","v11.stomp","v12.stomp"]}},t.BYTES={LF:"\n",NULL:"\0"},t.trim=function(e){return e.replace(/^\s+|\s+$/g,"")}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),s=function(e){return e&&e.__esModule?e:{default:e}}(o),u=n(0),c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e);var i=n.binary,a=void 0!==i&&i,o=n.heartbeat,s=void 0===o?{outgoing:1e4,incoming:1e4}:o,u=n.debug,c=void 0===u||u;this.ws=t,this.ws.binaryType="arraybuffer",this.isBinary=!!a,this.hasDebug=!!c,this.connected=!1,this.heartbeat=s||{outgoing:0,incoming:0},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}return a(e,[{key:"debug",value:function(){var e;this.hasDebug&&(e=console).log.apply(e,arguments)}},{key:"connect",value:function(){var e=this,t=this._parseConnect.apply(this,arguments),n=i(t,3),r=n[0],a=n[1],o=n[2];this.connectCallback=a,this.debug("Opening Web Socket..."),this.ws.onmessage=function(t){var n=t.data;if(t.data instanceof ArrayBuffer&&(n=(0,u.typedArrayToUnicodeString)(new Uint8Array(t.data))),e.serverActivity=Date.now(),n===u.BYTES.LF)return void e.debug("<<< PONG");e.debug("<<< "+n);var r=s.default.unmarshall(e.partialData+n);e.partialData=r.partial,r.frames.forEach(function(t){switch(t.command){case"CONNECTED":e.debug("connected to server "+t.headers.server),e.connected=!0,e.version=t.headers.version,e._setupHeartbeat(t.headers),a&&a(t);break;case"MESSAGE":var n=t.headers.subscription,r=e.subscriptions[n]||e.onreceive;if(r){var i=e.version===u.VERSIONS.V1_2&&t.headers.ack||t.headers["message-id"];t.ack=e.ack.bind(e,i,n),t.nack=e.nack.bind(e,i,n),r(t)}else e.debug("Unhandled received MESSAGE: "+t);break;case"RECEIPT":e.onreceipt&&e.onreceipt(t);break;case"ERROR":o&&o(t);break;default:e.debug("Unhandled frame: "+t)}})},this.ws.onclose=function(t){e.debug("Whoops! Lost connection to "+e.ws.url+":",{event:t}),e._cleanUp(),o&&o(t)},this.ws.onopen=function(){e.debug("Web Socket Opened..."),r["accept-version"]=u.VERSIONS.supportedVersions(),r["heart-beat"]||(r["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(",")),e._transmit("CONNECT",r)}}},{key:"disconnect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),e&&e()}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},n);r.destination=e,this._transmit("SEND",r,t)}},{key:"begin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"tx-"+(0,u.createId)();return this._transmit("BEGIN",{transaction:e}),{id:e,commit:this.commit.bind(this,e),abort:this.abort.bind(this,e)}}},{key:"commit",value:function(e){this._transmit("COMMIT",{transaction:e})}},{key:"abort",value:function(e){this._transmit("ABORT",{transaction:e})}},{key:"ack",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},n);r[this.version===u.VERSIONS.V1_2?"id":"message-id"]=e,r.subscription=t,this._transmit("ACK",r)}},{key:"nack",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},n);r[this.version===u.VERSIONS.V1_2?"id":"message-id"]=e,r.subscription=t,this._transmit("NACK",r)}},{key:"subscribe",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},n);return r.id||(r.id="sub-"+(0,u.createId)()),r.destination=e,this.subscriptions[r.id]=t,this._transmit("SUBSCRIBE",r),{id:r.id,unsubscribe:this.unsubscribe.bind(this,r.id)}}},{key:"unsubscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.assign({},t);delete this.subscriptions[e],n.id=e,this._transmit("UNSUBSCRIBE",n)}},{key:"_cleanUp",value:function(){this.connected=!1,clearInterval(this.pinger),clearInterval(this.ponger)}},{key:"_transmit",value:function(e,t,n){var r=s.default.marshall(e,t,n);this.debug(">>> "+r,{frame:{command:e,headers:t,body:n}}),this._wsSend(r)}},{key:"_wsSend",value:function(e){for(this.isBinary&&(e=(0,u.unicodeStringToTypedArray)(e)),this.debug(">>> length "+e.length);;){if(!(e.length>this.maxWebSocketFrameSize))return this.ws.send(e);this.ws.send(e.slice(0,this.maxWebSocketFrameSize)),e=e.slice(this.maxWebSocketFrameSize),this.debug("remaining = "+e.length)}}},{key:"_setupHeartbeat",value:function(e){var t=this;if(this.version===u.VERSIONS.V1_1||this.version===u.VERSIONS.V1_2){var n=(e["heart-beat"]||"0,0").split(",").map(function(e){return parseInt(e,10)}),r=i(n,2),a=r[0],o=r[1];if(0!==this.heartbeat.outgoing&&0!==o){var s=Math.max(this.heartbeat.outgoing,o);this.debug("send PING every "+s+"ms"),this.pinger=setInterval(function(){t._wsSend(u.BYTES.LF),t.debug(">>> PING")},s)}if(0!==this.heartbeat.incoming&&0!==a){var c=Math.max(this.heartbeat.incoming,a);this.debug("check PONG every "+c+"ms"),this.ponger=setInterval(function(){var e=Date.now()-t.serverActivity;e>2*c&&(t.debug("did not receive server activity for the last "+e+"ms"),t.ws.close())},c)}}}},{key:"_parseConnect",value:function(){for(var e={},t=void 0,n=void 0,r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];switch(i.length){case 2:e=i[0],t=i[1];break;case 3:i[1]instanceof Function?(e=i[0],t=i[1],n=i[2]):(e.login=i[0],e.passcode=i[1],t=i[2]);break;case 4:e.login=i[0],e.passcode=i[1],t=i[2],n=i[3];break;default:e.login=i[0],e.passcode=i[1],t=i[2],n=i[3],e.host=i[4]}return[e,t,n]}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),o=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";r(this,e),this.command=t,this.headers=n,this.body=i}return i(e,[{key:"toString",value:function(){var e=this,t=[this.command],n=!1===this.headers["content-length"];return n&&delete this.headers["content-length"],Object.keys(this.headers).forEach(function(n){var r=e.headers[n];t.push(n+":"+r)}),this.body&&!n&&t.push("content-length:"+(0,a.sizeOfUTF8)(this.body)),t.push(a.BYTES.LF+this.body),t.join(a.BYTES.LF)}}],[{key:"unmarshallSingle",value:function(t){var n=t.search(new RegExp(a.BYTES.LF+a.BYTES.LF)),r=t.substring(0,n).split(a.BYTES.LF),i=r.shift(),o={},s="",u=n+2,c=!0,l=!1,h=void 0;try{for(var d,f=r.reverse()[Symbol.iterator]();!(c=(d=f.next()).done);c=!0){var v=d.value,p=v.indexOf(":");o[(0,a.trim)(v.substring(0,p))]=(0,a.trim)(v.substring(p+1))}}catch(e){l=!0,h=e}finally{try{!c&&f.return&&f.return()}finally{if(l)throw h}}if(o["content-length"]){s=(""+t).substring(u,u+parseInt(o["content-length"],10))}else for(var b=null,g=u;g<t.length&&(b=t.charAt(g))!==a.BYTES.NULL;g++)s+=b;return new e(i,o,s)}},{key:"unmarshall",value:function(t){var n=t.split(new RegExp(a.BYTES.NULL+a.BYTES.LF+"*")),r=n.slice(0,-1),i=n.slice(-1)[0],o={frames:r.map(function(t){return e.unmarshallSingle(t)}),partial:""};return i===a.BYTES.LF||-1!==i.search(RegExp(a.BYTES.NULL+a.BYTES.LF+"*$"))?o.frames.push(e.unmarshallSingle(i)):o.partial=i,o}},{key:"marshall",value:function(t,n,r){return new e(t,n,r).toString()+a.BYTES.NULL}}]),e}();t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=n(0),o={VERSIONS:a.VERSIONS,client:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new WebSocket(e,t.protocols||a.VERSIONS.supportedProtocols());return new i.default(n,t)},over:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(i.default,[null].concat(t)))}};t.default=o,e.exports=t.default}])});

(function(){var k,u,z,A,B,m,C,x=[].slice,D={}.hasOwnProperty,E=function(e,c){function l(){this.constructor=e}for(var h in c)D.call(c,h)&&(e[h]=c[h]);l.prototype=c.prototype;e.prototype=new l;e.__super__=c.prototype;return e};m=function(){};u=function(){function e(){}e.prototype.addEventListener=e.prototype.on;e.prototype.on=function(c,e){this._callbacks=this._callbacks||{};this._callbacks[c]||(this._callbacks[c]=[]);this._callbacks[c].push(e);return this};e.prototype.emit=function(){var c,e,h,a,b;e=arguments[0];c=2<=arguments.length?x.call(arguments,1):[];this._callbacks=this._callbacks||{};if(h=this._callbacks[e])for(a=0,b=h.length;a<b;a++)e=h[a],e.apply(this,c);return this};e.prototype.removeListener=e.prototype.off;e.prototype.removeAllListeners=e.prototype.off;e.prototype.removeEventListener=e.prototype.off;e.prototype.off=function(c,e){var h,a,b,d,f;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;a=this._callbacks[c];if(!a)return this;if(1===arguments.length)return delete this._callbacks[c],this;b=d=0;for(f=a.length;d<f;b=++d)if(h=a[b],h===e){a.splice(b,1);break}return this};return e}();k=function(e){function c(a,b){var d,f,g;this.element=a;this.version=c.version;this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,"");this.clickableElements=[];this.listeners=[];this.files=[];"string"===typeof this.element&&(this.element=document.querySelector(this.element));if(!this.element||null==this.element.nodeType)throw Error("Invalid dropzone element.");if(this.element.dropzone)throw Error("Dropzone already attached.");c.instances.push(this);this.element.dropzone=this;d=null!=(g=c.optionsForElement(this.element))?g:{};this.options=l({},this.defaultOptions,d,null!=b?b:{});if(this.options.forceFallback||!c.isBrowserSupported())return this.options.fallback.call(this);null==this.options.url&&(this.options.url=this.element.getAttribute("action"));if(!this.options.url)throw Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes);this.options.method=this.options.method.toUpperCase();(f=this.getExistingFallback())&&f.parentNode&&f.parentNode.removeChild(f);!1!==this.options.previewsContainer&&(this.previewsContainer=this.options.previewsContainer?c.getElement(this.options.previewsContainer,"previewsContainer"):this.element);this.options.clickable&&(this.clickableElements=!0===this.options.clickable?[this.element]:c.getElements(this.options.clickable,"clickable"));this.init()}var l,h;E(c,e);c.prototype.Emitter=u;c.prototype.events="drop dragstart dragend dragenter dragover dragleave addedfile addedfiles removedfile thumbnail error errormultiple processing processingmultiple uploadprogress totaluploadprogress sending sendingmultiple success successmultiple canceled canceledmultiple complete completemultiple reset maxfilesexceeded maxfilesreached queuecomplete".split(" ");c.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1E3,maxFiles:null,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,hiddenInputContainer:"body",capture:null,renameFilename:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(a,b){return b()},init:function(){return m},forceFallback:!1,fallback:function(){var a,b,d,f,g;this.element.className=""+this.element.className+" dz-browser-not-supported";g=this.element.getElementsByTagName("div");d=0;for(f=g.length;d<f;d++)a=g[d],/(^| )dz-message($| )/.test(a.className)&&(b=a,a.className="dz-message");b||(b=c.createElement('\x3cdiv class\x3d"dz-message"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e'),this.element.appendChild(b));if(a=b.getElementsByTagName("span")[0])null!=a.textContent?a.textContent=this.options.dictFallbackMessage:null!=a.innerText&&(a.innerText=this.options.dictFallbackMessage);return this.element.appendChild(this.getFallbackForm())},resize:function(a){var b,d,f;b={srcX:0,srcY:0,srcWidth:a.width,srcHeight:a.height};d=a.width/a.height;b.optWidth=this.options.thumbnailWidth;b.optHeight=this.options.thumbnailHeight;null==b.optWidth&&null==b.optHeight?(b.optWidth=b.srcWidth,b.optHeight=b.srcHeight):null==b.optWidth?b.optWidth=d*b.optHeight:null==b.optHeight&&(b.optHeight=1/d*b.optWidth);f=b.optWidth/b.optHeight;a.height<b.optHeight||a.width<b.optWidth?(b.trgHeight=b.srcHeight,b.trgWidth=b.srcWidth):d>f?(b.srcHeight=a.height,b.srcWidth=b.srcHeight*f):(b.srcWidth=a.width,b.srcHeight=b.srcWidth/f);b.srcX=(a.width-b.srcWidth)/2;b.srcY=(a.height-b.srcHeight)/2;return b},drop:function(a){return this.element.classList.remove("dz-drag-hover")},dragstart:m,dragend:function(a){return this.element.classList.remove("dz-drag-hover")},dragenter:function(a){return this.element.classList.add("dz-drag-hover")},dragover:function(a){return this.element.classList.add("dz-drag-hover")},dragleave:function(a){return this.element.classList.remove("dz-drag-hover")},paste:m,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(a){var b,d,f,g,n,r;this.element===this.previewsContainer&&this.element.classList.add("dz-started");if(this.previewsContainer){a.previewElement=c.createElement(this.options.previewTemplate.trim());a.previewTemplate=a.previewElement;this.previewsContainer.appendChild(a.previewElement);g=a.previewElement.querySelectorAll("[data-dz-name]");d=0;for(f=g.length;d<f;d++)b=g[d],b.textContent=this._renameFilename(a.name);g=a.previewElement.querySelectorAll("[data-dz-size]");d=0;for(f=g.length;d<f;d++)b=g[d],b.innerHTML=this.filesize(a.size);this.options.addRemoveLinks&&(a._removeLink=c.createElement('\x3ca class\x3d"dz-remove" href\x3d"javascript:undefined;" data-dz-remove\x3e'+this.options.dictRemoveFile+"\x3c/a\x3e"),a.previewElement.appendChild(a._removeLink));b=function(b){return function(d){d.preventDefault();d.stopPropagation();return a.status===c.UPLOADING?c.confirm(b.options.dictCancelUploadConfirmation,function(){return b.removeFile(a)}):b.options.dictRemoveFileConfirmation?c.confirm(b.options.dictRemoveFileConfirmation,function(){return b.removeFile(a)}):b.removeFile(a)}}(this);n=a.previewElement.querySelectorAll("[data-dz-remove]");r=[];f=0;for(g=n.length;f<g;f++)d=n[f],r.push(d.addEventListener("click",b));return r}},removedfile:function(a){var b;a.previewElement&&null!=(b=a.previewElement)&&b.parentNode.removeChild(a.previewElement);return this._updateMaxFilesReachedClass()},thumbnail:function(a,b){var d,f,c,n;if(a.previewElement){a.previewElement.classList.remove("dz-file-preview");n=a.previewElement.querySelectorAll("[data-dz-thumbnail]");f=0;for(c=n.length;f<c;f++)d=n[f],d.alt=a.name,d.src=b;return setTimeout(function(b){return function(){return a.previewElement.classList.add("dz-image-preview")}}(this),1)}},error:function(a,b){var d,f,c,n,r;if(a.previewElement){a.previewElement.classList.add("dz-error");"String"!==typeof b&&b.error&&(b=b.error);n=a.previewElement.querySelectorAll("[data-dz-errormessage]");r=[];f=0;for(c=n.length;f<c;f++)d=n[f],r.push(d.textContent=b);return r}},errormultiple:m,processing:function(a){if(a.previewElement&&(a.previewElement.classList.add("dz-processing"),a._removeLink))return a._removeLink.textContent=this.options.dictCancelUpload},processingmultiple:m,uploadprogress:function(a,b,d){var c,g,n;if(a.previewElement){g=a.previewElement.querySelectorAll("[data-dz-uploadprogress]");n=[];d=0;for(c=g.length;d<c;d++)a=g[d],"PROGRESS"===a.nodeName?n.push(a.value=b):n.push(a.style.width=""+b+"%");return n}},totaluploadprogress:m,sending:m,sendingmultiple:m,success:function(a){if(a.previewElement)return a.previewElement.classList.add("dz-success")},successmultiple:m,canceled:function(a){return this.emit("error",a,"Upload canceled.")},canceledmultiple:m,complete:function(a){a._removeLink&&(a._removeLink.textContent=this.options.dictRemoveFile);if(a.previewElement)return a.previewElement.classList.add("dz-complete")},completemultiple:m,maxfilesexceeded:m,maxfilesreached:m,queuecomplete:m,addedfiles:m,previewTemplate:'\x3cdiv class\x3d"dz-preview dz-file-preview"\x3e\n  \x3cdiv class\x3d"dz-image"\x3e\x3cimg data-dz-thumbnail /\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"dz-details"\x3e\n    \x3cdiv class\x3d"dz-size"\x3e\x3cspan data-dz-size\x3e\x3c/span\x3e\x3c/div\x3e\n    \x3cdiv class\x3d"dz-filename"\x3e\x3cspan data-dz-name\x3e\x3c/span\x3e\x3c/div\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"dz-progress"\x3e\x3cspan class\x3d"dz-upload" data-dz-uploadprogress\x3e\x3c/span\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"dz-error-message"\x3e\x3cspan data-dz-errormessage\x3e\x3c/span\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"dz-success-mark"\x3e\n    \x3csvg width\x3d"54px" height\x3d"54px" viewBox\x3d"0 0 54 54" version\x3d"1.1" xmlns\x3d"http://www.w3.org/2000/svg" xmlns:xlink\x3d"http://www.w3.org/1999/xlink" xmlns:sketch\x3d"http://www.bohemiancoding.com/sketch/ns"\x3e\n      \x3ctitle\x3eCheck\x3c/title\x3e\n      \x3cdefs\x3e\x3c/defs\x3e\n      \x3cg id\x3d"Page-1" stroke\x3d"none" stroke-width\x3d"1" fill\x3d"none" fill-rule\x3d"evenodd" sketch:type\x3d"MSPage"\x3e\n        \x3cpath d\x3d"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id\x3d"Oval-2" stroke-opacity\x3d"0.198794158" stroke\x3d"#747474" fill-opacity\x3d"0.816519475" fill\x3d"#FFFFFF" sketch:type\x3d"MSShapeGroup"\x3e\x3c/path\x3e\n      \x3c/g\x3e\n    \x3c/svg\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"dz-error-mark"\x3e\n    \x3csvg width\x3d"54px" height\x3d"54px" viewBox\x3d"0 0 54 54" version\x3d"1.1" xmlns\x3d"http://www.w3.org/2000/svg" xmlns:xlink\x3d"http://www.w3.org/1999/xlink" xmlns:sketch\x3d"http://www.bohemiancoding.com/sketch/ns"\x3e\n      \x3ctitle\x3eError\x3c/title\x3e\n      \x3cdefs\x3e\x3c/defs\x3e\n      \x3cg id\x3d"Page-1" stroke\x3d"none" stroke-width\x3d"1" fill\x3d"none" fill-rule\x3d"evenodd" sketch:type\x3d"MSPage"\x3e\n        \x3cg id\x3d"Check-+-Oval-2" sketch:type\x3d"MSLayerGroup" stroke\x3d"#747474" stroke-opacity\x3d"0.198794158" fill\x3d"#FFFFFF" fill-opacity\x3d"0.816519475"\x3e\n          \x3cpath d\x3d"M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id\x3d"Oval-2" sketch:type\x3d"MSShapeGroup"\x3e\x3c/path\x3e\n        \x3c/g\x3e\n      \x3c/g\x3e\n    \x3c/svg\x3e\n  \x3c/div\x3e\n\x3c/div\x3e'};l=function(){var a,b,d,c,g,n,r;c=arguments[0];d=2<=arguments.length?x.call(arguments,1):[];n=0;for(r=d.length;n<r;n++)for(a in b=d[n],b)g=b[a],c[a]=g;return c};c.prototype.getAcceptedFiles=function(){var a,b,d,c,g;c=this.files;g=[];b=0;for(d=c.length;b<d;b++)a=c[b],a.accepted&&g.push(a);return g};c.prototype.getRejectedFiles=function(){var a,b,d,c,g;c=this.files;g=[];b=0;for(d=c.length;b<d;b++)a=c[b],a.accepted||g.push(a);return g};c.prototype.getFilesWithStatus=function(a){var b,d,c,g,n;g=this.files;n=[];d=0;for(c=g.length;d<c;d++)b=g[d],b.status===a&&n.push(b);return n};c.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(c.QUEUED)};c.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(c.UPLOADING)};c.prototype.getAddedFiles=function(){return this.getFilesWithStatus(c.ADDED)};c.prototype.getActiveFiles=function(){var a,b,d,f,g;f=this.files;g=[];b=0;for(d=f.length;b<d;b++)a=f[b],a.status!==c.UPLOADING&&a.status!==c.QUEUED||g.push(a);return g};c.prototype.init=function(){var a,b,d,f,g,n;"form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data");this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(c.createElement('\x3cdiv class\x3d"dz-default dz-message"\x3e\x3cspan\x3e'+this.options.dictDefaultMessage+"\x3c/span\x3e\x3c/div\x3e"));this.clickableElements.length&&(d=function(a){return function(){a.hiddenFileInput&&a.hiddenFileInput.parentNode.removeChild(a.hiddenFileInput);a.hiddenFileInput=document.createElement("input");a.hiddenFileInput.setAttribute("type","file");(null==a.options.maxFiles||1<a.options.maxFiles)&&a.hiddenFileInput.setAttribute("multiple","multiple");a.hiddenFileInput.className="dz-hidden-input";null!=a.options.acceptedFiles&&a.hiddenFileInput.setAttribute("accept",a.options.acceptedFiles);null!=a.options.capture&&a.hiddenFileInput.setAttribute("capture",a.options.capture);a.hiddenFileInput.style.visibility="hidden";a.hiddenFileInput.style.position="absolute";a.hiddenFileInput.style.top="0";a.hiddenFileInput.style.left="0";a.hiddenFileInput.style.height="0";a.hiddenFileInput.style.width="0";document.querySelector(a.options.hiddenInputContainer).appendChild(a.hiddenFileInput);return a.hiddenFileInput.addEventListener("change",function(){var b,c,f,g;c=a.hiddenFileInput.files;if(c.length)for(f=0,g=c.length;f<g;f++)b=c[f],a.addFile(b);a.emit("addedfiles",c);return d()})}}(this),d());this.URL=null!=(a=window.URL)?a:window.webkitURL;n=this.events;f=0;for(g=n.length;f<g;f++)a=n[f],this.on(a,this.options[a]);this.on("uploadprogress",function(a){return function(){return a.updateTotalUploadProgress()}}(this));this.on("removedfile",function(a){return function(){return a.updateTotalUploadProgress()}}(this));this.on("canceled",function(a){return function(b){return a.emit("complete",b)}}(this));this.on("complete",function(a){return function(b){if(0===a.getAddedFiles().length&&0===a.getUploadingFiles().length&&0===a.getQueuedFiles().length)return setTimeout(function(){return a.emit("queuecomplete")},0)}}(this));b=function(a){a.stopPropagation();return a.preventDefault?a.preventDefault():a.returnValue=!1};this.listeners=[{element:this.element,events:{dragstart:function(a){return function(b){return a.emit("dragstart",b)}}(this),dragenter:function(a){return function(d){b(d);return a.emit("dragenter",d)}}(this),dragover:function(a){return function(d){var c;try{c=d.dataTransfer.effectAllowed}catch(f){}d.dataTransfer.dropEffect="move"===c||"linkMove"===c?"move":"copy";b(d);return a.emit("dragover",d)}}(this),dragleave:function(a){return function(b){return a.emit("dragleave",b)}}(this),drop:function(a){return function(d){b(d);return a.drop(d)}}(this),dragend:function(a){return function(b){return a.emit("dragend",b)}}(this)}}];this.clickableElements.forEach(function(a){return function(b){return a.listeners.push({element:b,events:{click:function(d){(b!==a.element||d.target===a.element||c.elementInside(d.target,a.element.querySelector(".dz-message")))&&a.hiddenFileInput.click();return!0}}})}}(this));this.enable();return this.options.init.call(this)};c.prototype.destroy=function(){var a;this.disable();this.removeAllFiles(!0);null!=(a=this.hiddenFileInput)&&a.parentNode&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null);delete this.element.dropzone;return c.instances.splice(c.instances.indexOf(this),1)};c.prototype.updateTotalUploadProgress=function(){var a,b,d,c,g,n;b=d=0;if(this.getActiveFiles().length){n=this.getActiveFiles();c=0;for(g=n.length;c<g;c++)a=n[c],d+=a.upload.bytesSent,b+=a.upload.total;a=100*d/b}else a=100;return this.emit("totaluploadprogress",a,b,d)};c.prototype._getParamName=function(a){return"function"===typeof this.options.paramName?this.options.paramName(a):""+this.options.paramName+(this.options.uploadMultiple?"["+a+"]":"")};c.prototype._renameFilename=function(a){return"function"!==typeof this.options.renameFilename?a:this.options.renameFilename(a)};c.prototype.getFallbackForm=function(){var a,b;if(a=this.getExistingFallback())return a;a='\x3cdiv class\x3d"dz-fallback"\x3e';this.options.dictFallbackText&&(a+="\x3cp\x3e"+this.options.dictFallbackText+"\x3c/p\x3e");a+='\x3cinput type\x3d"file" name\x3d"'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple\x3d"multiple"':void 0)+' /\x3e\x3cinput type\x3d"submit" value\x3d"Upload!"\x3e\x3c/div\x3e';a=c.createElement(a);"FORM"!==this.element.tagName?(b=c.createElement('\x3cform action\x3d"'+this.options.url+'" enctype\x3d"multipart/form-data" method\x3d"'+this.options.method+'"\x3e\x3c/form\x3e'),b.appendChild(a)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method));return null!=b?b:a};c.prototype.getExistingFallback=function(){var a,b,d,c,g;b=function(a){var b,d,c;d=0;for(c=a.length;d<c;d++)if(b=a[d],/(^| )fallback($| )/.test(b.className))return b};g=["div","form"];d=0;for(c=g.length;d<c;d++)if(a=g[d],a=b(this.element.getElementsByTagName(a)))return a};c.prototype.setupEventListeners=function(){var a,b,d,c,g,n,e;n=this.listeners;e=[];c=0;for(g=n.length;c<g;c++)a=n[c],e.push(function(){var c,f;c=a.events;f=[];for(b in c)d=c[b],f.push(a.element.addEventListener(b,d,!1));return f}());return e};c.prototype.removeEventListeners=function(){var a,b,c,f,g,e,h;e=this.listeners;h=[];f=0;for(g=e.length;f<g;f++)a=e[f],h.push(function(){var f,g;f=a.events;g=[];for(b in f)c=f[b],g.push(a.element.removeEventListener(b,c,!1));return g}());return h};c.prototype.disable=function(){var a,b,c,f,g;this.clickableElements.forEach(function(a){return a.classList.remove("dz-clickable")});this.removeEventListeners();f=this.files;g=[];b=0;for(c=f.length;b<c;b++)a=f[b],g.push(this.cancelUpload(a));return g};c.prototype.enable=function(){this.clickableElements.forEach(function(a){return a.classList.add("dz-clickable")});return this.setupEventListeners()};c.prototype.filesize=function(a){var b,c,f,g,e,h,l,q;f=0;g="b";if(0<a){h=["TB","GB","MB","KB","b"];c=l=0;for(q=h.length;l<q;c=++l)if(e=h[c],b=Math.pow(this.options.filesizeBase,4-c)/10,a>=b){f=a/Math.pow(this.options.filesizeBase,4-c);g=e;break}f=Math.round(10*f)/10}return"\x3cstrong\x3e"+f+"\x3c/strong\x3e "+g};c.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")};c.prototype.drop=function(a){var b;a.dataTransfer&&(this.emit("drop",a),b=a.dataTransfer.files,this.emit("addedfiles",b),b.length&&((a=a.dataTransfer.items)&&a.length&&null!=a[0].webkitGetAsEntry?this._addFilesFromItems(a):this.handleFiles(b)))};c.prototype.paste=function(a){var b;if(null!=(null!=a?null!=(b=a.clipboardData)?b.items:void 0:void 0)&&(this.emit("paste",a),a=a.clipboardData.items,a.length))return this._addFilesFromItems(a)};c.prototype.handleFiles=function(a){var b,c,f,g;g=[];c=0;for(f=a.length;c<f;c++)b=a[c],g.push(this.addFile(b));return g};c.prototype._addFilesFromItems=function(a){var b,c,f,g,e;e=[];f=0;for(g=a.length;f<g;f++)c=a[f],null!=c.webkitGetAsEntry&&(b=c.webkitGetAsEntry())?b.isFile?e.push(this.addFile(c.getAsFile())):b.isDirectory?e.push(this._addFilesFromDirectory(b,b.name)):e.push(void 0):null!=c.getAsFile?null==c.kind||"file"===c.kind?e.push(this.addFile(c.getAsFile())):e.push(void 0):e.push(void 0);return e};c.prototype._addFilesFromDirectory=function(a,b){var c,f,g;c=a.createReader();f=function(a){return"undefined"!==typeof console&&null!==console?"function"===typeof console.log?console.log(a):void 0:void 0};g=function(a){return function(){return c.readEntries(function(c){var d,f,e;if(0<c.length){f=0;for(e=c.length;f<e;f++)d=c[f],d.isFile?d.file(function(c){if(!a.options.ignoreHiddenFiles||"."!==c.name.substring(0,1))return c.fullPath=""+b+"/"+c.name,a.addFile(c)}):d.isDirectory&&a._addFilesFromDirectory(d,""+b+"/"+d.name);g()}return null},f)}}(this);return g()};c.prototype.accept=function(a,b){return a.size>1048576*this.options.maxFilesize?b(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(a.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):c.isValidFile(a,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(b(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",a)):this.options.accept.call(this,a,b):b(this.options.dictInvalidFileType)};c.prototype.addFile=function(a){a.upload={progress:0,total:a.size,bytesSent:0};this.files.push(a);a.status=c.ADDED;this.emit("addedfile",a);this._enqueueThumbnail(a);return this.accept(a,function(b){return function(c){c?(a.accepted=!1,b._errorProcessing([a],c)):(a.accepted=!0,b.options.autoQueue&&b.enqueueFile(a));return b._updateMaxFilesReachedClass()}}(this))};c.prototype.enqueueFiles=function(a){var b,c,f;c=0;for(f=a.length;c<f;c++)b=a[c],this.enqueueFile(b);return null};c.prototype.enqueueFile=function(a){if(a.status===c.ADDED&&!0===a.accepted){if(a.status=c.QUEUED,this.options.autoProcessQueue)return setTimeout(function(a){return function(){return a.processQueue()}}(this),0)}else throw Error("This file can't be queued because it has already been processed or was rejected.");};c.prototype._thumbnailQueue=[];c.prototype._processingThumbnail=!1;c.prototype._enqueueThumbnail=function(a){if(this.options.createImageThumbnails&&a.type.match(/image.*/)&&a.size<=1048576*this.options.maxThumbnailFilesize)return this._thumbnailQueue.push(a),setTimeout(function(a){return function(){return a._processThumbnailQueue()}}(this),0)};c.prototype._processThumbnailQueue=function(){if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(a){return function(){a._processingThumbnail=!1;return a._processThumbnailQueue()}}(this))};c.prototype.removeFile=function(a){a.status===c.UPLOADING&&this.cancelUpload(a);this.files=C(this.files,a);this.emit("removedfile",a);if(0===this.files.length)return this.emit("reset")};c.prototype.removeAllFiles=function(a){var b,d,f,g;null==a&&(a=!1);g=this.files.slice();d=0;for(f=g.length;d<f;d++)b=g[d],(b.status!==c.UPLOADING||a)&&this.removeFile(b);return null};c.prototype.createThumbnail=function(a,b){var c;c=new FileReader;c.onload=function(f){return function(){if("image/svg+xml"===a.type)f.emit("thumbnail",a,c.result),null!=b&&b();else return f.createThumbnailFromUrl(a,c.result,b)}}(this);return c.readAsDataURL(a)};c.prototype.createThumbnailFromUrl=function(a,b,c,f){var g;g=document.createElement("img");f&&(g.crossOrigin=f);g.onload=function(b){return function(){var f,e,h,l,k,m,t;a.width=g.width;a.height=g.height;h=b.options.resize.call(b,a);null==h.trgWidth&&(h.trgWidth=h.optWidth);null==h.trgHeight&&(h.trgHeight=h.optHeight);f=document.createElement("canvas");e=f.getContext("2d");f.width=h.trgWidth;f.height=h.trgHeight;B(e,g,null!=(l=h.srcX)?l:0,null!=(k=h.srcY)?k:0,h.srcWidth,h.srcHeight,null!=(m=h.trgX)?m:0,null!=(t=h.trgY)?t:0,h.trgWidth,h.trgHeight);f=f.toDataURL("image/png");b.emit("thumbnail",a,f);if(null!=c)return c()}}(this);null!=c&&(g.onerror=c);return g.src=b};c.prototype.processQueue=function(){var a,b,c,f;b=this.options.parallelUploads;a=c=this.getUploadingFiles().length;if(!(c>=b)&&(f=this.getQueuedFiles(),0<f.length)){if(this.options.uploadMultiple)return this.processFiles(f.slice(0,b-c));for(;a<b&&f.length;)this.processFile(f.shift()),a++}};c.prototype.processFile=function(a){return this.processFiles([a])};c.prototype.processFiles=function(a){var b,d,f;d=0;for(f=a.length;d<f;d++)b=a[d],b.processing=!0,b.status=c.UPLOADING,this.emit("processing",b);this.options.uploadMultiple&&this.emit("processingmultiple",a);return this.uploadFiles(a)};c.prototype._getFilesWithXhr=function(a){var b,c,f,g,e;g=this.files;e=[];c=0;for(f=g.length;c<f;c++)b=g[c],b.xhr===a&&e.push(b);return e};c.prototype.cancelUpload=function(a){var b,d,f,g;if(a.status===c.UPLOADING){d=this._getFilesWithXhr(a.xhr);f=0;for(g=d.length;f<g;f++)b=d[f],b.status=c.CANCELED;a.xhr.abort();a=0;for(f=d.length;a<f;a++)b=d[a],this.emit("canceled",b);this.options.uploadMultiple&&this.emit("canceledmultiple",d)}else if((b=a.status)===c.ADDED||b===c.QUEUED)a.status=c.CANCELED,this.emit("canceled",a),this.options.uploadMultiple&&this.emit("canceledmultiple",[a]);if(this.options.autoProcessQueue)return this.processQueue()};h=function(){var a,b;b=arguments[0];a=2<=arguments.length?x.call(arguments,1):[];return"function"===typeof b?b.apply(this,a):b};c.prototype.uploadFile=function(a){return this.uploadFiles([a])};c.prototype.uploadFiles=function(a){var b,d,f,g,e,k,m,q,v,w,u,t,p,x,y;p=new XMLHttpRequest;e=0;for(t=a.length;e<t;e++)b=a[e],b.xhr=p;e=h(this.options.method,a);t=h(this.options.url,a);p.open(e,t,!0);p.withCredentials=!!this.options.withCredentials;w=null;f=function(c){return function(){var d,f,e;e=[];d=0;for(f=a.length;d<f;d++)b=a[d],e.push(c._errorProcessing(a,w||c.options.dictResponseError.replace("{{statusCode}}",p.status),p));return e}}(this);u=function(c){return function(d){var f,e,g;if(null!=d)for(f=100*d.loaded/d.total,e=0,g=a.length;e<g;e++)b=a[e],b.upload={progress:f,total:d.total,bytesSent:d.loaded};else{d=!0;f=100;e=0;for(g=a.length;e<g;e++){b=a[e];if(100!==b.upload.progress||b.upload.bytesSent!==b.upload.total)d=!1;b.upload.progress=f;b.upload.bytesSent=b.upload.total}if(d)return}g=[];d=0;for(e=a.length;d<e;d++)b=a[d],g.push(c.emit("uploadprogress",b,f,b.upload.bytesSent));return g}}(this);p.onload=function(b){return function(d){var e;if(a[0].status!==c.CANCELED&&4===p.readyState){w=p.responseText;if(p.getResponseHeader("content-type")&&~p.getResponseHeader("content-type").indexOf("application/json"))try{w=JSON.parse(w)}catch(g){d=g,w="Invalid JSON response from server."}u();return 200<=(e=p.status)&&300>e?b._finished(a,w,d):f()}}}(this);p.onerror=function(b){return function(){if(a[0].status!==c.CANCELED)return f()}}(this);(null!=(g=p.upload)?g:p).onprogress=u;e={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"};this.options.headers&&l(e,this.options.headers);for(d in e)(g=e[d])&&p.setRequestHeader(d,g);d=new FormData;if(this.options.params)for(q in e=this.options.params,e)g=e[q],d.append(q,g);q=0;for(g=a.length;q<g;q++)b=a[q],this.emit("sending",b,p,d);this.options.uploadMultiple&&this.emit("sendingmultiple",a,p,d);if("FORM"===this.element.tagName)for(t=this.element.querySelectorAll("input, textarea, select, button"),g=0,e=t.length;g<e;g++)if(m=t[g],q=m.getAttribute("name"),v=m.getAttribute("type"),"SELECT"===m.tagName&&m.hasAttribute("multiple"))for(y=m.options,v=0,x=y.length;v<x;v++)m=y[v],m.selected&&d.append(q,m.value);else(!v||"checkbox"!==(k=v.toLowerCase())&&"radio"!==k||m.checked)&&d.append(q,m.value);k=q=0;for(g=a.length-1;0<=g?q<=g:q>=g;k=0<=g?++q:--q)d.append(this._getParamName(k),a[k],this._renameFilename(a[k].name));return this.submitRequest(p,d,a)};c.prototype.submitRequest=function(a,b,c){return a.send(b)};c.prototype._finished=function(a,b,d){var f,e,h;e=0;for(h=a.length;e<h;e++)f=a[e],f.status=c.SUCCESS,this.emit("success",f,b,d),this.emit("complete",f);this.options.uploadMultiple&&(this.emit("successmultiple",a,b,d),this.emit("completemultiple",a));if(this.options.autoProcessQueue)return this.processQueue()};c.prototype._errorProcessing=function(a,b,d){var e,g,h;g=0;for(h=a.length;g<h;g++)e=a[g],e.status=c.ERROR,this.emit("error",e,b,d),this.emit("complete",e);this.options.uploadMultiple&&(this.emit("errormultiple",a,b,d),this.emit("completemultiple",a));if(this.options.autoProcessQueue)return this.processQueue()};return c}(u);k.version="4.3.0";k.options={};k.optionsForElement=function(e){if(e.getAttribute("id"))return k.options[z(e.getAttribute("id"))]};k.instances=[];k.forElement=function(e){"string"===typeof e&&(e=document.querySelector(e));if(null==(null!=e?e.dropzone:void 0))throw Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return e.dropzone};k.autoDiscover=!0;k.discover=function(){var e,c,l,h,a;document.querySelectorAll?c=document.querySelectorAll(".dropzone"):(c=[],e=function(a){var d,e,g,h;h=[];e=0;for(g=a.length;e<g;e++)d=a[e],/(^| )dropzone($| )/.test(d.className)?h.push(c.push(d)):h.push(void 0);return h},e(document.getElementsByTagName("div")),e(document.getElementsByTagName("form")));a=[];l=0;for(h=c.length;l<h;l++)e=c[l],!1!==k.optionsForElement(e)?a.push(new k(e)):a.push(void 0);return a};k.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i];k.isBrowserSupported=function(){var e,c,l,h,a;e=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(a=k.blacklistedBrowsers,l=0,h=a.length;l<h;l++)c=a[l],c.test(navigator.userAgent)&&(e=!1);else e=!1;else e=!1;return e};C=function(e,c){var l,h,a,b;b=[];h=0;for(a=e.length;h<a;h++)l=e[h],l!==c&&b.push(l);return b};z=function(e){return e.replace(/[\-_](\w)/g,function(c){return c.charAt(1).toUpperCase()})};k.createElement=function(e){var c;c=document.createElement("div");c.innerHTML=e;return c.childNodes[0]};k.elementInside=function(e,c){if(e===c)return!0;for(;e=e.parentNode;)if(e===c)return!0;return!1};k.getElement=function(e,c){var l;"string"===typeof e?l=document.querySelector(e):null!=e.nodeType&&(l=e);if(null==l)throw Error("Invalid `"+c+"` option provided. Please provide a CSS selector or a plain HTML element.");return l};k.getElements=function(e,c){var l,h,a,b,d;if(e instanceof Array){h=[];try{for(a=0,b=e.length;a<b;a++)l=e[a],h.push(this.getElement(l,c))}catch(f){h=null}}else if("string"===typeof e)for(h=[],d=document.querySelectorAll(e),a=0,b=d.length;a<b;a++)l=d[a],h.push(l);else null!=e.nodeType&&(h=[e]);if(null==h||!h.length)throw Error("Invalid `"+c+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return h};k.confirm=function(e,c,l){if(window.confirm(e))return c();if(null!=l)return l()};k.isValidFile=function(e,c){var l,h,a,b,d;if(!c)return!0;c=c.split(",");h=e.type;l=h.replace(/\/.*$/,"");b=0;for(d=c.length;b<d;b++)if(a=c[b],a=a.trim(),"."===a.charAt(0)){if(-1!==e.name.toLowerCase().indexOf(a.toLowerCase(),e.name.length-a.length))return!0}else if(/\/\*$/.test(a)){if(l===a.replace(/\/.*$/,""))return!0}else if(h===a)return!0;return!1};"undefined"!==typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(e){return this.each(function(){return new k(this,e)})});"undefined"!==typeof module&&null!==module?module.exports=k:window.Dropzone=k;k.ADDED="added";k.QUEUED="queued";k.ACCEPTED=k.QUEUED;k.UPLOADING="uploading";k.PROCESSING=k.UPLOADING;k.CANCELED="canceled";k.ERROR="error";k.SUCCESS="success";A=function(e){var c,l,h,a,b;h=e.naturalHeight;c=document.createElement("canvas");c.width=1;c.height=h;c=c.getContext("2d");c.drawImage(e,0,0);c=c.getImageData(0,0,1,h).data;b=0;for(a=l=h;a>b;)e=c[4*(a-1)+3],0===e?l=a:b=a,a=l+b>>1;h=a/h;return 0===h?1:h};B=function(e,c,l,h,a,b,d,f,g,k){var m;m=A(c);return e.drawImage(c,l,h,a,b,d,f,g,k/m)};k._autoDiscoverFunction=function(){if(k.autoDiscover)return k.discover()};(function(e,c){var l,h,a,b,d,f,g,k,m;a=!1;m=!0;h=e.document;k=h.documentElement;l=h.addEventListener?"addEventListener":"attachEvent";g=h.addEventListener?"removeEventListener":"detachEvent";f=h.addEventListener?"":"on";b=function(d){if("readystatechange"!==d.type||"complete"===h.readyState)if(("load"===d.type?e:h)[g](f+d.type,b,!1),!a&&(a=!0))return c.call(e,d.type||d)};d=function(){try{k.doScroll("left")}catch(a){setTimeout(d,50);return}return b("poll")};if("complete"!==h.readyState){if(h.createEventObject&&k.doScroll){try{m=!e.frameElement}catch(u){}m&&d()}h[l](f+"DOMContentLoaded",b,!1);h[l](f+"readystatechange",b,!1);return e[l](f+"load",b,!1)}})(window,k._autoDiscoverFunction)}).call(this);

function Queue(){var a=[],b=0;this.getLength=function(){return a.length-b};this.isEmpty=function(){return 0==a.length};this.enqueue=function(b){a.push(b)};this.dequeue=function(){if(0!=a.length){var c=a[b];2*++b>=a.length&&(a=a.slice(b),b=0);return c}};this.peek=function(){return 0<a.length?a[b]:void 0}};

(function(){var t=function(){this.init()};t.prototype={init:function(){var a=this||c;a._counter=1E3;a._html5AudioPool=[];a.html5PoolSize=10;a._codecs={};a._howls=[];a._muted=!1;a._volume=1;a._canPlayEvent="canplaythrough";a._navigator="undefined"!==typeof window&&window.navigator?window.navigator:null;a.masterGain=null;a.noAudio=!1;a.usingWebAudio=!0;a.autoSuspend=!0;a.ctx=null;a.autoUnlock=!0;a._setup();return a},volume:function(a){var b=this||c;a=parseFloat(a);b.ctx||u();if("undefined"!==typeof a&&0<=a&&1>=a){b._volume=a;if(b._muted)return b;b.usingWebAudio&&b.masterGain.gain.setValueAtTime(a,c.ctx.currentTime);for(var g=0;g<b._howls.length;g++)if(!b._howls[g]._webAudio)for(var d=b._howls[g]._getSoundIds(),f=0;f<d.length;f++){var h=b._howls[g]._soundById(d[f]);h&&h._node&&(h._node.volume=h._volume*a)}return b}return b._volume},mute:function(a){var b=this||c;b.ctx||u();b._muted=a;b.usingWebAudio&&b.masterGain.gain.setValueAtTime(a?0:b._volume,c.ctx.currentTime);for(var g=0;g<b._howls.length;g++)if(!b._howls[g]._webAudio)for(var d=b._howls[g]._getSoundIds(),f=0;f<d.length;f++){var h=b._howls[g]._soundById(d[f]);h&&h._node&&(h._node.muted=a?!0:h._muted)}return b},stop:function(){for(var a=this||c,b=0;b<a._howls.length;b++)a._howls[b].stop();return a},unload:function(){for(var a=this||c,b=a._howls.length-1;0<=b;b--)a._howls[b].unload();a.usingWebAudio&&a.ctx&&"undefined"!==typeof a.ctx.close&&(a.ctx.close(),a.ctx=null,u());return a},codecs:function(a){return(this||c)._codecs[a.replace(/^x-/,"")]},_setup:function(){var a=this||c;a.state=a.ctx?a.ctx.state||"suspended":"suspended";a._autoSuspend();if(!a.usingWebAudio)if("undefined"!==typeof Audio)try{var b=new Audio;"undefined"===typeof b.oncanplaythrough&&(a._canPlayEvent="canplay")}catch(g){a.noAudio=!0}else a.noAudio=!0;try{b=new Audio,b.muted&&(a.noAudio=!0)}catch(g){}a.noAudio||a._setupCodecs();return a},_setupCodecs:function(){var a=this||c,b=null;try{b="undefined"!==typeof Audio?new Audio:null}catch(d){return a}if(!b||"function"!==typeof b.canPlayType)return a;var g=b.canPlayType("audio/mpeg;").replace(/^no$/,""),v=a._navigator&&a._navigator.userAgent.match(/OPR\/([0-6].)/g),v=v&&33>parseInt(v[0].split("/")[1],10);a._codecs={mp3:!(v||!g&&!b.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!g,opus:!!b.canPlayType('audio/ogg; codecs\x3d"opus"').replace(/^no$/,""),ogg:!!b.canPlayType('audio/ogg; codecs\x3d"vorbis"').replace(/^no$/,""),oga:!!b.canPlayType('audio/ogg; codecs\x3d"vorbis"').replace(/^no$/,""),wav:!!(b.canPlayType('audio/wav; codecs\x3d"1"')||b.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!b.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!b.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/m4a;")||b.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(b.canPlayType("audio/x-m4b;")||b.canPlayType("audio/m4b;")||b.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(b.canPlayType("audio/x-mp4;")||b.canPlayType("audio/mp4;")||b.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!b.canPlayType('audio/webm; codecs\x3d"vorbis"').replace(/^no$/,""),webm:!!b.canPlayType('audio/webm; codecs\x3d"vorbis"').replace(/^no$/,""),dolby:!!b.canPlayType('audio/mp4; codecs\x3d"ec-3"').replace(/^no$/,""),flac:!!(b.canPlayType("audio/x-flac;")||b.canPlayType("audio/flac;")).replace(/^no$/,"")};return a},_unlockAudio:function(){var a=this||c;if(!a._audioUnlocked&&a.ctx){a._audioUnlocked=!1;a.autoUnlock=!1;a._mobileUnloaded||44100===a.ctx.sampleRate||(a._mobileUnloaded=!0,a.unload());a._scratchBuffer=a.ctx.createBuffer(1,1,22050);var b=function(g){for(;a._html5AudioPool.length<a.html5PoolSize;)try{var c=new Audio;c._unlocked=!0;a._releaseHtml5Audio(c)}catch(d){a.noAudio=!0;break}for(g=0;g<a._howls.length;g++)if(!a._howls[g]._webAudio)for(var c=a._howls[g]._getSoundIds(),f=0;f<c.length;f++){var h=a._howls[g]._soundById(c[f]);h&&h._node&&!h._node._unlocked&&(h._node._unlocked=!0,h._node.load())}a._autoResume();var k=a.ctx.createBufferSource();k.buffer=a._scratchBuffer;k.connect(a.ctx.destination);"undefined"===typeof k.start?k.noteOn(0):k.start(0);"function"===typeof a.ctx.resume&&a.ctx.resume();k.onended=function(){k.disconnect(0);a._audioUnlocked=!0;document.removeEventListener("touchstart",b,!0);document.removeEventListener("touchend",b,!0);document.removeEventListener("click",b,!0);for(var c=0;c<a._howls.length;c++)a._howls[c]._emit("unlock")}};document.addEventListener("touchstart",b,!0);document.addEventListener("touchend",b,!0);document.addEventListener("click",b,!0);return a}},_obtainHtml5Audio:function(){var a=this||c;if(a._html5AudioPool.length)return a._html5AudioPool.pop();(a=(new Audio).play())&&"undefined"!==typeof Promise&&(a instanceof Promise||"function"===typeof a.then)&&a["catch"](function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")});return new Audio},_releaseHtml5Audio:function(a){var b=this||c;a._unlocked&&b._html5AudioPool.push(a);return b},_autoSuspend:function(){var a=this;if(a.autoSuspend&&a.ctx&&"undefined"!==typeof a.ctx.suspend&&c.usingWebAudio){for(var b=0;b<a._howls.length;b++)if(a._howls[b]._webAudio)for(var g=0;g<a._howls[b]._sounds.length;g++)if(!a._howls[b]._sounds[g]._paused)return a;a._suspendTimer&&clearTimeout(a._suspendTimer);a._suspendTimer=setTimeout(function(){if(a.autoSuspend){a._suspendTimer=null;a.state="suspending";var b=function(){a.state="suspended";a._resumeAfterSuspend&&(delete a._resumeAfterSuspend,a._autoResume())};a.ctx.suspend().then(b,b)}},3E4);return a}},_autoResume:function(){var a=this;if(a.ctx&&"undefined"!==typeof a.ctx.resume&&c.usingWebAudio)return"running"===a.state&&"interrupted"!==a.ctx.state&&a._suspendTimer?(clearTimeout(a._suspendTimer),a._suspendTimer=null):"suspended"===a.state||"running"===a.state&&"interrupted"===a.ctx.state?(a.ctx.resume().then(function(){a.state="running";for(var b=0;b<a._howls.length;b++)a._howls[b]._emit("resume")}),a._suspendTimer&&(clearTimeout(a._suspendTimer),a._suspendTimer=null)):"suspending"===a.state&&(a._resumeAfterSuspend=!0),a}};var c=new t,d=function(a){a.src&&0!==a.src.length?this.init(a):console.error("An array of source files must be passed with any new Howl.")};d.prototype={init:function(a){var b=this;c.ctx||u();b._autoplay=a.autoplay||!1;b._format="string"!==typeof a.format?a.format:[a.format];b._html5=a.html5||!1;b._muted=a.mute||!1;b._loop=a.loop||!1;b._pool=a.pool||5;b._preload="boolean"===typeof a.preload||"metadata"===a.preload?a.preload:!0;b._rate=a.rate||1;b._sprite=a.sprite||{};b._src="string"!==typeof a.src?a.src:[a.src];b._volume=void 0!==a.volume?a.volume:1;b._xhr={method:a.xhr&&a.xhr.method?a.xhr.method:"GET",headers:a.xhr&&a.xhr.headers?a.xhr.headers:null,withCredentials:a.xhr&&a.xhr.withCredentials?a.xhr.withCredentials:!1};b._duration=0;b._state="unloaded";b._sounds=[];b._endTimers={};b._queue=[];b._playLock=!1;b._onend=a.onend?[{fn:a.onend}]:[];b._onfade=a.onfade?[{fn:a.onfade}]:[];b._onload=a.onload?[{fn:a.onload}]:[];b._onloaderror=a.onloaderror?[{fn:a.onloaderror}]:[];b._onplayerror=a.onplayerror?[{fn:a.onplayerror}]:[];b._onpause=a.onpause?[{fn:a.onpause}]:[];b._onplay=a.onplay?[{fn:a.onplay}]:[];b._onstop=a.onstop?[{fn:a.onstop}]:[];b._onmute=a.onmute?[{fn:a.onmute}]:[];b._onvolume=a.onvolume?[{fn:a.onvolume}]:[];b._onrate=a.onrate?[{fn:a.onrate}]:[];b._onseek=a.onseek?[{fn:a.onseek}]:[];b._onunlock=a.onunlock?[{fn:a.onunlock}]:[];b._onresume=[];b._webAudio=c.usingWebAudio&&!b._html5;"undefined"!==typeof c.ctx&&c.ctx&&c.autoUnlock&&c._unlockAudio();c._howls.push(b);b._autoplay&&b._queue.push({event:"play",action:function(){b.play()}});b._preload&&"none"!==b._preload&&b.load();return b},load:function(){var a=null;if(c.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"===typeof this._src&&(this._src=[this._src]);for(var b=0;b<this._src.length;b++){var g,d;if(this._format&&this._format[b])g=this._format[b];else{d=this._src[b];if("string"!==typeof d){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(g=/^data:audio\/([^;,]+);/i.exec(d))||(g=/\.([^.]+)$/.exec(d.split("?",1)[0]));g&&(g=g[1].toLowerCase())}g||console.warn('No file extension was found. Consider using the "format" property or specify an extension.');if(g&&c.codecs(g)){a=this._src[b];break}}if(a)return this._src=a,this._state="loading","https:"===window.location.protocol&&"http:"===a.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new e(this),this._webAudio&&l(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(a,b){var g=this,d=null;if("number"===typeof a)d=a,a=null;else{if("string"===typeof a&&"loaded"===g._state&&!g._sprite[a])return null;if("undefined"===typeof a&&(a="__default",!g._playLock)){for(var f=0,h=0;h<g._sounds.length;h++)g._sounds[h]._paused&&!g._sounds[h]._ended&&(f++,d=g._sounds[h]._id);1===f?a=null:d=null}}var k=d?g._soundById(d):g._inactiveSound();if(!k)return null;d&&!a&&(a=k._sprite||"__default");if("loaded"!==g._state){k._sprite=a;k._ended=!1;var l=k._id;g._queue.push({event:"play",action:function(){g.play(l)}});return l}if(d&&!k._paused)return b||g._loadQueue("play"),k._id;g._webAudio&&c._autoResume();var e=Math.max(0,0<k._seek?k._seek:g._sprite[a][0]/1E3),m=Math.max(0,(g._sprite[a][0]+
g._sprite[a][1])/1E3-e),n=1E3*m/Math.abs(k._rate),p=g._sprite[a][0]/1E3,q=(g._sprite[a][0]+g._sprite[a][1])/1E3;k._sprite=a;k._ended=!1;var t=function(){k._paused=!1;k._seek=e;k._start=p;k._stop=q;k._loop=!(!k._loop&&!g._sprite[a][2])};if(e>=q)g._ended(k);else{var r=k._node;if(g._webAudio)d=function(){g._playLock=!1;t();g._refreshBuffer(k);r.gain.setValueAtTime(k._muted||g._muted?0:k._volume,c.ctx.currentTime);k._playStart=c.ctx.currentTime;"undefined"===typeof r.bufferSource.start?k._loop?r.bufferSource.noteGrainOn(0,e,86400):r.bufferSource.noteGrainOn(0,e,m):k._loop?r.bufferSource.start(0,e,86400):r.bufferSource.start(0,e,m);Infinity!==n&&(g._endTimers[k._id]=setTimeout(g._ended.bind(g,k),n));b||setTimeout(function(){g._emit("play",k._id);g._loadQueue()},0)},"running"===c.state&&"interrupted"!==c.ctx.state?d():(g._playLock=!0,g.once("resume",d),g._clearTimer(k._id));else{var u=function(){r.currentTime=e;r.muted=k._muted||g._muted||c._muted||r.muted;r.volume=k._volume*c.volume();r.playbackRate=k._rate;try{var d=r.play();d&&"undefined"!==typeof Promise&&(d instanceof Promise||"function"===typeof d.then)?(g._playLock=!0,t(),d.then(function(){g._playLock=!1;r._unlocked=!0;b||(g._emit("play",k._id),g._loadQueue())})["catch"](function(){g._playLock=!1;g._emit("playerror",k._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");k._ended=!0;k._paused=!0})):b||(g._playLock=!1,t(),g._emit("play",k._id),g._loadQueue());r.playbackRate=k._rate;r.paused?g._emit("playerror",k._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."):"__default"!==a||k._loop?g._endTimers[k._id]=setTimeout(g._ended.bind(g,k),n):(g._endTimers[k._id]=function(){g._ended(k);r.removeEventListener("ended",g._endTimers[k._id],!1)},r.addEventListener("ended",g._endTimers[k._id],!1))}catch(f){g._emit("playerror",k._id,f)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===r.src&&(r.src=g._src,r.load());d=window&&window.ejecta||!r.readyState&&c._navigator.isCocoonJS;if(3<=r.readyState||d)u();else{g._playLock=!0;var w=function(){u();r.removeEventListener(c._canPlayEvent,w,!1)};r.addEventListener(c._canPlayEvent,w,!1);g._clearTimer(k._id)}}return k._id}},pause:function(a,b){var c=this;if("loaded"!==c._state||c._playLock)return c._queue.push({event:"pause",action:function(){c.pause(a)}}),c;for(var d=c._getSoundIds(a),f=0;f<d.length;f++){c._clearTimer(d[f]);var h=c._soundById(d[f]);if(h&&!h._paused&&(h._seek=c.seek(d[f]),h._rateSeek=0,h._paused=!0,c._stopFade(d[f]),h._node))if(c._webAudio){if(!h._node.bufferSource)continue;"undefined"===typeof h._node.bufferSource.stop?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0);c._cleanBuffer(h._node)}else isNaN(h._node.duration)&&Infinity!==h._node.duration||h._node.pause();b||c._emit("pause",h?h._id:null)}return c},stop:function(a,b){var c=this;if("loaded"!==c._state||c._playLock)return c._queue.push({event:"stop",action:function(){c.stop(a)}}),c;for(var d=c._getSoundIds(a),f=0;f<d.length;f++){c._clearTimer(d[f]);var h=c._soundById(d[f]);h&&(h._seek=h._start||0,h._rateSeek=0,h._paused=!0,h._ended=!0,c._stopFade(d[f]),h._node&&(c._webAudio?h._node.bufferSource&&("undefined"===typeof h._node.bufferSource.stop?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0),c._cleanBuffer(h._node)):isNaN(h._node.duration)&&Infinity!==h._node.duration||(h._node.currentTime=h._start||0,h._node.pause(),Infinity===h._node.duration&&c._clearSound(h._node))),b||c._emit("stop",h._id))}return c},mute:function(a,b){var g=this;if("loaded"!==g._state||g._playLock)return g._queue.push({event:"mute",action:function(){g.mute(a,b)}}),g;if("undefined"===typeof b)if("boolean"===typeof a)g._muted=a;else return g._muted;for(var d=g._getSoundIds(b),f=0;f<d.length;f++){var h=g._soundById(d[f]);h&&(h._muted=a,h._interval&&g._stopFade(h._id),g._webAudio&&h._node?h._node.gain.setValueAtTime(a?0:h._volume,c.ctx.currentTime):h._node&&(h._node.muted=c._muted?!0:a),g._emit("mute",h._id))}return g},volume:function(){var a=this,b=arguments,g,d;if(0===b.length)return a._volume;1===b.length||2===b.length&&"undefined"===typeof b[1]?0<=a._getSoundIds().indexOf(b[0])?d=parseInt(b[0],10):g=parseFloat(b[0]):2<=b.length&&(g=parseFloat(b[0]),d=parseInt(b[1],10));var f;if("undefined"!==typeof g&&0<=g&&1>=g){if("loaded"!==a._state||a._playLock)return a._queue.push({event:"volume",action:function(){a.volume.apply(a,b)}}),a;"undefined"===typeof d&&(a._volume=g);d=a._getSoundIds(d);for(var h=0;h<d.length;h++)if(f=a._soundById(d[h]))f._volume=g,b[2]||a._stopFade(d[h]),a._webAudio&&f._node&&!f._muted?f._node.gain.setValueAtTime(g,c.ctx.currentTime):f._node&&!f._muted&&(f._node.volume=g*c.volume()),a._emit("volume",f._id)}else return(f=d?a._soundById(d):a._sounds[0])?f._volume:0;return a},fade:function(a,b,g,d){var f=this;if("loaded"!==f._state||f._playLock)return f._queue.push({event:"fade",action:function(){f.fade(a,b,g,d)}}),f;a=Math.min(Math.max(0,parseFloat(a)),1);b=Math.min(Math.max(0,parseFloat(b)),1);g=parseFloat(g);f.volume(a,d);for(var h=f._getSoundIds(d),k=0;k<h.length;k++){var e=f._soundById(h[k]);if(e){d||f._stopFade(h[k]);if(f._webAudio&&!e._muted){var l=c.ctx.currentTime,m=l+g/1E3;e._volume=a;e._node.gain.setValueAtTime(a,l);e._node.gain.linearRampToValueAtTime(b,m)}f._startFadeInterval(e,a,b,g,h[k],"undefined"===typeof d)}}return f},_startFadeInterval:function(a,b,c,d,f,h){var k=this,e=b,l=c-b;f=Math.abs(l/.01);f=Math.max(4,0<f?d/f:d);var m=Date.now();a._fadeTo=c;a._interval=setInterval(function(){var f=(Date.now()-m)/d;m=Date.now();e+=l*f;e=Math.round(100*e)/100;e=0>l?Math.max(c,e):Math.min(c,e);k._webAudio?a._volume=e:k.volume(e,a._id,!0);h&&(k._volume=e);if(c<b&&e<=c||c>b&&e>=c)clearInterval(a._interval),a._interval=null,a._fadeTo=null,k.volume(c,a._id),k._emit("fade",a._id)},f)},_stopFade:function(a){var b=this._soundById(a);b&&b._interval&&(this._webAudio&&b._node.gain.cancelScheduledValues(c.ctx.currentTime),clearInterval(b._interval),b._interval=null,this.volume(b._fadeTo,a),b._fadeTo=null,this._emit("fade",a));return this},loop:function(){var a=arguments,b,c;if(0===a.length)return this._loop;if(1===a.length)if("boolean"===typeof a[0])this._loop=b=a[0];else return(a=this._soundById(parseInt(a[0],10)))?a._loop:!1;else 2===a.length&&(b=a[0],c=parseInt(a[1],10));c=this._getSoundIds(c);for(var d=0;d<c.length;d++)if(a=this._soundById(c[d]))if(a._loop=b,this._webAudio&&a._node&&a._node.bufferSource&&(a._node.bufferSource.loop=b))a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop;return this},rate:function(){var a=this,b=arguments,d,e;0===b.length?e=a._sounds[0]._id:1===b.length?0<=a._getSoundIds().indexOf(b[0])?e=parseInt(b[0],10):d=parseFloat(b[0]):2===b.length&&(d=parseFloat(b[0]),e=parseInt(b[1],10));var f;if("number"===typeof d){if("loaded"!==a._state||a._playLock)return a._queue.push({event:"rate",action:function(){a.rate.apply(a,b)}}),a;"undefined"===typeof e&&(a._rate=d);e=a._getSoundIds(e);for(var h=0;h<e.length;h++)if(f=a._soundById(e[h])){a.playing(e[h])&&(f._rateSeek=a.seek(e[h]),f._playStart=a._webAudio?c.ctx.currentTime:f._playStart);f._rate=d;a._webAudio&&f._node&&f._node.bufferSource?f._node.bufferSource.playbackRate.setValueAtTime(d,c.ctx.currentTime):f._node&&(f._node.playbackRate=d);var k=a.seek(e[h]),k=1E3*((a._sprite[f._sprite][0]+a._sprite[f._sprite][1])/1E3-k)/Math.abs(f._rate);if(a._endTimers[e[h]]||!f._paused)a._clearTimer(e[h]),a._endTimers[e[h]]=setTimeout(a._ended.bind(a,f),k);a._emit("rate",f._id)}}else return(f=a._soundById(e))?f._rate:a._rate;return a},seek:function(){var a=this,b=arguments,d,e;0===b.length?e=a._sounds[0]._id:1===b.length?0<=a._getSoundIds().indexOf(b[0])?e=parseInt(b[0],10):a._sounds.length&&(e=a._sounds[0]._id,d=parseFloat(b[0])):2===b.length&&(d=parseFloat(b[0]),e=parseInt(b[1],10));if("undefined"===typeof e)return a;if("number"===typeof d&&("loaded"!==a._state||a._playLock))return a._queue.push({event:"seek",action:function(){a.seek.apply(a,b)}}),a;var f=a._soundById(e);if(f)if("number"===typeof d&&0<=d){var h=a.playing(e);h&&a.pause(e,!0);f._seek=d;f._ended=!1;a._clearTimer(e);a._webAudio||!f._node||isNaN(f._node.duration)||(f._node.currentTime=d);var k=function(){a._emit("seek",e);h&&a.play(e,!0)};if(h&&!a._webAudio){var l=function(){a._playLock?setTimeout(l,0):k()};setTimeout(l,0)}else k()}else return a._webAudio?(d=a.playing(e)?c.ctx.currentTime-f._playStart:0,f._seek+((f._rateSeek?f._rateSeek-f._seek:0)+d*Math.abs(f._rate))):f._node.currentTime;return a},playing:function(a){if("number"===typeof a)return(a=this._soundById(a))?!a._paused:!1;for(a=0;a<this._sounds.length;a++)if(!this._sounds[a]._paused)return!0;return!1},duration:function(a){var b=this._duration;(a=this._soundById(a))&&(b=this._sprite[a._sprite][1]/1E3);return b},state:function(){return this._state},unload:function(){for(var a=this._sounds,b=0;b<a.length;b++)a[b]._paused||this.stop(a[b]._id),this._webAudio||(this._clearSound(a[b]._node),a[b]._node.removeEventListener("error",a[b]._errorFn,!1),a[b]._node.removeEventListener(c._canPlayEvent,a[b]._loadFn,!1),a[b]._node.removeEventListener("ended",a[b]._endFn,!1),c._releaseHtml5Audio(a[b]._node)),delete a[b]._node,this._clearTimer(a[b]._id);b=c._howls.indexOf(this);0<=b&&c._howls.splice(b,1);a=!0;for(b=0;b<c._howls.length;b++)if(c._howls[b]._src===this._src||0<=this._src.indexOf(c._howls[b]._src)){a=!1;break}p&&a&&delete p[this._src];c.noAudio=!1;this._state="unloaded";this._sounds=[];return null},on:function(a,b,c,d){a=this["_on"+a];"function"===typeof b&&a.push(d?{id:c,fn:b,once:d}:{id:c,fn:b});return this},off:function(a,b,c){var d=this["_on"+a],f=0;"number"===typeof b&&(c=b,b=null);if(b||c)for(f=0;f<d.length;f++){if(a=c===d[f].id,b===d[f].fn&&a||!b&&a){d.splice(f,1);break}}else if(a)this["_on"+a]=[];else for(b=Object.keys(this),f=0;f<b.length;f++)0===b[f].indexOf("_on")&&Array.isArray(this[b[f]])&&(this[b[f]]=[]);return this},once:function(a,b,c){this.on(a,b,c,1);return this},_emit:function(a,b,c){for(var d=this["_on"+a],f=d.length-1;0<=f;f--)d[f].id&&d[f].id!==b&&"load"!==a||(setTimeout(function(a){a.call(this,b,c)}.bind(this,d[f].fn),0),d[f].once&&this.off(a,d[f].fn,d[f].id));this._loadQueue(a);return this},_loadQueue:function(a){if(0<this._queue.length){var b=this._queue[0];b.event===a&&(this._queue.shift(),this._loadQueue());a||b.action()}return this},_ended:function(a){var b=a._sprite;if(!this._webAudio&&a._node&&!a._node.paused&&!a._node.ended&&a._node.currentTime<a._stop)return setTimeout(this._ended.bind(this,a),100),this;b=!(!a._loop&&!this._sprite[b][2]);this._emit("end",a._id);!this._webAudio&&b&&this.stop(a._id,!0).play(a._id);if(this._webAudio&&b){this._emit("play",a._id);a._seek=a._start||0;a._rateSeek=0;a._playStart=c.ctx.currentTime;var d=1E3*(a._stop-a._start)/Math.abs(a._rate);this._endTimers[a._id]=setTimeout(this._ended.bind(this,a),d)}this._webAudio&&!b&&(a._paused=!0,a._ended=!0,a._seek=a._start||0,a._rateSeek=0,this._clearTimer(a._id),this._cleanBuffer(a._node),c._autoSuspend());this._webAudio||b||this.stop(a._id,!0);return this},_clearTimer:function(a){if(this._endTimers[a]){if("function"!==typeof this._endTimers[a])clearTimeout(this._endTimers[a]);else{var b=this._soundById(a);b&&b._node&&b._node.removeEventListener("ended",this._endTimers[a],!1)}delete this._endTimers[a]}return this},_soundById:function(a){for(var b=0;b<this._sounds.length;b++)if(a===this._sounds[b]._id)return this._sounds[b];return null},_inactiveSound:function(){this._drain();for(var a=0;a<this._sounds.length;a++)if(this._sounds[a]._ended)return this._sounds[a].reset();return new e(this)},_drain:function(){var a=this._pool,b=0,c=0;if(!(this._sounds.length<a)){for(c=0;c<this._sounds.length;c++)this._sounds[c]._ended&&b++;for(c=this._sounds.length-1;0<=c&&!(b<=a);c--)this._sounds[c]._ended&&(this._webAudio&&this._sounds[c]._node&&this._sounds[c]._node.disconnect(0),this._sounds.splice(c,1),b--)}},_getSoundIds:function(a){if("undefined"===typeof a){a=[];for(var b=0;b<this._sounds.length;b++)a.push(this._sounds[b]._id);return a}return[a]},_refreshBuffer:function(a){a._node.bufferSource=c.ctx.createBufferSource();a._node.bufferSource.buffer=p[this._src];a._panner?a._node.bufferSource.connect(a._panner):a._node.bufferSource.connect(a._node);if(a._node.bufferSource.loop=a._loop)a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop||0;a._node.bufferSource.playbackRate.setValueAtTime(a._rate,c.ctx.currentTime);return this},_cleanBuffer:function(a){var b=c._navigator&&0<=c._navigator.vendor.indexOf("Apple");if(c._scratchBuffer&&a.bufferSource&&(a.bufferSource.onended=null,a.bufferSource.disconnect(0),b))try{a.bufferSource.buffer=c._scratchBuffer}catch(d){}a.bufferSource=null;return this},_clearSound:function(a){/MSIE |Trident\//.test(c._navigator&&c._navigator.userAgent)||(a.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var e=function(a){this._parent=a;this.init()};e.prototype={init:function(){var a=this._parent;this._muted=a._muted;this._loop=a._loop;this._volume=a._volume;this._rate=a._rate;this._seek=0;this._ended=this._paused=!0;this._sprite="__default";this._id=++c._counter;a._sounds.push(this);this.create();return this},create:function(){var a=this._parent,b=c._muted||this._muted||this._parent._muted?0:this._volume;a._webAudio?(this._node="undefined"===typeof c.ctx.createGain?c.ctx.createGainNode():c.ctx.createGain(),this._node.gain.setValueAtTime(b,c.ctx.currentTime),this._node.paused=!0,this._node.connect(c.masterGain)):c.noAudio||(this._node=c._obtainHtml5Audio(),this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(c._canPlayEvent,this._loadFn,!1),this._endFn=this._endListener.bind(this),this._node.addEventListener("ended",this._endFn,!1),this._node.src=a._src,this._node.preload=!0===a._preload?"auto":a._preload,this._node.volume=b*c.volume(),this._node.load());return this},reset:function(){var a=this._parent;this._muted=a._muted;this._loop=a._loop;this._volume=a._volume;this._rate=a._rate;this._rateSeek=this._seek=0;this._ended=this._paused=!0;this._sprite="__default";this._id=++c._counter;return this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0);this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var a=this._parent;a._duration=Math.ceil(10*this._node.duration)/10;0===Object.keys(a._sprite).length&&(a._sprite={__default:[0,1E3*a._duration]});"loaded"!==a._state&&(a._state="loaded",a._emit("load"),a._loadQueue());this._node.removeEventListener(c._canPlayEvent,this._loadFn,!1)},_endListener:function(){var a=this._parent;Infinity===a._duration&&(a._duration=Math.ceil(10*this._node.duration)/10,Infinity===a._sprite.__default[1]&&(a._sprite.__default[1]=1E3*a._duration),a._ended(this));this._node.removeEventListener("ended",this._endFn,!1)}};var p={},l=function(a){var b=a._src;if(p[b])a._duration=p[b].duration,n(a);else if(/^data:[^;]+;base64,/.test(b)){for(var c=atob(b.split(",")[1]),d=new Uint8Array(c.length),f=0;f<c.length;++f)d[f]=c.charCodeAt(f);m(d.buffer,a)}else{var e=new XMLHttpRequest;e.open(a._xhr.method,b,!0);e.withCredentials=a._xhr.withCredentials;e.responseType="arraybuffer";a._xhr.headers&&Object.keys(a._xhr.headers).forEach(function(b){e.setRequestHeader(b,a._xhr.headers[b])});e.onload=function(){var b=(e.status+"")[0];"0"!==b&&"2"!==b&&"3"!==b?a._emit("loaderror",null,"Failed loading audio file with status: "+e.status+"."):m(e.response,a)};e.onerror=function(){a._webAudio&&(a._html5=!0,a._webAudio=!1,a._sounds=[],delete p[b],a.load())};q(e)}},q=function(a){try{a.send()}catch(b){a.onerror()}},m=function(a,b){var d=function(){b._emit("loaderror",null,"Decoding audio data failed.")},e=function(a){a&&0<b._sounds.length?(p[b._src]=a,n(b,a)):d()};"undefined"!==typeof Promise&&1===c.ctx.decodeAudioData.length?c.ctx.decodeAudioData(a).then(e)["catch"](d):c.ctx.decodeAudioData(a,e,d)},n=function(a,b){b&&!a._duration&&(a._duration=b.duration);0===Object.keys(a._sprite).length&&(a._sprite={__default:[0,1E3*a._duration]});"loaded"!==a._state&&(a._state="loaded",a._emit("load"),a._loadQueue())},u=function(){if(c.usingWebAudio){try{"undefined"!==typeof AudioContext?c.ctx=new AudioContext:"undefined"!==typeof webkitAudioContext?c.ctx=new webkitAudioContext:c.usingWebAudio=!1}catch(d){c.usingWebAudio=!1}c.ctx||(c.usingWebAudio=!1);var a=/iP(hone|od|ad)/.test(c._navigator&&c._navigator.platform),b=c._navigator&&c._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),b=b?parseInt(b[1],10):null;a&&b&&9>b&&(a=/safari/.test(c._navigator&&c._navigator.userAgent.toLowerCase()),c._navigator&&!a&&(c.usingWebAudio=!1));c.usingWebAudio&&(c.masterGain="undefined"===typeof c.ctx.createGain?c.ctx.createGainNode():c.ctx.createGain(),c.masterGain.gain.setValueAtTime(c._muted?0:c._volume,c.ctx.currentTime),c.masterGain.connect(c.ctx.destination));c._setup()}};"function"===typeof define&&define.amd&&define([],function(){return{Howler:c,Howl:d}});"undefined"!==typeof exports&&(exports.Howler=c,exports.Howl=d);"undefined"!==typeof global?(global.HowlerGlobal=t,global.Howler=c,global.Howl=d,global.Sound=e):"undefined"!==typeof window&&(window.HowlerGlobal=t,window.Howler=c,window.Howl=d,window.Sound=e)})();(function(){HowlerGlobal.prototype._pos=[0,0,0];HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0];HowlerGlobal.prototype.stereo=function(c){if(!this.ctx||!this.ctx.listener)return this;for(var d=this._howls.length-1;0<=d;d--)this._howls[d].stereo(c);return this};HowlerGlobal.prototype.pos=function(c,d,e){if(!this.ctx||!this.ctx.listener)return this;d="number"!==typeof d?this._pos[1]:d;e="number"!==typeof e?this._pos[2]:e;if("number"===typeof c)this._pos=[c,d,e],"undefined"!==typeof this.ctx.listener.positionX?(this.ctx.listener.positionX.setTargetAtTime(this._pos[0],Howler.ctx.currentTime,.1),this.ctx.listener.positionY.setTargetAtTime(this._pos[1],Howler.ctx.currentTime,.1),this.ctx.listener.positionZ.setTargetAtTime(this._pos[2],Howler.ctx.currentTime,.1)):this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]);else return this._pos;return this};HowlerGlobal.prototype.orientation=function(c,d,e,p,l,q){if(!this.ctx||!this.ctx.listener)return this;var m=this._orientation;d="number"!==typeof d?m[1]:d;e="number"!==typeof e?m[2]:e;p="number"!==typeof p?m[3]:p;l="number"!==typeof l?m[4]:l;q="number"!==typeof q?m[5]:q;if("number"===typeof c)this._orientation=[c,d,e,p,l,q],"undefined"!==typeof this.ctx.listener.forwardX?(this.ctx.listener.forwardX.setTargetAtTime(c,Howler.ctx.currentTime,.1),this.ctx.listener.forwardY.setTargetAtTime(d,Howler.ctx.currentTime,.1),this.ctx.listener.forwardZ.setTargetAtTime(e,Howler.ctx.currentTime,.1),this.ctx.listener.upX.setTargetAtTime(p,Howler.ctx.currentTime,.1),this.ctx.listener.upY.setTargetAtTime(l,Howler.ctx.currentTime,.1),this.ctx.listener.upZ.setTargetAtTime(q,Howler.ctx.currentTime,.1)):this.ctx.listener.setOrientation(c,d,e,p,l,q);else return m;return this};Howl.prototype.init=function(c){return function(d){this._orientation=d.orientation||[1,0,0];this._stereo=d.stereo||null;this._pos=d.pos||null;this._pannerAttr={coneInnerAngle:"undefined"!==typeof d.coneInnerAngle?d.coneInnerAngle:360,coneOuterAngle:"undefined"!==typeof d.coneOuterAngle?d.coneOuterAngle:360,coneOuterGain:"undefined"!==typeof d.coneOuterGain?d.coneOuterGain:0,distanceModel:"undefined"!==typeof d.distanceModel?d.distanceModel:"inverse",maxDistance:"undefined"!==typeof d.maxDistance?d.maxDistance:1E4,panningModel:"undefined"!==typeof d.panningModel?d.panningModel:"HRTF",refDistance:"undefined"!==typeof d.refDistance?d.refDistance:1,rolloffFactor:"undefined"!==typeof d.rolloffFactor?d.rolloffFactor:1};this._onstereo=d.onstereo?[{fn:d.onstereo}]:[];this._onpos=d.onpos?[{fn:d.onpos}]:[];this._onorientation=d.onorientation?[{fn:d.onorientation}]:[];return c.call(this,d)}}(Howl.prototype.init);Howl.prototype.stereo=function(c,d){var e=this;if(!e._webAudio)return e;if("loaded"!==e._state)return e._queue.push({event:"stereo",action:function(){e.stereo(c,d)}}),e;var p="undefined"===typeof Howler.ctx.createStereoPanner?"spatial":"stereo";if("undefined"===typeof d)if("number"===typeof c)e._stereo=c,e._pos=[c,0,0];else return e._stereo;for(var l=e._getSoundIds(d),q=0;q<l.length;q++){var m=e._soundById(l[q]);if(m)if("number"===typeof c)m._stereo=c,m._pos=[c,0,0],m._node&&(m._pannerAttr.panningModel="equalpower",m._panner&&m._panner.pan||t(m,p),"spatial"===p?"undefined"!==typeof m._panner.positionX?(m._panner.positionX.setValueAtTime(c,Howler.ctx.currentTime),m._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),m._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):m._panner.setPosition(c,0,0):m._panner.pan.setValueAtTime(c,Howler.ctx.currentTime)),e._emit("stereo",m._id);else return m._stereo}return e};Howl.prototype.pos=function(c,d,e,p){var l=this;if(!l._webAudio)return l;if("loaded"!==l._state)return l._queue.push({event:"pos",action:function(){l.pos(c,d,e,p)}}),l;d="number"!==typeof d?0:d;e="number"!==typeof e?-.5:e;if("undefined"===typeof p)if("number"===typeof c)l._pos=[c,d,e];else return l._pos;for(var q=l._getSoundIds(p),m=0;m<q.length;m++){var n=l._soundById(q[m]);if(n)if("number"===typeof c)n._pos=[c,d,e],n._node&&(n._panner&&!n._panner.pan||t(n,"spatial"),"undefined"!==typeof n._panner.positionX?(n._panner.positionX.setValueAtTime(c,Howler.ctx.currentTime),n._panner.positionY.setValueAtTime(d,Howler.ctx.currentTime),n._panner.positionZ.setValueAtTime(e,Howler.ctx.currentTime)):n._panner.setPosition(c,d,e)),l._emit("pos",n._id);else return n._pos}return l};Howl.prototype.orientation=function(c,d,e,p){var l=this;if(!l._webAudio)return l;if("loaded"!==l._state)return l._queue.push({event:"orientation",action:function(){l.orientation(c,d,e,p)}}),l;d="number"!==typeof d?l._orientation[1]:d;e="number"!==typeof e?l._orientation[2]:e;if("undefined"===typeof p)if("number"===typeof c)l._orientation=[c,d,e];else return l._orientation;for(var q=l._getSoundIds(p),m=0;m<q.length;m++){var n=l._soundById(q[m]);if(n)if("number"===typeof c)n._orientation=[c,d,e],n._node&&(n._panner||(n._pos||(n._pos=l._pos||[0,0,-.5]),t(n,"spatial")),"undefined"!==typeof n._panner.orientationX?(n._panner.orientationX.setValueAtTime(c,Howler.ctx.currentTime),n._panner.orientationY.setValueAtTime(d,Howler.ctx.currentTime),n._panner.orientationZ.setValueAtTime(e,Howler.ctx.currentTime)):n._panner.setOrientation(c,d,e)),l._emit("orientation",n._id);else return n._orientation}return l};Howl.prototype.pannerAttr=function(){var c=arguments,d,e;if(!this._webAudio)return this;if(0===c.length)return this._pannerAttr;if(1===c.length)if("object"===typeof c[0])d=c[0],"undefined"===typeof e&&(d.pannerAttr||(d.pannerAttr={coneInnerAngle:d.coneInnerAngle,coneOuterAngle:d.coneOuterAngle,coneOuterGain:d.coneOuterGain,distanceModel:d.distanceModel,maxDistance:d.maxDistance,refDistance:d.refDistance,rolloffFactor:d.rolloffFactor,panningModel:d.panningModel}),this._pannerAttr={coneInnerAngle:"undefined"!==typeof d.pannerAttr.coneInnerAngle?d.pannerAttr.coneInnerAngle:this._coneInnerAngle,coneOuterAngle:"undefined"!==typeof d.pannerAttr.coneOuterAngle?d.pannerAttr.coneOuterAngle:this._coneOuterAngle,coneOuterGain:"undefined"!==typeof d.pannerAttr.coneOuterGain?d.pannerAttr.coneOuterGain:this._coneOuterGain,distanceModel:"undefined"!==typeof d.pannerAttr.distanceModel?d.pannerAttr.distanceModel:this._distanceModel,maxDistance:"undefined"!==typeof d.pannerAttr.maxDistance?d.pannerAttr.maxDistance:this._maxDistance,refDistance:"undefined"!==typeof d.pannerAttr.refDistance?d.pannerAttr.refDistance:this._refDistance,rolloffFactor:"undefined"!==typeof d.pannerAttr.rolloffFactor?d.pannerAttr.rolloffFactor:this._rolloffFactor,panningModel:"undefined"!==typeof d.pannerAttr.panningModel?d.pannerAttr.panningModel:this._panningModel});else return(c=this._soundById(parseInt(c[0],10)))?c._pannerAttr:this._pannerAttr;else 2===c.length&&(d=c[0],e=parseInt(c[1],10));e=this._getSoundIds(e);for(var p=0;p<e.length;p++)if(c=this._soundById(e[p])){var l=c._pannerAttr,l={coneInnerAngle:"undefined"!==typeof d.coneInnerAngle?d.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:"undefined"!==typeof d.coneOuterAngle?d.coneOuterAngle:l.coneOuterAngle,coneOuterGain:"undefined"!==typeof d.coneOuterGain?d.coneOuterGain:l.coneOuterGain,distanceModel:"undefined"!==typeof d.distanceModel?d.distanceModel:l.distanceModel,maxDistance:"undefined"!==typeof d.maxDistance?d.maxDistance:l.maxDistance,refDistance:"undefined"!==typeof d.refDistance?d.refDistance:l.refDistance,rolloffFactor:"undefined"!==typeof d.rolloffFactor?d.rolloffFactor:l.rolloffFactor,panningModel:"undefined"!==typeof d.panningModel?d.panningModel:l.panningModel},q=c._panner;q?(q.coneInnerAngle=l.coneInnerAngle,q.coneOuterAngle=l.coneOuterAngle,q.coneOuterGain=l.coneOuterGain,q.distanceModel=l.distanceModel,q.maxDistance=l.maxDistance,q.refDistance=l.refDistance,q.rolloffFactor=l.rolloffFactor,q.panningModel=l.panningModel):(c._pos||(c._pos=this._pos||[0,0,-.5]),t(c,"spatial"))}return this};Sound.prototype.init=function(c){return function(){var d=this._parent;this._orientation=d._orientation;this._stereo=d._stereo;this._pos=d._pos;this._pannerAttr=d._pannerAttr;c.call(this);this._stereo?d.stereo(this._stereo):this._pos&&d.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init);Sound.prototype.reset=function(c){return function(){var d=this._parent;this._orientation=d._orientation;this._stereo=d._stereo;this._pos=d._pos;this._pannerAttr=d._pannerAttr;this._stereo?d.stereo(this._stereo):this._pos?d.pos(this._pos[0],this._pos[1],this._pos[2],this._id):this._panner&&(this._panner.disconnect(0),this._panner=void 0,d._refreshBuffer(this));return c.call(this)}}(Sound.prototype.reset);var t=function(c,d){"spatial"===(d||"spatial")?(c._panner=Howler.ctx.createPanner(),c._panner.coneInnerAngle=c._pannerAttr.coneInnerAngle,c._panner.coneOuterAngle=c._pannerAttr.coneOuterAngle,c._panner.coneOuterGain=c._pannerAttr.coneOuterGain,c._panner.distanceModel=c._pannerAttr.distanceModel,c._panner.maxDistance=c._pannerAttr.maxDistance,c._panner.refDistance=c._pannerAttr.refDistance,c._panner.rolloffFactor=c._pannerAttr.rolloffFactor,c._panner.panningModel=c._pannerAttr.panningModel,"undefined"!==typeof c._panner.positionX?(c._panner.positionX.setValueAtTime(c._pos[0],Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(c._pos[1],Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(c._pos[2],Howler.ctx.currentTime)):c._panner.setPosition(c._pos[0],c._pos[1],c._pos[2]),"undefined"!==typeof c._panner.orientationX?(c._panner.orientationX.setValueAtTime(c._orientation[0],Howler.ctx.currentTime),c._panner.orientationY.setValueAtTime(c._orientation[1],Howler.ctx.currentTime),c._panner.orientationZ.setValueAtTime(c._orientation[2],Howler.ctx.currentTime)):c._panner.setOrientation(c._orientation[0],c._orientation[1],c._orientation[2])):(c._panner=Howler.ctx.createStereoPanner(),c._panner.pan.setValueAtTime(c._stereo,Howler.ctx.currentTime));c._panner.connect(c._node);c._paused||c._parent.pause(c._id,!0).play(c._id,!0)}})();

var AmeliaChat=function(f){var a=this;f=f||{};a._initialConfig=f;var e={};a._secureAbleMessageTypes=["OutboundTextMessage","OutboundFormInputMessage","OutboundEchoMessage"];a._allowIntentDetectionInFormInputTypes=["OutboundFormInputMessage"];a._offTheRecordAbleMessageTypes=["clientpreference","OutboundTextMessage","OutboundFormInputMessage","OutboundEchoMessage"];a._isV4=!0;a._multipleConversationMode=f.multipleConversationMode||!1;a._wsConnection=void 0;a._conversationsBySessionId={};a._is37OrHigher=!1;a._domainCode=f.domainCode||"global";a._canJoinDefaultDomain=!0===f.canJoinDefaultDomain||!1;a._includeHiddenDomains=!0===f.includeHiddenDomains||!1;a.channels=f.channels||{USER:"webchat_coreuser",AGENT:"js_sdk",OBSERVER:"js_sdk"};a._languageCode=f.languageCode||"en-US";a._conversationId=f.conversationId||null;a._userInterface="WEB_USER";a._allowAnonymous=f.allowAnonymous||!1;a._customUpload=!0===f.customUpload||!1;a._foreGroundSessionId=null;a._rejoin=f.rejoin||!1;a._accept=f.accept||{push:!1,escalation:!1};a._accept.push=a._accept.push||!1;a._accept.escalation=a._accept.escalation||!1;a._sttDelay=f.sttDelay||1500;0>a._sttDelay&&(a._sttDelay=1500);a._subscriptionConfig=f.subscription||{};var L=function(){var a;try{a=new XMLHttpRequest}catch(b){a=new ActiveXObject("MSXML2.XMLHTTP.3.0")}return a},B=function(a,b){for(var d in b)if(b.hasOwnProperty(d)&&!a.hasOwnProperty(d)||void 0===a[d]||null===a[d])a[d]=b[d]},R=function(a,b){for(var d=0,g=0,l=0,e=0;l<a.length||e<b.length;){for(;l<a.length&&"."!=a[l];)d=10*d+(a[l]-0),l++;for(;e<b.length&&"."!=b[e];)g=10*g+(b[e]-0),e++;if(d>g)break;if(g>d)return!1;d=g=0;l++;e++}return!0},A=function(c,b,d,g,e,h){var k=L();"function"===typeof d&&d.call(a,k);k.open("GET",c);"function"===typeof g&&g.call(a,k);if(void 0!==b)for(var f in b)b.hasOwnProperty(f)&&k.setRequestHeader(f,b[f]);k.setRequestHeader("Accept","application/json,text/xml,text/html,text/plain");h=h||function(a){}.bind(a);k.onload=function(){4===k.readyState&&(200===k.status?"function"===typeof e&&e.call(a,k):"function"===typeof h&&h.call(a,k))};k.send()},x=function(c,b,d,g,e,h,k,f){var t=L();"function"===typeof e&&e.call(a,t);t.open("POST",c);"function"===typeof h&&h.call(a,t);if(void 0!==b)for(var n in b)"Content-type"===n&&"multipart/form-data"===b[n]||t.setRequestHeader(n,b[n]);if(void 0!==g)c=g;else if("multipart/form-data"===b["Content-type"])for(n in c=new FormData,d)d.hasOwnProperty(n)&&c.append(n,d[n]);else for(n in t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c="",d)d.hasOwnProperty(n)&&(c+=n+"\x3d"+encodeURIComponent(d[n])+"\x26");t.setRequestHeader("Accept","application/json,text/xml,text/html,text/plain");f=f||function(a){}.bind(a);t.onload=function(){4===t.readyState&&(200===t.status?"function"===typeof k&&k.call(a,t):"function"===typeof f&&f.call(a,t))};t.send(c)},D=function(a){return a&&a.constructor===Array},B=function(a,b){for(var d in b)if(b.hasOwnProperty(d)&&!a.hasOwnProperty(d)||void 0===a[d]||null===a[d])a[d]=b[d]},F=function(a,b){void 0===b&&(b=function(a){return a});if(0<a.length){for(var d={},g=a.split("\x26"),e=0;e<g.length;e++){var h=b(g[e].substring(0,g[e].indexOf("\x3d")));if(!1!==h){var k=g[e].substring(g[e].indexOf("\x3d")+1),f=void 0;void 0!==k&&0<k.length&&(-1<k.indexOf(",")?f=k.split(","):k=decodeURIComponent(k));void 0===f&&(f=[k]);for(k=0;k<f.length;k++)void 0===d[h]?d[h]=f[k]:D(d[h])?d[h].push(f[k]):d[h]=[d[h],f[k]]}}return d}return{}};a.getSessionId=function(){return a._foreGroundSessionId};a._setSessionId=function(c){a._foreGroundSessionId=c};a._ameliaSessionId=null;a.getConversationId=function(){return a._getForegroundConversation()._conversationId};a._setConversationId=function(c){a._conversationId=c};a.getContextId=function(){return a._getForegroundConversation()._contextId};a._setContextId=function(c){a._contextId=c};a.getDomainCode=function(){return a._domainCode};a.setDomainCode=function(c){a._hasDomainBeenSet=!0;a._domainCode=c};a._joinSubscription=void 0;a._escalationSubscription=void 0;a._setUser=function(c){a._user=c;a._establishChatLevelByUser(c);!0===a._is37OrHigher&&(a._joinSubscription&&a._joinSubscription.unsubscribe&&a._joinSubscription.unsubscribe(),a._escalationSubscription&&a._escalationSubscription.unsubscribe&&a._escalationSubscription.unsubscribe(),void 0!==c&&(!0===a._accept.push&&(a._joinSubscription=new S({wsConnection:a._wsConnection,userId:c.userId,messageHandler:function(b){var c=JSON.parse(b.body);c.autoSwitch=!0;!0===c.autoSwitch&&a.joinConversation(c.conversationId,c);e.fireEvent(c.messageType,c.messageType,c,b.headers)}}),a._joinSubscription.subscribe()),!0===a._accept.escalation&&!0===c.agent&&(a._escalationSubscription=new T({wsConnection:a._wsConnection,userId:c.userId}),a._escalationSubscription.subscribe())))};a._sttDelay=f.sttDelay||1500;0>a._sttDelay&&(a._sttDelay=1500);a._subscriptionConfig=f.subscription||{};a._messages=new Queue;var q=function(){if(void 0!==window.location.search){var a=F(window.location.search.substring(1));if(a&&a.as)return a.as}};a._authSystems=void 0===f.authSystems?q:"object"===typeof f.authSystems?function(){return f.authSystems.as}:"string"===typeof f.authSystems?function(){return f.authSystems}:"function"===typeof f.authSystems?f.authSystems:q;a.initAuthSystems=function(c,b){var d=a._authSystems(),g="";if(void 0!==d)if(g+="?as\x3d",D(d))for(var l=0;l<d.length;l++)g+=d[l],l<d.length-1&&(g+="\x26as\x3d");else g+=d;A("/Amelia/api/loginauthsystems"+g,a._sessionHeaders({}),void 0,function(a){},function(b){var d=[];try{d=JSON.parse(b.responseText),e.fireEvent("authSystemsLoad",d)}catch(g){e.fireEvent("authSystemsLoad",[])}"function"===typeof c&&c.call(a,d)},function(c){e.fireEvent("authSystemsLoad",[]);"function"===typeof b&&b.call(a,[])})};var M=function(c){var b=this;b.reconnectDelayMs=c.reconnectDelayMs||2E3;b.onHttpSessionInvalid=c.onHttpSessionInvalid;b.failedReconnectCount=0;b.maxFailedReconnects=c.maxFailedReconnects||15;b.debug=c.debug||!0;b.connected=!1;b.connectedOnce=!1;b.receiptHandlers={};b.subscribeHandlers={};b.transports=c.transports||void 0;b.addReceiptHandler=function(a,c){b.receiptHandlers[a]=c};b.addSubscribeHandler=function(a,c){b.subscribeHandlers[a]=c};b.removeSubscribeHandler=function(a){delete b.subscribeHandlers.id};b.connect=function(c){b.csrfToken=c;c={sessionId:16};void 0!==b.transports&&(c.transports=b.transports);c=new SockJS("/Amelia/api/sock",null,c);b.connection=webstomp.over(c,{heartbeat:{incoming:2E4,outgoing:2E4},debug:this.debug});b.connection.debug=function(a){};b.connection.onreceipt=function(a){a=a.headers["receipt-id"];if(b.receiptHandlers[a])b.receiptHandlers[a]();else console.error("Received unexpected receipt id "+a)};c={"X-CSRF-TOKEN":a._csrfToken};null!==a._ameliaSessionId&&void 0!==a._ameliaSessionId&&(c["X-Amelia-Session-Auth"]=a._ameliaSessionId);b.connection.connect(c,function(){b.connected=!0;b.failedReconnectCount=0;b.resubscribeIfConnectedBefore()},function(a){console.error("STOMP: "+a);b.reconnect()})};b.reconnect=function(){b.disconnect();b.failedReconnectCount+=1;b.failedReconnectCount>b.maxFailedReconnects?e.fireEvent("sessionFail",403,"SESSION_INVALID","Too many failed reconnects"):setTimeout(e.checkSession,b.reconnectDelayMs)};b.disconnect=function(){if(b.connection){try{b.connection.disconnect()}catch(a){console.error("Error disconnecting wsConnection",a)}b.connected=!1}};b.resubscribeIfConnectedBefore=function(){if(b.connectedOnce)for(var a in b.subscribeHandlers){if(b.subscribeHandlers.hasOwnProperty(a))try{b.subscribeHandlers[a]()}catch(c){console.error("Failed to subscribe to "+a+", "+c)}}else b.connectedOnce=!0};return b},S=function(a){var b=this;b.wsConnection=a.wsConnection;b.wsConnection.debug=function(a){};b.userId=a.userId;b.messageHandler=a.messageHandler;b.subscribe=function(){b.wsConnection.connected?b._subscribe():window.setTimeout(b.subscribe,1E3)};b._subscribe=function(){b.wsConnection.connected||console.error("Attempt to subscribe over disconnected web socket");var a=b.wsConnection.connection.subscribe("/topic/join-conversation-request."+b.userId,function(a){b.messageHandler(a)});b.unsubscribe=a.unsubscribe}},T=function(a){var b=this;b.wsConnection=a.wsConnection;b.wsConnection.debug=function(a){};b.userId=a.userId;b.activeEscalations={};b.messageHandler=function(a){var c=JSON.parse(a.body);b.activeEscalations[c.escalationRequestId]="PENDING";e.fireEvent("EscalationNotificationMessage",c,a.headers);c.escalationPopupTimeout&&window.setTimeout(function(){e.fireEvent("EscalationTimeoutMessage",c,a.headers);b.sendResponse("TIMEOUT",c,a.headers)},1E3*c.escalationPopupTimeout)};b.subscribe=function(){b.wsConnection.connected?b._subscribe():window.setTimeout(b.subscribe,1E3)};b._subscribe=function(){b.wsConnection.connected||console.error("Attempt to subscribe over disconnected web socket");var a=b.wsConnection.connection.subscribe("/topic/escalation."+b.userId,function(a){b.messageHandler(a)});b.unsubscribe=a.unsubscribe};b.unsubscribe=function(){b.unsubscribe&&b.unsubscribe.call()};b.sendResponse=function(a,c){var e={"X-Amelia-Escalation-Id":c.escalationId,"X-Amelia-User-Id":c.userId,"X-Amelia-Timestamp":(new Date).getTime()};b.wsConnection.connection.send("/amelia/escalation.in",JSON.stringify({escalationId:c.escalationId,escalationRequestId:c.escalationRequestId,escalationResult:a,userId:c.userId}),e);delete b.activeEscalations[c.escalationRequestId]}};a.acceptNotification=function(c){a._escalationSubscription?a._escalationSubscription.sendResponse("ACCEPTED",c):console.error("No active Escalation Subscription")};a.rejectNotification=function(c){a._escalationSubscription?a._escalationSubscription.sendResponse("REJECTED",c):console.error("No active Escalation Subscription")};var U=function(c){var b=this;b.wsConnection=c.wsConnection;b.sessionId=c.sessionId;b.conversationId=c.conversationId;b.onSubscribeCallback=c.onSubscribeCallback;b.messageHandler=c.messageHandler;b.onSubscribeCallbackCalled=!1;b.debug=c.debug||!1;b.queuedMessages=[];b.subscribe=function(){b.wsConnection.connected?b._subscribe():window.setTimeout(b.subscribe,1E3)};b._subscribe=function(){b.wsConnection.connected||console.error("Attempt to subscribe over disconnected web socket");var d="/queue/session."+
b.sessionId,g="subscribe-"+b.sessionId;a._conversationsBySessionId[c.sessionId]&&a._conversationsBySessionId[c.sessionId]._subscription&&a._conversationsBySessionId[c.sessionId]._subscription.unsubscribe();b.wsConnection.addReceiptHandler(g,function(){!b.onSubscribeCallbackCalled&&b.onSubscribeCallback&&(b.onSubscribeCallbackCalled=!0,b.onSubscribeCallback(b));if(0<b.queuedMessages.length)for(var a=b.queuedMessages.shift();void 0!==a;)b.send(a.messageBody,a.messageType,a.extraHeaders),a=b.queuedMessages.shift()});b.wsConnection.addSubscribeHandler(b.sessionId,b.subscribe);d=b.wsConnection.connection.subscribe(d,function(a){b.messageHandler(a)},{receipt:g});b._unsubscribe=d.unsubscribe};b.unsubscribe=function(){b._unsubscribe&&(b._unsubscribe.call(),b.wsConnection.removeSubscribeHandler(b.sessionId),a._spokenQueues&&(delete a._spokenQueues[b.sessionId],delete a._audioQueues[b.sessionId],delete a._audioMaps[b.sessionId]))};b.send=function(a,c,e){this.onSubscribeCallbackCalled?(e=e||{},B(e,{"X-Amelia-Session-Id":b.sessionId,"X-Amelia-Conversation-Id":b.conversationId,"X-Amelia-Message-Type":c,"X-Amelia-Timestamp":(new Date).getTime()}),b.wsConnection.connection.send("/amelia/session.in",JSON.stringify(a),e)):this.queuedMessages.push({messageBody:a,messageType:c,extraHeaders:e})};return b},N=function(c){var b=this;b._domainCode=c.domainCode||"global";b._languageCode=c.languageCode;b._sessionId=c.sessionId||null;b._conversationId=c.conversationId||null;b._customUpload=!0===c.customUpload||!1;b._subscription=c.subscription;b._conversationPartnerName=c.conversationPartnerName||"Amelia";b._sessionMode=c.sessionMode||"USER";b._inboundMessageType="AGENT"===c.sessionMode?"InboundAgentUtteranceMessage":"InboundUserUtteranceMessage";b._subscription.subscribe();b.unsubscribe=function(){b._subscription.unsubscribe()};b._checkEmotionalState=function(a){a&&a.emoticon&&b._mood!==a.emoticon&&(e.fireEvent("moodChange",b.publicConversation,a.emoticon,b._mood),b._mood=a.emoticon,b.publicConversation.mood=a.emoticon)};b.changeLanguage=function(a,c){"both"===c?(b._sendMessageToServer({attributes:{direction:"in",language:a}},"InboundChangeSessionLanguageMessage"),b._sendMessageToServer({attributes:{direction:"out",language:a}},"InboundChangeSessionLanguageMessage")):b._sendMessageToServer({attributes:{direction:c,language:a}},"InboundChangeSessionLanguageMessage")};b._inputEnabled=!1;b._inputSecure=!1;b._inputOffTheRecord=!1;b._inputOffTheRecordBlocked=!1;b._typing=!1;b._pendingFormOnlySubmission=!1;b._inReplay=!1;b._toggleSecureState=function(c,g,l){-1<a._secureAbleMessageTypes.indexOf(g)&&(c=null!=c&&void 0!=c&&!0===c.secureResponse,b._inputSecure!==c&&(c?e.fireEvent("inputMask",b.publicConversation,g,l):e.fireEvent("inputUnmask",b.publicConversation,g,l),b._inputSecure=c))};b._toggleOffTheRecordState=function(c,g,l,h){-1<a._offTheRecordAbleMessageTypes.indexOf(g)&&(c=null!=c&&void 0!=c&&!0===c.offTheRecordResponse,b._inputOffTheRecord!==c&&(!1===c?l||!1===b._inputOffTheRecordBlocked?(b._inputOffTheRecord=c,b._inputOffTheRecordBlocked=l,e.fireEvent("inputOnTheRecord",b.publicConversation,g,h)):console.error("Blocked by policy"):(b._inputOffTheRecord=c,b._inputOffTheRecordBlocked=l,e.fireEvent("inputOffTheRecord",b.publicConversation,g,h))))};b._toggleAllowIntentInFormInputState=function(c,g){if(-1<a._allowIntentDetectionInFormInputTypes.indexOf(g)){var e=null!=c&&void 0!=c&&!0===c.allowIntentDetectionInFormInput;b._allowIntentDetectionInFormInput!==e&&(b._allowIntentDetectionInFormInput=e)}};b._toggleInputState=function(a,c,l){"OBSERVER"===b._sessionMode?b._inputEnabled&&!1===a&&(void 0!=l&&!0===l.suppressEvent||e.fireEvent("inputDisabled",b.publicConversation,c,l),b._inputEnabled=a):!0!==b._inReplay&&b._inputEnabled!==a&&(a?!1===b._pendingFormOnlySubmission?(void 0!=l&&!0===l.suppressEvent||e.fireEvent("inputEnabled",b.publicConversation,c,l),b._inputEnabled=a):l&&!0===l.force&&(!0!==l.suppressEvent&&e.fireEvent("inputEnabled",b.publicConversation,c,l),b._inputEnabled=a,b._pendingFormOnlySubmission=!1):(void 0!=l&&!0===l.suppressEvent||e.fireEvent("inputDisabled",b.publicConversation,c,l),b._inputEnabled=a))};b._checkInputStatus=function(a,c){var e,h;switch(a.messageType){case"OutboundTextMessage":a.attributes&&"object"===typeof a.attributes&&a.attributes.formInputData?"FORM_ONLY"===a.attributes.formInputData.allowedUserInputs?(e=!1,b._pendingFormOnlySubmission=!0,h={formRequest:!0}):e=!0:a.messageText&&-1!==a.messageText.indexOf("UPLOAD_REQUEST_MESSAGE_EVENT")?(e=!1,h={uploadRequest:!0}):e="true"===c["X-Amelia-Input-Enabled"];break;case"OutboundAckRequestMessage":b._sendMessageToServer({},"InboundAckMessage");return;case"OutboundFormInputMessage":if(a.formInputData){"FORM_ONLY"===a.formInputData.allowedUserInputs||"form_only"===a.formInputData.allowedUserInputs?(e=!1,b._pendingFormOnlySubmission=!0):e=!0;break}default:e="true"===c["X-Amelia-Input-Enabled"]}b._toggleInputState(e,a.messageType,h);b._toggleSecureState(a.attributes,a.messageType,h);b._toggleOffTheRecordState(a.attributes,a.messageType,!0,h);b._toggleAllowIntentInFormInputState(a.attributes,a.messageType,h)};b._sendMessageToServer=function(a,c){var l=c===b._inboundMessageType;if(b._inputEnabled||!0!==l){if(null===a||void 0===a)a={};a.secure=!0===b._inputSecure;a.offTheRecord=!0===b._inputOffTheRecord;a.allowIntentDetectionInFormInput=!0===b._allowIntentDetectionInFormInput;b._subscription?(b._subscription.send(a,c),l&&b._toggleInputState(!1,c)):e.fireEvent("ErrorNoActiveSubscription",b.publicConversation,b._conversationPartnerName,a?a.messageText:void 0)}else e.fireEvent("ErrorInputBlocked",b.publicConversation,b._conversationPartnerName,a?a.messageText:void 0);"InboundReplayConversationMessage"==c&&(b._toggleInputState(!1,"InboundReplayConversationMessage"),b._inReplay=!0,e.fireEvent("conversationReplayStart",b.publicConversation,b._conversationId,{}))};b.publicConversation={sessionMode:b._sessionMode,sessionId:b._sessionId,conversationId:b._conversationId,contextId:b._contextId,conversationPartnerName:b._conversationPartnerName,voice:b._voice,mood:b._mood,domainId:b._domainId,domainCode:b._domainCode,started:!1};b._setConversationPartnerName=function(a){b._conversationPartnerName=a;b.publicConversation.conversationPartnerName=a};b._setVoice=function(a){b._voice=a;b.publicConversation.voice=a};b._setDomain=function(a){b._domainCode=a.code;b._domainId=a.id;b._languageCode=a.localeLanguageTag;b.publicConversation.domainCode=a.code;b.publicConversation.domainId=a.id;b.publicConversation.languageCode=a.localeLanguageTag};b._setContextId=function(a){b._contextId=a;b.publicConversation.contextId=a}};a._AmeliaConversation=N;a.checkSession=function(){A("/Amelia/api/httpSession/check",a._sessionHeaders({}),void 0,void 0,function(c){try{if(c.responseText&&0<c.responseText.length){var b=JSON.parse(c.responseText);b&&!0===b.success?(b.csrfToken&&(a._csrfToken=b.csrfToken),a._wsConnection.connect(a._csrfToken)):(u=!0,delete a._conversationsBySessionId,a._conversationsBySessionId={},a._csrfToken=null,a._data=void 0,a._setUser(void 0),e.fireEvent("sessionFail",c.status,"SESSION_INVALID",c.responseText))}}catch(d){u=!0,delete a._conversationsBySessionId,a._conversationsBySessionId={},a._csrfToken=null,a._data=void 0,a._setUser(void 0),e.fireEvent("sessionFail",c.status,"INVALID_JSON",c.responseText)}},function(c){a._wsConnection.reconnect()})};a._getConversationByMessage=function(c){return a._conversationsBySessionId[c.headers["X-Amelia-Session-Id"]]};a._getConversationBySessionId=function(c){return c?a._conversationsBySessionId[c]||{_empty:!0}:a._getForegroundConversation()};a._getForegroundConversation=function(){return a._conversationsBySessionId[a.getSessionId()]||{_empty:!0}};a._getDomain=function(){return void 0===a.getDomainCode()||void 0===a._domains[a.getDomainCode()]?void 0:a._domains[a.getDomainCode()]};a._getVoice=function(c){return a._getConversationBySessionId(c)._voice||"VW Julie"};a.getLanguageCode=function(){return a._getForegroundConversation()._languageCode||"en-US"};a.getInputEnabled=function(){return a._getForegroundConversation()._inputEnabled||!1};a.setInputEnabled=function(c,b,d){d=d||{suppressEvent:!0};d.force=!0;b=b?a._getConversationBySessionId(b):a._getForegroundConversation();return!b||b._empty?void 0:b._toggleInputState(c,"Explicit",d)};a.getUserInterface=function(){return a._userInterface};a._setUserInterface=function(c){a._userInterface=c};a.getCurrentMood=function(c){return a._getConversationBySessionId(c)._mood};a.getTimeOfLastMessage=function(c){return a._getConversationBySessionId()._timeOfLastMessage};var H=function(){var a=window.location.search.substring(1),b=F(a);return F(a,function(a){return void 0!==b["bpn_"+a]?!1:0===a.indexOf("bpn_")?a.substring(4):a})};void 0!==f.initialBpnVariables&&(f.initialConversationVariables=f.initialBpnVariables);a._initialConversationVariables=void 0===f.initialConversationVariables?H:"object"===typeof f.initialConversationVariables?function(){return!0===f.initialBpnVariablesMerge?Object.assign({},f.initialConversationVariables,H()):f.initialConversationVariables}:"function"===typeof f.initialConversationVariables?function(){return!0===f.initialBpnVariablesMerge?Object.assign({},f.initialConversationVariables(),H()):f.initialConversationVariables()}:H;var I=function(){return F(window.location.search.substring(1),function(a,b){return 0===a.indexOf("attrib_")?a.substring(7):!1})};a._initialConversationAttributes=void 0===f.initialConversationAttributes?I:"object"===typeof f.initialConversationAttributes?function(){return!0===f.initialConversationAttributesMerge?Object.assign({},f.initialConversationAttributes,I()):f.initialConversationAttributes}:"function"===typeof f.initialConversationAttributes?function(){return!0===f.initialConversationAttributesMerge?Object.assign({},f.initialConversationAttributes(),I()):f.initialConversationAttributes()}:I;a._defaultExtractLanguageFn=function(){if(void 0!==window.location.search)return F(window.location.search.substring(1)).language};a._joinExtractLanguageFn=a._defaultExtractLanguageFn;a._minIdleTime=f.minIdleTime||3E5;a._varIdleTime=f.varIdleTime||6E5;var u=!0;a._establishChatLevelByUser=function(c){a._is37OrHigher=c&&void 0!==c.defaultConversationDomainId&&void 0!==c.passwordChangeAllowed?!0:!1};a._initSession=function(c){u&&A("/Amelia/api/init",a._sessionHeaders({}),function(a){u=!1},void 0,function(b){u=!0;var d;try{b.getResponseHeader("x-amelia-session-auth")&&(a._ameliaSessionId=b.getResponseHeader("x-amelia-session-auth"));d=JSON.parse(b.responseText);d.csrfToken&&(a._csrfToken=d.csrfToken);d.appConfig&&(a._appConfig=d.appConfig,e.fireEvent("appInit",a._appConfig),void 0===d.appConfig.avatar||null===d.appConfig.avatar?(a._playBml=a._extractTextV3,a._isV3=!0):(a._playBml=a._extractTextV4,a._isV4=!0));d.csrfToken&&(a._csrfToken=d.csrfToken);if(d.user&&!1===d.user.anonymous||!0===a._allowAnonymous&&d.appConfig&&!0===d.appConfig.allowAnonymous)d.user&&(a._wsConnection||(a._wsConnection=new M(a._initialConfig),a._wsConnection.connect(a._csrfToken)),a._setUser(d.user),e.fireEvent("userInit",a._user)),e.fireEvent("loginSuccess","success",d.user,{});a._fetchDomains(function(b){try{var l=a._setDomains(JSON.parse(b.responseText).content);e.fireEvent("domainFetch",l)}catch(h){e.fireEvent("domainFetch",[])}"function"===typeof c&&c.call(a,d)},function(){"function"===typeof c&&c.call(a,d)})}catch(g){u=!0,a._data=void 0,a._setUser(void 0),e.fireEvent("sessionFail",b.statusText,"INVALID_JSON",g.toString())}},function(b){u=!0;a._data=void 0;a._setUser(void 0);e.fireEvent("sessionFail",b.status,b.statusText,b.respontText)})};a._initialize=function(c){a._initSession(function(b){!0===b.loggedIn&&!1===b.user.anonymous||!0===b.appConfig.allowAnonymous?!1===a._rejoin&&a._setDomainAndStart(c.domainCode||a._initialConfig.domainCode):a.initAuthSystems(function(b){void 0!==a._user&&!0!==a._user.anonymous||a.fireEvent("loginRequired",b);a.fireEvent("appReady")})})};a.initialize=function(c){a._initSession(function(b){if(!0===b.loggedIn&&!1===b.user.anonymous||!0===b.appConfig.allowAnonymous){if(null!==a._user&&void 0!==a._user){if(!0===a._rejoinIfPossible(b))return;if(c&&c.domainCode&&a._domains[c.domainCode]){a.setDomainCode(c.domainCode);a._startWithDomain();return}if(!0===a._canJoinDefaultDomain&&a._user&&void 0!==a._user.defaultConversationDomainId&&(b=a._domainsById[a._user.defaultConversationDomainId])&&!0!==a._hasDomainBeenSet){a.setDomainCode(b.code);a._startWithDomain();return}}a.fireEvent("appReady")}else a.initAuthSystems(function(b){void 0!==a._user&&!0!==a._user.anonymous||a.fireEvent("loginRequired",b);a.fireEvent("appReady")})})};a.newConversation=function(c){a._appConfig&&a._wsConnection?a._newConversation(c||{}):a._initialize(c||{})};a._newConversation=function(c){try{null!=a.getConversationId()&&!1===a._multipleConversationMode?(a._sendMessageToServer({},"InboundConversationClosedMessage"),a._pendingResetConversation=c||!0):a._startWithDomain(c)}catch(b){e.fireEvent("conversationFail",-1,"unknown error starting conversation",b.toString())}};a._domains={};a._domainsById={};a._visibleDomains=[];a._setDomains=function(c){a._domains={};a._domainsById={};a._visibleDomains=[];for(var b=0;b<c.length;b++)a._domains[c[b].code]=c[b],a._domainsById[c[b].id]=c[b],!0!==a._includeHiddenDomains&&!0===c[b].hidden||a._visibleDomains.push(c[b]);return a._visibleDomains};a.getMyOpenConversations=function(c,b){!0===a._multipleConversationMode&&A("/Amelia/api/conversations/my/open",a._sessionHeaders({}),function(){},void 0,function(d){try{var g=JSON.parse(d.responseText);if(g&&0<g.content.length)if(!0===c){if(a._user){var l=b?b.conversationId:void 0,h=g.content.filter(function(a){return a.conversationId!==l});for(d=0;d<h.length;d++)a._joinExistingConversation(h[d],!1)}}else e.fireEvent("conversationopenlist",g.content);else!0!==c&&e.fireEvent("conversationopenlist",[])}catch(k){e.fireEvent("conversationopenlistfail",k)}},function(a){c?e._switchDomainAndStart():e.fireEvent("conversationopenlistfail",a.statusText)})};a._fetchDomains=function(c,b){A("/Amelia/api/domains",a._sessionHeaders({}),void 0,void 0,c,b)};a._rejoinIfPossible=function(c){if("object"===typeof f.rejoin&&a._user&&!1===a._user.anonymous&&f.rejoin.conversationId){if("AGENT"===f.rejoin.sessionMode)return a._pickupConversation(f.rejoin.conversationId,f.rejoin),!0;if("OBSERVER"===f.rejoin.sessionMode)return a._observeConversation(f.rejoin.conversationId,f.rejoin),!0}var b=void 0==c?void 0:c.lastActiveConversation;return!0===a._rejoin&&void 0!==b&&null!==b&&void 0!==b.conversationId&&null!==b.conversationId?(a._joinExistingConversation(c.lastActiveConversation,!0),a._rejoin=!1,!0):!1};a._setDomainAndStart=function(c){switch(c){case"_automatic":case"":case void 0:if(a._user&&void 0!==a._user.defaultConversationDomainId&&(c=a._domainsById[a._user.defaultConversationDomainId])&&!0!==a._hasDomainBeenSet){a.setDomainCode(c.code);a._startWithDomain({domainCode:c.code});break}a._domainCode=void 0;switch(a._visibleDomains.length){case 0:e.fireEvent("domainFail","ERROR_NO_DOMAIN","unable to obtain a domain for this user");break;case 1:a.setDomainCode(a._visibleDomains[0].code);a._startWithDomain(a._visibleDomains[0].code);break;default:e.fireEvent("domainFetch",a._visibleDomains)}break;case"_manual":a._domainCode=void 0;0===a._visibleDomains.length?a._fetchDomains(function(b){a._domainCode=void 0;b=a._setDomains(JSON.parse(b.responseText).content);e.fireEvent("domainFetch",b)},function(){e.fireEvent("domainFail","ERROR_DOMAIN",xhr.statusText)}):e.fireEvent("domainFetch",a._visibleDomains);break;default:void 0===a._domains[a.getDomainCode()]?e.fireEvent("domainFail","ERROR_INVALID_DOMAIN","unable to obtain domain "+a.getDomainCode()+" for this user"):a._startWithDomain()}};a._pickupConversation=function(c,b){var d=b||{};d.sessionMode="OBSERVER";B(d,{sessionMode:"OBSERVER",clientTimestamp:(new Date).getTime(),channel:a.channels.AGENT||"js_sdk"});a._internalConnectConversation("/Amelia/api/conversations/"+
c+"/join",{conversationId:c},"AGENT",d)};a._observeConversation=function(c,b){var d=b||{};B(d,{sessionMode:"OBSERVER",clientTimestamp:(new Date).getTime(),channel:a.channels.OBSERVER||"js_sdk"});a._internalConnectConversation("/Amelia/api/conversations/"+c+"/join",{conversationId:c},"OBSERVER",d)};a._joinExistingConversation=function(c,b,d){d=d&&d.sessionLocale?d.sessionLocale:a._joinExtractLanguageFn();a._internalConnectConversation("/Amelia/api/conversations/"+c.conversationId+"/join",c,"USER",b,{sessionMode:"USER",userInterface:"WEB_USER",clientTimestamp:(new Date).getTime(),sessionLocale:d,channel:a.channels.USER||"js_sdk"},"join")};a._internalConnectConversation=function(c,b,d,g,l,h){delete l.conversationId;x(c,a._sessionHeaders({"Content-Type":"application/json"}),void 0,JSON.stringify(l),void 0,void 0,function(c){var f;try{f=JSON.parse(c.responseText)}catch(m){e.fireEvent("conversationFail","INVALID_JSON",m.toString());return}c=b.conversationId||f.conversationId;a._subscribe(d,{conversationId:c,contextId:b.contextId||f.contextId,sessionId:f.sessionId,languageCode:f.lang?options.newLang:void 0},h);for(var t=l.domainCode||void 0,n=f.domainId||void 0,v=void 0===n?function(a){return a.code===t}:function(a){return a.id===n},C=a._getConversationBySessionId(f.sessionId),p=0;p<a._visibleDomains.length;p++)if(!0===v(a._visibleDomains[p])){a.setDomainCode(a._visibleDomains[p].code);C._setDomain(a._visibleDomains[p]);break}C.publicConversation.started=!0;!0!==g&&null!==a._foreGroundSessionId||a.switchConversation(f.sessionId);e.fireEvent("conversationStart",C.publicConversation,f.sessionId,c,C.publicConversation.domainCode);if("USER"!==d||"join"===h)C._inReplay=!0,C._toggleInputState(!1,"InboundReplayConversationMessage"),e.fireEvent("conversationReplayStart",C.publicConversation,a.getConversationId(),{})},function(a){e.fireEvent("conversationFail",a.status,a.statusText,a.responseText)})};a._startWithDomain=function(c){var b;b=c?c.domainCode?c.domainCode:a.getDomainCode():a.getDomainCode();if(void 0===b)e.fireEvent("conversationFail","MISSING_DOMAIN","A valid domain is required to start a conversation");else{a._messages=new Queue;b={domainCode:b,clientTimestamp:(new Date).getTime(),userInterface:a.getUserInterface(),channel:a.channels.USER||"js_sdk"};var d=a._initialConversationVariables();c&&c.initialBpnVariables&&(d=Object.assign(d||{},c.initialBpnVariables));void 0!==d&&(b.initialBpnVariables=d);d=a._initialConversationAttributes();c&&c.initialConversationAttributes&&(d=Object.assign(d||{},c.initialConversationAttributes));null!=d&&(b.initialAttributes=d);b.sessionLocale=c&&c.sessionLocale?c.sessionLocale:a._defaultExtractLanguageFn()||"auto";c=a._languageCode;d=void 0===a._getDomain()?a._languageCode:b.sessionLocale||a._getDomain().localeLanguageTag;c!==d&&e.fireEvent("languageChange",{},d,c);a._languageCode=d;a._internalConnectConversation("/Amelia/api/conversations/new",{},"USER",!0,b)}};a.joinConversation=function(c,b){b=b||{};var d=b.sessionMode||"USER";"USER"===d?a._joinExistingConversation({conversationId:c},b.makeForeGround||!0,b):"OBSERVER"===d?a.observeConversation(c,b):"AGENT"===d&&a.pickupConversation(c,b)};a.observeConversation=function(c,b){var d=b||{};delete d.after;B(d,{sessionMode:"OBSERVER",clientTimestamp:(new Date).getTime(),channel:a.channels.OBSERVER||"js_sdk"});a._internalConnectConversation("/Amelia/api/conversations/"+c+"/join",{conversationId:c},"OBSERVER",!0,d)};a.pickupConversation=function(c,b){var d=b||{};delete d.after;d.sessionMode="OBSERVER";B(d,{sessionMode:"OBSERVER",clientTimestamp:(new Date).getTime(),channel:a.channels.AGENT||"js_sdk"});a._internalConnectConversation("/Amelia/api/conversations/"+c+"/join",{conversationId:c},"AGENT",!0,d)};a._sessionHeaders=function(c){c=c||{};null!==a._csrfToken&&void 0!==a._csrfToken&&(c["X-CSRF-TOKEN"]=a._csrfToken);null!==a._ameliaSessionId&&void 0!==a._ameliaSessionId&&(c["X-Amelia-Session-Auth"]=a._ameliaSessionId);return c};a._subscribe=function(c,b,d){var g=[];switch(c){case"USER":g.push({msgBody:{},msgType:"join"===d?"InboundReplayConversationMessage":"InboundStartConversationMessage"});break;case"AGENT":g.push({msgBody:{},msgType:"InboundReplayConversationMessage"});g.push({msgBody:{},msgType:"InboundAgentPickupMessage"});break;case"OBSERVER":g.push({msgBody:{},msgType:"InboundReplayConversationMessage"}),b._inputEnabled=!1,e.fireEvent("inputDisabled","InboundReplayConversationMessage",{sessionMode:"OBSERVER"})}a._toggleInputState=function(b,c,d){a._getForegroundConversation()._toggleInputState(b,c,d)};d=function(a,b,c){c._timeOfLastMessage=(new Date).getTime()};var f=function(){for(;void 0!==a._messages.peek()&&!0===a._messages.peek().ready;){var b=a._messages.dequeue();e.fireEvent("messageReceived",b.conversation,b.message);e.fireEvent(b.msgBody.messageType,b.conversation,b.msgBody.messageType,b.msgBody,b.message.headers)}},h=function(){return!1};a.unsolicitedUpload=function(b){b=a._getConversationBySessionId(b);if(null===b||void 0===b)b=a._getForegroundConversation();k("","",!0,!1,void 0,void 0,b,!0)};a.submitUpload=function(){a._dropzone&&a._dropzone.processQueue()};var k=function(b,c,d,g,f,h,l,k){if(!0!==a._customUpload&&(!0===k||h)){d&&(l._pendingCancellableRequest=!0);var r,q,K=function(a){return encodeURIComponent(a.replace(/\s/g,"_"))},w,z;if(h)if(r=h.cmObjectType,q=h.maxSize,h.supportedTypes){w=[];for(b=0;b<h.supportedTypes.length;b++)for(d=0;d<h.supportedTypes[b].fileExtension.length;d++)w.push("."+h.supportedTypes[b].fileExtension[d]);w=w.join(",")}else if(w="*",h.fileExtensions&&0<h.fileExtensions.length)for(z=h.fileExtensions[0],b=1;b<h.fileExtensions.length;b++)z+=","+h.fileExtensions[b];a._dropzone&&(b=Dropzone.instances.indexOf(a._dropzone),-1<b&&((d=Dropzone.instances.splice(b,1))&&0<d.length&&(d[0].disable(),d[0].element.dropzone=void 0,d[0]=void 0),a._dropzone=void 0));b={conversationId:l._conversationId,unsolicited:k};d=l._contextId||a.getContextId();null===d||void 0===d?(b.resourceType=r,z=void 0===w?null:w):null!==z&&void 0!==z&&(z="."+z.replace(/,/g,",."));w=document.getElementById("fileUpload");d=document.getElementById("fileUploadDz");if(void 0===d||null===d)d=document.createElement("div"),d.id="fileUploadDz",d.innerHTML="",d.style.width="250px",d.style.height="250px",d.style.zIndex=w.style.zIndex+1,w.appendChild(d);d=document.getElementById("fileUploadConfirm");if(void 0===d||null===d)d=document.createElement("div"),d.id="fileUploadConfirm",d.innnerHTML="Confirm",d.style.width="75px",d.style.height="75px",d.style.zIndex=w.style.zIndex+1,w.appendChild(d);d.onclick=function(){a._dropzone.processQueue();return!1};d=document.getElementById("fileUploadCancel");if(void 0===d||null===d)d=document.createElement("div"),d.id="fileUploadCancel",d.innnerHTML="Cancel",d.style.width="75px",d.style.height="75px",d.style.zIndex=w.style.zIndex+1,w.appendChild(d);d.style.visibility=!0===l._pendingCancellableRequest?"visible":"hidden";d.onclick=function(){!0===l._pendingCancellableRequest&&(a.cancelRequest({},l._sessionId),a._dropzone.destroy());return!1};a._dropzone=new Dropzone("div#fileUploadDz",{preventDropOnDocument:!0,maxFilesize:void 0===q?10:q/1E3/1E3,autoProcessQueue:!1,acceptedFiles:z,renameFilename:K,params:b,url:function(b){return a.getUploadUrl()},headers:a.getUploadHeaders(),success:function(b,d,g){b=K(b.name);if("Error"===d)e.fireEvent("uploadFail",c,b,r,h);else{g=document.createElement("a");g.href=d;l._toggleInputState(!0,"Upload",{uploadRequest:!0});g="The file "+g.cloneNode(!1).href+"\x26fileName\x3d"+b+" was successfully uploaded.";var f;if(!0===k)if("object"===typeof d)f=d;else try{f=JSON.parse(d)}catch(v){f=d}a.confirmUpload(g,f,!0,l._sessionId);e.fireEvent("uploadSuccess",c,b,d+"\x26fileName\x3d"+b)}},error:function(a,b,d){b="";a&&a.name&&(b=a.name);e.fireEvent("uploadFail",c,b,r,h)}})}},r=function(a,b){if(b.attributes&&b.formInputData)try{b.formInputData=JSON.parse(b.formInputData)}catch(c){}if(b.attributes&&b.attributes.formInputData)try{b.attributes.formInputData=JSON.parse(b.attributes.formInputData)}catch(c){}};d=a._buildSubscriptionConfig(a._subscriptionConfig,{OutboundIntegrationMessage:function(a,b,c){try{b.integrationMessageData=JSON.parse(b.integrationMessageData)}catch(d){}try{b.attributes.integrationMessageData=JSON.parse(b.attributes.integrationMessageData)}catch(d){}},OutboundFormInputMessage:r,OutboundTextMessage:r},{OutboundDeepDmStatusMessage:[h],OutboundDomainChangeMessage:[d,function(b,c,d){(b=a._domainsById[c.newDomainId])&&a.setDomainCode(b.code)}],OutboundParaphraseStatusMessage:[h],OutboundCharacterAffectUpdateStatusMessage:[d],OutboundUserSatisfactionUpdateStatusMessage:[d],OutboundBmlStatusMessage:[],OutboundTextMessage:[d],OutboundEchoMessage:[d,function(a,b){if(null===b.messageText||void 0===b.messageText)return!1;if(-1!=b.messageText.indexOf("getFile")){for(var c=b.messageText.replace(/(https?:\/\/[^\s]+)/g,"$1"),c=c.substring(c.indexOf("?")+1).split("\x26amp;"),d={},e,g=decodeURIComponent,h=c.length-1;0<=h;h--)e=c[h].split("\x3d"),d[g(e[0])]=g(e[1]);c=d.name;return!(void 0===c||null===c||-1<c.indexOf("was successfully uploaded"))}}],OutboundParseStatusMessage:[h],OutboundUserAffectUpdateStatusMessage:[d],OutboundBpnExecutionEventMessage:[],OuboundFormInputMessage:[d],OutboundIntegrationMessage:[d],OutboundEscalationStartedMessage:[d],OutboundArbitrationResultsMessage:[h],OutboundAgentSessionChangedMessage:[d],OutboundReplayFinishedMessage:[function(b,c,d){d._pendingCancellableRequest=!1;d._pendingFormOnlySubmission=!1;d._inReplay=!1;d._toggleInputState(!0,"OutboundReplayFinishedMessage");e.fireEvent("conversationReplayEnd",d.publicConversation,a.getConversationId(),{})}],OutboundAmeliaReadyMessage:[h],OutboundConversationClosedMessage:[d,function(b,c,d){d._inReplay=!1;d._pendingCancellableRequest=!1;d._mode=null;d._inboundMessageType=null;d._pendingFormOnlySubmission=!1;d.unsubscribe();d._contextId=null;delete a._conversationsBySessionId[d._sessionId];a._foreGroundSessionId===d._sessionId&&(a._foreGroundSessionId=null);void 0!==a._pendingResetConversation&&!1!==a._pendingResetConversation&&(a._domainCode=d._domainCode,a._startWithDomain(a._pendingResetConversation),delete a._pendingResetConversation)}],OutboundFqtCreatedMessage:[d],OutboundAckRequestMessage:[h],OutboundBpnCompositionEventMessage:[],OutboundBpnExecutionMessage:[],OutboundNewBpnExecutionEventMessage:[],OutboundRequestMessage:[d,function(a,b,c){k(b.messageText,b.fromUserDisplayName,!0===b.cancellable,!0===b.multiple,b.hintText,b.resourceToRequest||b.resource_to_request,c,!1);b.messageText=""}],OutboundPresentMessage:[function(b,c,d){if(c.resourceToPresent){var e=c.resourceToPresent,g={id:c.id,msgBody:c,message:b,conversation:d.publicConversation,ready:!1};a._messages.enqueue(g);b={conversationId:c.conversationId,bucketName:e.bucketName,fileName:e.filename,sessionId:b&&b.headers?b.headers["X-Amelia-Session-Id"]:a.getSessionId()};d=c.contextId||a.getContextId();null!==d&&void 0!==d&&(b.contextId=d);void 0!==e.processInstanceId&&null!==e.processInstanceId&&(b.processInstanceId=e.processInstanceId);x("/Amelia/api/cm/download/",a._sessionHeaders({"Content-type":"multipart/form-data"}),b,void 0,void 0,function(a){a.responseType="blob"},function(a){var b=window.URL.createObjectURL(a.response),c=new Blob([a.response]);g.ready=!0;g.msgBody.resourceToPresent.url=b;g.msgBody.resourceToPresent.blob=c;g.msgBody.resourceToPresent.contentType=a.getResponseHeader("content-type");f()},function(){c.messageText="Unable to retrieve file";g.ready=!0;f()});return!1}return!0},d],OutboundSessionClosedMessage:[function(b,c,d){d.unsubscribe();delete a._conversationsBySessionId[d._conversationId];a._foreGroundSessionId===d._sessionId&&(a._foreGroundSessionId=null)}],OutboundSystemErrorMessage:[d],OutboundConversationSuspendedMessage:[d],OutboundRecommendationsMessage:[d]},f,function(a){for(var b=0;b<g.length;b++)a.send(g[b].msgBody,g[b].msgType,{});e.fireEvent("onconnect")});d.wsConnection=a._wsConnection;d.conversationId=b.conversationId;d.sessionId=b.sessionId;a._conversationsBySessionId[b.sessionId]=new N({conversationId:b.conversationId,sessionId:b.sessionId,languageCode:b.languageCode,sessionMode:c,subscription:new U(d)})};a._baseProperties="messageText id contextId sourceClass translated messageType messageId voice inResponseToMessageId fromUserDisplayName conversationId sourceSessionId responsePoolContext".split(" ");a._propertiesToRename={hint_text:"hintText",resource_to_request:"resourceToRequest"};a._buildSubscriptionConfig=function(c,b,d,g,f){var h={},k;for(k in c)c.hasOwnProperty(k)&&(h[k]=c[k]);h.messageHandler=function(c){var h=a._getConversationByMessage(c),f=JSON.parse(c.body);if(void 0===f.attributes){var l={},k;for(k in f)f.hasOwnProperty(k)&&-1===a._baseProperties.indexOf(k)&&(void 0===a._propertiesToRename[k]?l[k]=f[k]:l[a._propertiesToRename[k]]=f[k]);f.attributes=l;c.body=JSON.stringify(f)}void 0!=f.contextId&&h._setContextId(f.contextId);b[f.messageType]&&b[f.messageType].call(a,c,f,h);h._checkInputStatus(f,c.headers);h._checkEmotionalState(f.attributes);f.voice&&(h._setVoice(f.voice),!0===a._isV4&&(l=f.locale)&&l!==h._languageCode&&(h.publicConversation.languageCode=l,e.fireEvent("languageChange",h.publicConversation,l,h._languageCode),h._languageCode=l));f.fromUserDisplayName&&"false"===c.headers["X-Amelia-Self-Echo"]&&h._setConversationPartnerName(f.fromUserDisplayName);if(d[f.messageType])for(l=0;l<d[f.messageType].length;l++)if(!1===d[f.messageType][l].call(a,c,f,h))return;!0===a._autoSpeak&&a._playBml(f,c.headers,h);0===a._messages.getLength()?(e.fireEvent("messageReceived",h.publicConversation,c),e.fireEvent(f.messageType,h.publicConversation,f.messageType,f,c.headers)):(a._messages.enqueue({id:f.id,msgBody:f,message:c,conversation:h.publicConversation,ready:!0}),g())};h.onSubscribeCallback=f;return h};a._disableAllSubscriptions=function(){var c=[],b;for(b in a._conversationsBySessionId)a._conversationsBySessionId[b].unsubscribe(),c.push(b);for(b=0;b<c.length;b++)delete a._conversationsBySessionId[c[b]];a._foreGroundSessionId=null};a._disconnect=function(){a._wsConnection&&a._wsConnection.connected&&(a._wsConnection.disconnect(),delete a._wsConnection)};a._loginSuccess=function(c){c.getResponseHeader("x-amelia-session-auth")&&(a._ameliaSessionId=c.getResponseHeader("x-amelia-session-auth"));c=JSON.parse(c.responseText);c.user?(delete a._conversationsBySessionId,delete a._foreGroundSessionId,a._conversationsBySessionId={},c.csrfToken&&(a._csrfToken=c.csrfToken),a._wsConnection||(a._wsConnection=new M(a._initialConfig),a._wsConnection.connect(a._csrfToken)),a._setUser(c.user),e.fireEvent("userInit",a._user),e.fireEvent("loginSuccess","success",c.user,{expirationDate:c.expirationDate,expirationWarning:c.expirationWarning}),a._fetchDomains(function(b){try{var c=a._setDomains(JSON.parse(b.responseText).content);e.fireEvent("domainFetch",c);if(!0===a._canJoinDefaultDomain&&a._user&&void 0!==a._user.defaultConversationDomainId){var g=a._domainsById[a._user.defaultConversationDomainId];if(g&&!0!==a._hasDomainBeenSet){a.setDomainCode(g.code);a._startWithDomain();return}}e.fireEvent("appReady")}catch(f){e.fireEvent("domainFetch",[]),e.fireEvent("appReady")}},function(){e.fireEvent("domainFetch",[]);e.fireEvent("appReady")})):(e.fireEvent("loginFail","failure",c),e.fireEvent("appReady"))};a._loginFailure=function(a){try{var b=JSON.parse(a.responseText);e.fireEvent("loginFail","error",b)}catch(d){e.fireEvent("loginFail","error",{code:"UNKNOWN_ERROR",statusText:a.statusText})}};a.login=function(c){if(null===c||void 0===c)e.fireEvent("loginFail","MISSING_OPTIONS");else{e.fireEvent("inputDisabled",{},"loginAttempt",{loginAttempt:!0});a._hasDomainBeenSet=!1;a._disableAllSubscriptions();a._disconnect();"INTERNAL"===c.type&&(c.redirect=!1,void 0===c.loginPath&&(c.loginPath="/Amelia/api/login"));var b=function(a){a.loginPath.startsWith("/Amelia/")||(a.loginPath.startsWith("/")?a.loginPath="/Amelia"+a.loginPath:a.loginPath.startsWith("#")?a.loginPath=window.location.href+a.loginPath:a.loginPath="/Amelia/"+a.loginPath)};!0===c.redirect?void 0===c.loginPath?e.fireEvent("loginFail","MISSING_REDIRECT_PATH","redirect without loginPath provided"):(b(c),window.location.href=c.loginPath):(void 0===c.loginPath?c.loginPath="/Amelia/api/login":b(c),x(c.loginPath,a._sessionHeaders({}),void 0,JSON.stringify({username:c.username,password:c.password}),function(){},void 0,a._loginSuccess,a._loginFailure))}};a.logout=function(){e.fireEvent("inputDisabled",{},"logout",{logout:!0});a._disableAllSubscriptions();A("/Amelia/api/logout",a._sessionHeaders({}),function(){},void 0,function(c){a._csrfToken=null;a._setUser(void 0);a._appConfig=void 0;a._data=void 0;u=!0;e.fireEvent("logout","logout")},function(c){a._csrfToken=null;a._setUser(void 0);a._appConfig=void 0;a._data=void 0;u=!0;e.fireEvent("logout","logout")})};a.getConversations=function(){var c={},b;for(b in a._conversationsBySessionId)c[b]=a._conversationsBySessionId[b].publicConversation;return c};a.switchConversation=function(c){c!==a._foreGroundSessionId&&(a._conversationsBySessionId[c]?(a._setConversationId(a._conversationsBySessionId[c].conversationId),a._setContextId(a._conversationsBySessionId[c].contextId),a._setSessionId(c),e.fireEvent("conversationSwitch",a._conversationsBySessionId[c].publicConversation)):e.fireEvent("ErrorNoSuchConversation",c))};a.toggleOffTheRecord=function(c,b){var d=a._getConversationBySessionId(b);!0===d._empty?e.fireEvent("ErrorNoSuchConversation",b):d._toggleOffTheRecordState({offTheRecordResponse:c},"clientpreference",!1,{})};a.ask=function(c,b,d){var g=a._getConversationBySessionId(b);!0===g._empty?e.fireEvent("ErrorNoSuchConversation",b):(b=d||{},b.messageText=c,!0===g._inputSecure&&(b.secure="yes"),g._sendMessageToServer(b,g._inboundMessageType),g._timeOfLastMessage=(new Date).getTime())};a.sendActivity=function(c,b,d){var g=a._getConversationBySessionId(b);!0===g._empty?e.fireEvent("ErrorNoSuchConversation",b):g._typing!==c&&(b=d||{},b.typing=c,g._sendMessageToServer(b,"InboundUserActivityMessage"),g._timeOfLastMessage=(new Date).getTime(),g._typing=c)};a.say=a.ask;a.changeLanguage=function(c,b,d){!0===a._multipleConversationMode?(d=a._conversationsBySessionId[d])&&d.changeLanguage(c,b):null!==a._getForegroundConversation()&&void 0!==a._getForegroundConversation()&&a._getForegroundConversation().changeLanguage(c,b)};a.resumeProcess=function(c,b){var d=a._getConversationBySessionId(c);!0===d._empty?e.fireEvent("ErrorNoSuchConversation",c):(d._sendMessageToServer(b||null,"InboundProcessResumeMessage"),d._timeOfLastMessage=(new Date).getTime())};a.sendCustomConversationAttributes=function(c,b){var d=a._getConversationBySessionId(b);!0===d._empty?e.fireEvent("ErrorNoSuchConversation",b):void 0!==c&&null!==c&&(d._sendMessageToServer({customAttributes:c},"InboundSetCustomConversationAttributesMessage"),d._timeOfLastMessage=(new Date).getTime())};a.transfer=function(c,b){var d=a._getConversationBySessionId(b);!0===d._empty?e.fireEvent("ErrorNoSuchConversation",b):void 0!==c&&null!==c&&(d._sendMessageToServer({escalationQueueId:c.escalationQueueId},"InboundAgentTransferMessage"),d._timeOfLastMessage=(new Date).getTime(),d.disconnectConversation())};a.submit=function(c,b,d,g,f){var h=a._getConversationBySessionId(d);if(!0===h._empty)e.fireEvent("ErrorNoSuchConversation",d);else{var k={},r={};d=function(a,c){if(null!==b&&void 0!==b)for(var d=0;d<b.fields.length;d++)if(b.fields[d].name===a)for(var e=0;e<b.fields[d].options.length;e++)if(b.fields[d].options[e].value===c)return r[a]=b.fields[d].selectionUtteranceMetadata,b.fields[d].options[e].name};var t=function(a,b){b&&(k[a]?k[a].push(b):k[a]=[b])};if(c instanceof Element){var n=c.querySelectorAll("input, select, textarea");c={};for(var v=0,q=n.length;v<q;++v){var p=n[v],m=p.name||p.id;if("button"!==p.type&&"image"!==p.type&&"submit"!==p.type&&m)switch(p.type){case"checkbox":p.checked&&(void 0===c[m]?c[m]=p.value:(c[m]=[c[m]],c[m].push(p.value)),t(m,d(m,p.value)));break;case"radio":void 0===c[m]&&(c[m]="");p.checked&&(c[m]=p.value,k[m]=d(m,p.value));break;case"select-multiple":for(var x=[],u=0,A=p.options.length;u<A;++u)p.options[u].selected&&x.push(p.options[u].value),t(m,d(m,p.options[u].value));c[m]=x;break;default:c[m]=p.value,k[m]=d(m,p.value)}}}else for(m in c)if(c.hasOwnProperty(m))if(n=c[m],D(n))for(v=0;v<n.length;v++)t(m,d(m,n[v]));else k[m]=d(m,n);if(!g){g="";t=function(a,b){for(var c="",d=0;d<a.length;d++)c+=a[d],d!==a.length-1&&(c=d===a.length-2?c+(" "+b.conjunction+" "):c+", ");return c};m=b?b.selectionUtteranceMetadata||{conjuction:" "}:{conjuction:" "};d=" "+m.conjunction+" "||" ";for(var y in k)if(k.hasOwnProperty(y)&&(v=k[y])){n=r[y];if(D(v))switch(v.length){case 0:g+="Nothing";break;case 1:n&&(g+=n.prefixSingle+" "+t(v,n));break;default:n&&(g+=n.prefixMultiple+" "+t(v,n))}else n&&(g+=n.prefixSingle+" "+v);g+=d}""===g?g="I have submitted":d&&(y=d.length,g.substring(g.length-y)===d&&(g=g.substring(0,g.length-y)),m.prefixSingle&&(g=m.prefixSingle+" "+g),m.suffixSingle&&(g=m.suffixSingle))}if("string"===typeof c)try{c=JSON.parse(c)}catch(K){}h._pendingFormOnlySubmission=!1;h._toggleInputState(!0,"FormSubmit",{formSubmit:!0});y={formInputAttributes:c};f&&B(y,f);h._sendMessageToServer({messageText:g,attributes:y},h._inboundMessageType)}};a.action=function(c,b,d,g,f){var h=a._getConversationBySessionId(d);if(!0===h._empty)e.fireEvent("ErrorNoSuchConversation",d);else{h._pendingFormOnlySubmission=!1;h._toggleInputState(!0,"ActionSubmit",{actionSubmit:!0});var k;d=!0;f?k=f:g&&g.staticUtterance&&(k=g.staticUtterance);g&&!1===g.shouldEcho&&(d=!1);if(void 0===k||null===k)k="BPN Kickoff Message";h._sendMessageToServer({messageText:k,attributes:{processName:c,processVariables:b},shouldEcho:d},"InboundBpnKickoffMessage")}};a.createFqt=function(c){a._sendMessageToServer({attributes:c||{}},"InboundCreateFqtMessage")};a.endConversation=function(c,b){var d;d=!0===a._multipleConversationMode?a._conversationsBySessionId[b]:a._getForegroundConversation();null!==d&&void 0!==d&&!0!==d._empty?d._sendMessageToServer(void 0===c?null:{attributes:c},"InboundConversationClosedMessage"):e.fireEvent("ErrorNoSuchConversation",b)};a.disconnectConversation=function(c){a._conversationsBySessionId[c]&&(a._conversationsBySessionId[c].unsubscribe(),delete a._conversationsBySessionId[c],a._foreGroundSessionId===c&&(a._foreGroundSessionId=null))};a.getConversationPartnerName=function(c){return a._getConversationBySessionId(c)._conversationPartnerName};a._sendMessageToServer=function(c,b){a._getForegroundConversation()._sendMessageToServer(c,b)};a.clearChatHistory=function(){e.fireEvent("chatHistoryClear")};var E={};a.addEventListener=function(a,b,d){void 0===E[a]&&(E[a]=[]);E[a].push(d.bind(b))};a.addEventListeners=function(){if(0!==arguments.length){"string"===typeof arguments[0]&&a.addEventListener.apply(a,arguments);var c=arguments[0];if(c)for(var b in c)if(c.hasOwnProperty(b)){var d=c[b];D(d)||(d=[d]);for(var g=0;g<d.length;g++){var f=d[g];switch(typeof f){case"function":a.addEventListener(b,e,f);break;case"object":null!==f&&"function"===typeof f.fn&&a.addEventListener(b,void 0===f.element?e:f.element,f.fn)}}}}};a.addEventListeners(f.listeners);a.addEventListener("loginSuccess",window,function(){a._inReplay=!1;a._pendingCancellableRequest=!1;a._pendingFormOnlySubmission=!1;a._setConversationId(null);a._setContextId(null);a._pendingResetConversation=!1});a._eventLock={};a.fireEvent=function(c){if(!0!==a._eventLock[c]){a._eventLock[c]=!0;if(void 0!==E[c]){var b=[e];if(1<arguments.length)for(var d=1;d<arguments.length;d++)b.push(arguments[d]);for(d=0;d<E[c].length;d++)E[c][d].apply(void 0,b)}a._eventLock[c]=!1}else console.error("Circular event listening detected for event: "+c+".  Listeners must not fire the same event to which they are listening.  Application will continue but this event chain will be stopped.")};a._terminateSounds=function(){a._spokenQueues&&(a._spokenQueues={});a._audioQueues&&(a._audioQueues={});a._audioMaps&&(a._audioMaps={});a._currentSound&&a._currentSound.unload()};a._audioMap={};a.addFetchedAudio=function(c,b){f.speech&&(a._audioMaps[c.sessionid]||(a._audioMaps[c.sessionId]={}),a._audioMaps[c.sessionId][c.text]=b)};a.onFetchedAudioPlayStart=function(){e.fireEvent("speakstart")};a.onFetchedAudioPlayEnd=function(){a._audio&&(a._audio.playing=!1);e.fireEvent("speakend");a._currentSound=void 0};if(f.speech&&(!0===f.speech?q={muted:!1,auto:!0}:(q=f.speech,q.auto=!1===q.auto?!1:!0),a._spokenQueues={},a._audioQueues={},a._audioMaps={},a._muted=!0===q.muted,a._autoSpeak=!0===q.auto,Howler)){var q=Howler.codecs||Howler.Howler.codecs,O=!1;try{O=!0!==q("wav")&&!0===q("mp3")}catch(c){console.debug("cannot transcode to mp3, codecs not present",c)}var G=null,q=!0;try{"undefined"!==typeof AudioContext?G=new AudioContext:"undefined"!==typeof webkitAudioContext?G=new webkitAudioContext:q=!1}catch(c){q=!1}if(q&&"suspended"===G.state){var P=function(){G.resume();setTimeout(function(){"running"===G.state&&document.body.removeEventListener("touchend",P,!1)},0)};document.body.addEventListener("touchend",P,!1)}var V=Howler.Howler||Howler;a._audio={playing:!1,volume:function(a){V.volume(a)}};a._fetchSpeech=f.fetchSpeech||function(a,b){var d={text:a.text,voice:void 0===a.voice?b._getVoice():a.voice,conversationId:a.conversationId};x("/Amelia/api/speech/generate",b._sessionHeaders({"Content-Type":"application/json"}),void 0,JSON.stringify(d),function(){},void 0,function(d){(d=JSON.parse(d.responseText))&&d.audio?b.addFetchedAudio(a,d):b.addFetchedAudio(a,"")},function(d){b.addFetchedAudio(a,"")})};a._playSpeech=f.playSpeech||function(c,b){!0===O&&(c.audio=c.audio.replace(".wav",".mp3"));a._currentSound=new Howl({src:[c.audio],autoplay:!0,onplay:function(){b.onFetchedAudioPlayStart()},onend:function(){this.unload();b.onFetchedAudioPlayEnd()}})};setInterval(function(){var c=a._foreGroundSessionId;if(null!==c&&a._spokenQueues[c]){var b=a._spokenQueues[c].dequeue();a._audioQueues[c]||(a._audioQueues[c]=new Queue);void 0!==b&&void 0!==b.text&&!1===a._muted&&(a._audioQueues[c].enqueue(b),a._audioMaps[c]||(a._audioMaps[c]={}),a._audioMaps[c][b.text]=null,a._fetchSpeech(b,a));if(!1===a._audio.playing){var d,b=a._audioQueues[c].peek();void 0!==b&&null!==a._audioMaps[c][b.text]&&(b=a._audioQueues[c].dequeue(),d=a._audioMaps[c][b.text],delete a._audioMaps[c][b.text]);void 0!==d&&void 0!==d.audio&&!1===a._muted&&(a._audio.playing=!0,a._playSpeech(d,e))}}},1E3)}var Q=[RegExp("\x3cnospeak\x3e.*?\x3c/nospeak\x3e","gi"),RegExp("_Syncword\\d+_","gi")];a._extractTextV3=function(c,b,d){if(void 0!==a._audio&&c.attributes.bml)for(c=JSON.parse(c.attributes.bml),b=0;b<c.length;b++)for(var e=0;e<c[b].length;e++){var f=JSON.parse(c[b][e]),h;for(h in f)if(f.hasOwnProperty(h)&&0===h.indexOf("Speech")){var k=f[h].text;if(-1===k.indexOf("amelia-mmo")){for(var r=0;r<Q.length;r++)k=k.replace(Q[r],"");a._speak(k,d._voice,d._sessionId,d._conversationId)}}}};a._extractTextV4=function(c,b,d){b=b["X-Amelia-Source-User-Type"];c.messageText&&"OutboundTextMessage"===c.messageType&&"Amelia"===b&&a._speak(c.messageText,d._voice,d._sessionId,d._conversationId)};a._playBml=a._extractTextV4;a.getUploadHeaders=function(){return{Accept:"application/json, text/plain, */*","X-CSRF-TOKEN":a._csrfToken}};a.getUploadUrl=function(){return"/Amelia/api/cm/upload"};a.confirmUpload=function(c,b,d,f){var l=a._getConversationBySessionId(f);!0===l._empty?e.fireEvent("ErrorNoSuchConversation",f):(!0===d?l._sendMessageToServer({attributes:{cm_object_metadata_id:b.cmMetadataId}},"InboundUnsolicitedUploadMessage"):l._sendMessageToServer({messageText:c,attributes:{request_confirmation_action:"SUBMIT"}},"InboundRequestConfirmMessage"),l._pendingCancellableRequest=!1,l._timeOfLastMessage=(new Date).getTime())};a.cancelRequest=function(c,b){var d=a._getConversationBySessionId(b);!0===d._empty?e.fireEvent("ErrorNoSuchConversation",b):!0===d._pendingCancellableRequest?(d._sendMessageToServer({messageText:"File upload cancelled.",attributes:{request_confirmation_action:"CANCEL"}},"InboundRequestConfirmMessage"),e.fireEvent("uploadCancelled",d),d._pendingCancellableRequest=!1):e.fireEvent("ErrorNoCancellableRequest")};a.sendNpsCollection=function(c,b,d,e){c={feedback:c};b&&(c.outboundMessageId=b);d&&(c.answerId=d);e&&(c.feedbackText=e);a._sendMessageToServer(c,"InboundNpsCollectionMessage")};a.sendInboundDetailClickMessage=function(c,b){a._sendMessageToServer({outboundMessageId:c,answerId:b||""},"InboundDetailClickMessage")};a._speak=function(c,b,d,e){void 0!==a._audio&&(a._spokenQueues[d]||(a._spokenQueues[d]=new Queue),a._spokenQueues[d].enqueue({text:c,voice:b,sessionId:d,conversationId:e}))};a.mute=function(c){a._audio&&(a._muted=!0,a._audio.volume(0));e.fireEvent("volumechange",0)};a.unmute=function(c){if(a._audio){a._muted=!1;try{a._audio.volume(1)}catch(b){}}e.fireEvent("volumechange",1)};a.sttMicReady=function(a){e.fireEvent("micready",a)};a.sttMicFail=function(a,b){e.fireEvent("micfail",a,b)};a.sttMicRecordingStart=function(a){e.fireEvent("micrecordingstart",a)};a.sttMicTextInterim=function(a,b){e.fireEvent("mictextinterim",a,b)};a.sttMicTextFinish=function(a,b){e.fireEvent("mictextfinish",a,b)};a.sttMicRecordingEnd=function(a){e.fireEvent("micrecordingend",a)};a.sttMicNoMatch=function(a){e.fireEvent("micnomatch",a)};a._convertImage=function(a,b){b=b||{};b.imageData=a.replace(/^data:image\/(png|jpeg);base64,/,"");return JSON.stringify(b)};a.detectFace=function(c,b){var d=0,f,l=function(){var h=c();a._initSession(function(){var k=(b=b||{},b.success)||void 0,r=b&&b.failure||void 0;x("/Amelia/api/facereco/detect",a._sessionHeaders({"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}),void 0,a._convertImage(h),function(){},void 0,function(a){var n=JSON.parse(a.responseText);!0===n.success?(f=h,"function"===typeof k&&k(e,n,f,a.status)):5>d++?l(c,b):"function"===typeof r&&r(e,n,f,a.status)},function(a){5>d++?l(c,b):"function"===typeof r&&r(e,{},f,a.status)})})};l(c,b)};a.verifyFaceEnrollment=function(c,b){a._initSession(function(){var d=(b=b||{},b.success)||void 0,f=b&&b.failure||void 0;x("/Amelia/api/facereco/enroll/verify",a._sessionHeaders({"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}),void 0,JSON.stringify({nameOrEmail:c}),function(){},void 0,function(a){var b=JSON.parse(a.responseText);!0===b.verified?"function"===typeof d&&d(e,b,a.status):"function"===typeof f&&f(e,b,a.status)},function(a){"function"===typeof f&&f(e,{},a.status)})})};a.enrollFace=function(c,b,d){var f=0,l=0,h,k,r=function(b,c,d){var q=c();a._initSession(function(){var p=(d=d||{},d.success)||void 0,m=d&&d.failure||void 0;a._convertImage(q).userId=b;x("/Amelia/api/facereco/enroll/save",a._sessionHeaders({"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}),void 0,a._convertImage(q,{userId:b}),function(){},void 0,function(a){var u=JSON.parse(a.responseText);f++;!0===u.enrolled?(l=u.numFacesStoredForUser,h=q,k=u,2<l?"function"===typeof p&&p(e,k,h,a.status):r(b,c,d)):(f++,2<=l?"function"===typeof p&&p(e,k,h,a.status):5<f?"function"===typeof m&&m(e,k,h,a.status):r(b,c,d))},function(a){5<f&&"function"===typeof m&&m(e,k,h,a.status);f++})})};r(c,b,d)};a.loginFace=function(c,b){b=b||{};a._initSession(function(){x("/Amelia/api/facereco/login",a._sessionHeaders({"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}),void 0,a._convertImage(c),function(){},void 0,function(c){a._loginSuccess(c);"function"===typeof b.success&&b.success(c)},function(c){a._loginFailure(c);"function"===typeof b.failure&&b.failure(c)})})};a.recognizeAndSwitch=function(c,b){void 0===a._user||!0===a._user.anonymous?a._initSession(function(){x("/Amelia/api/facereco/recognizeAndSwitch",a._sessionHeaders({"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}),void 0,a._convertImage(c),function(){},void 0,function(b){try{var c=JSON.parse(b.responseText);!0===c.recognized?(a._setUser(c.user),void 0===a._data&&(a._data={}),e.fireEvent("loginSuccess","success",c.user,{})):e.fireEvent("loginFail","failure",c)}catch(f){e.fireEvent("loginFail","error",{code:"UNKNOWN_ERROR",statusText:b.statusText})}})}):e.fireEvent("loginFail","error",{code:"CURRENT_USER_NOT_ANONYMOUS",statusText:200})};a.getAvatarImageUrl=function(a){return"/Amelia/api/avatar/image/"+a+".png"};a.getAvatarBrandingUrl=function(a){return"/Amelia/api/avatar/branding/"+a+".png"};a.registerPlugin=function(a){void 0!==a&&"function"===typeof a.registerChatPlugin&&a.registerChatPlugin(e)};a.registerPlugins=function(c){if(0!==c.length)for(var b=0;b<c.length;b++)a.registerPlugin(c[b])};for(var J in a)a.hasOwnProperty(J)&&0!==J.indexOf("_")&&(e[J]=a[J]);void 0!==f.plugins&&(D(f.plugins)?a.registerPlugins(f.plugins):a.registerPlugin(f.plugins));void 0!==f.mic&&a.registerPlugin({button:f.mic,stopDelay:a._sttDelay,recognition:void 0,registerChatPlugin:function(a){var b=this;a.addEventListener("conversationStart",void 0,function(){if(-1!==navigator.userAgent.indexOf("Edg/")){var d=navigator.userAgent.split("/");if(!R(d[d.length-1],"94.0.992.50")){a.sttMicFail(b.button,"browser not supported");return}}void 0===b.recognition&&window.setTimeout(function(){if(void 0===(window.SpeechRecognition||window.webkitSpeechRecognition))a.sttMicFail(b.button,"browser not supported");else if("string"===typeof b.button&&(b.button=document.getElementById(b.button)),void 0===b.button||null===b.button)a.sttMicFail(b.button,"button "+
b.button+" does not exist");else{var d=function(d){var e=new(window.SpeechRecognition||window.webkitSpeechRecognition);e.continuous=!0;e.interimResults=!0;e._finalResults=[];e._finalTimeStamp=void 0;e._stillTalking=!1;a.addEventListeners({speakstart:function(){b.recognition._recording&&b.recognition.abort()},speakend:function(){}});e.onresult=function(d){for(var f="",g=d.resultIndex;g<d.results.length;++g)d.results[g].isFinal?e._recording&&(f+=d.results[g][0].transcript,e._finalResults.push(f),e._finalTimeStamp=(new Date).getTime(),e._stillTalking=!1):e._recording&&(f+=d.results[g][0].transcript+"​",a.sttMicTextInterim(b.button,d.results[g][0].transcript),e._stillTalking=!0);void 0!==e._finalTimeStamp&&window.setTimeout(function(){!1===e._stillTalking&&e.stop()},b.stopDelay)};e.onend=function(d){e._recording=!1;0<e._finalResults.length&&(a.sttMicTextFinish(b.button,e._finalResults[e._finalResults.length-1]),e._finalResults=[],e._finalTimeStamp=void 0);a.sttMicRecordingEnd(b.button)};e.onaudiostart=function(d){e._recording=!0;a.sttMicRecordingStart(b.button)};e.onnomatch=function(d){a.sttMicNoMatch(b.button)};return e};b.recognition=d(b.button);b.button.addEventListener("click",function(){!0!==a.getInputEnabled()?a.fireEvent("ErrorInputBlocked",{},a.getConversationPartnerName(),"Unable to dictate while input disabled"):b.recognition._recording?(b.recognition._recording&&b.recognition.stop(),b.recognition._recording=!1):(null==b.recognition&&(b.recognition=d(b.button)),b.recognition.lang=a.getLanguageCode(),b.recognition.start())});a.sttMicReady(b.button)}},1E3)})}});!0===f.autoConnect&&a._initialize(f);return e};
